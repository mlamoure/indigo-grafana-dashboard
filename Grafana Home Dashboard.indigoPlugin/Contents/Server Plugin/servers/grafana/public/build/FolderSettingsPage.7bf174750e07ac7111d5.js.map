{"version":3,"sources":["webpack:///./public/app/features/folders/state/actions.ts","webpack:///./public/app/features/folders/FolderSettingsPage.tsx","webpack:///./public/app/features/folders/state/navModel.ts"],"names":["getFolderByUid","uid","dispatch","backendSrv","folder","loadFolder","updateNavIndex","buildNavModel","saveFolder","put","title","version","res","appEvents","emit","AppEvents","alertSuccess","updateLocation","path","url","deleteFolder","getFolderPermissions","get","permissions","loadFolderPermissions","toUpdateItem","item","userId","teamId","role","permission","updateFolderPermission","itemToUpdate","level","getStore","itemsToUpdate","inherited","updated","push","post","items","removeFolderPermission","itemToDelete","addFolderPermission","newItem","createNewFolder","folderName","getBackendSrv","newFolder","locationUtil","stripBaseFromUrl","Input","LegacyForms","FolderSettingsPage","props","onTitleChange","evt","setFolderTitle","target","value","onSave","preventDefault","stopPropagation","setState","isLoading","onDelete","CoreEvents","showConfirmModal","text","icon","yesText","onConfirm","state","this","folderUid","navModel","Contents","className","name","onSubmit","type","onChange","disabled","canSave","hasChanged","onClick","PureComponent","mapDispatchToProps","hot","module","connect","location","routeParams","getNavModel","navIndex","getLoadingNav","id","subTitle","breadcrumbs","children","active","tabIndex","main","canEdit","canAdmin","node"],"mappings":"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","file":"FolderSettingsPage.7bf174750e07ac7111d5.js","sourcesContent":["import { AppEvents, locationUtil } from '@grafana/data';\nimport { getBackendSrv } from '@grafana/runtime';\nimport { backendSrv } from 'app/core/services/backend_srv';\nimport { FolderState, ThunkResult } from 'app/types';\nimport { DashboardAcl, DashboardAclUpdateDTO, NewDashboardAclItem, PermissionLevel } from 'app/types/acl';\nimport { updateLocation, updateNavIndex } from 'app/core/actions';\nimport { buildNavModel } from './navModel';\nimport appEvents from 'app/core/app_events';\nimport { loadFolder, loadFolderPermissions } from './reducers';\n\nexport function getFolderByUid(uid: string): ThunkResult<void> {\n  return async dispatch => {\n    const folder = await backendSrv.getFolderByUid(uid);\n    dispatch(loadFolder(folder));\n    dispatch(updateNavIndex(buildNavModel(folder)));\n  };\n}\n\nexport function saveFolder(folder: FolderState): ThunkResult<void> {\n  return async dispatch => {\n    const res = await backendSrv.put(`/api/folders/${folder.uid}`, {\n      title: folder.title,\n      version: folder.version,\n    });\n\n    // this should be redux action at some point\n    appEvents.emit(AppEvents.alertSuccess, ['Folder saved']);\n\n    dispatch(updateLocation({ path: `${res.url}/settings` }));\n  };\n}\n\nexport function deleteFolder(uid: string): ThunkResult<void> {\n  return async dispatch => {\n    await backendSrv.deleteFolder(uid, true);\n    dispatch(updateLocation({ path: `dashboards` }));\n  };\n}\n\nexport function getFolderPermissions(uid: string): ThunkResult<void> {\n  return async dispatch => {\n    const permissions = await backendSrv.get(`/api/folders/${uid}/permissions`);\n    dispatch(loadFolderPermissions(permissions));\n  };\n}\n\nfunction toUpdateItem(item: DashboardAcl): DashboardAclUpdateDTO {\n  return {\n    userId: item.userId,\n    teamId: item.teamId,\n    role: item.role,\n    permission: item.permission,\n  };\n}\n\nexport function updateFolderPermission(itemToUpdate: DashboardAcl, level: PermissionLevel): ThunkResult<void> {\n  return async (dispatch, getStore) => {\n    const folder = getStore().folder;\n    const itemsToUpdate = [];\n\n    for (const item of folder.permissions) {\n      if (item.inherited) {\n        continue;\n      }\n\n      const updated = toUpdateItem(item);\n\n      // if this is the item we want to update, update it's permission\n      if (itemToUpdate === item) {\n        updated.permission = level;\n      }\n\n      itemsToUpdate.push(updated);\n    }\n\n    await backendSrv.post(`/api/folders/${folder.uid}/permissions`, { items: itemsToUpdate });\n    await dispatch(getFolderPermissions(folder.uid));\n  };\n}\n\nexport function removeFolderPermission(itemToDelete: DashboardAcl): ThunkResult<void> {\n  return async (dispatch, getStore) => {\n    const folder = getStore().folder;\n    const itemsToUpdate = [];\n\n    for (const item of folder.permissions) {\n      if (item.inherited || item === itemToDelete) {\n        continue;\n      }\n      itemsToUpdate.push(toUpdateItem(item));\n    }\n\n    await backendSrv.post(`/api/folders/${folder.uid}/permissions`, { items: itemsToUpdate });\n    await dispatch(getFolderPermissions(folder.uid));\n  };\n}\n\nexport function addFolderPermission(newItem: NewDashboardAclItem): ThunkResult<void> {\n  return async (dispatch, getStore) => {\n    const folder = getStore().folder;\n    const itemsToUpdate = [];\n\n    for (const item of folder.permissions) {\n      if (item.inherited) {\n        continue;\n      }\n      itemsToUpdate.push(toUpdateItem(item));\n    }\n\n    itemsToUpdate.push({\n      userId: newItem.userId,\n      teamId: newItem.teamId,\n      role: newItem.role,\n      permission: newItem.permission,\n    });\n\n    await backendSrv.post(`/api/folders/${folder.uid}/permissions`, { items: itemsToUpdate });\n    await dispatch(getFolderPermissions(folder.uid));\n  };\n}\n\nexport function createNewFolder(folderName: string): ThunkResult<void> {\n  return async dispatch => {\n    const newFolder = await getBackendSrv().post('/api/folders', { title: folderName });\n    appEvents.emit(AppEvents.alertSuccess, ['Folder Created', 'OK']);\n    dispatch(updateLocation({ path: locationUtil.stripBaseFromUrl(newFolder.url) }));\n  };\n}\n","import React, { PureComponent } from 'react';\nimport { hot } from 'react-hot-loader';\nimport { connect } from 'react-redux';\nimport { NavModel } from '@grafana/data';\nimport { LegacyForms } from '@grafana/ui';\nconst { Input } = LegacyForms;\nimport Page from 'app/core/components/Page/Page';\nimport appEvents from 'app/core/app_events';\nimport { getNavModel } from 'app/core/selectors/navModel';\nimport { CoreEvents, FolderState, StoreState } from 'app/types';\nimport { deleteFolder, getFolderByUid, saveFolder } from './state/actions';\nimport { getLoadingNav } from './state/navModel';\nimport { setFolderTitle } from './state/reducers';\n\nexport interface Props {\n  navModel: NavModel;\n  folderUid: string;\n  folder: FolderState;\n  getFolderByUid: typeof getFolderByUid;\n  setFolderTitle: typeof setFolderTitle;\n  saveFolder: typeof saveFolder;\n  deleteFolder: typeof deleteFolder;\n}\n\nexport interface State {\n  isLoading: boolean;\n}\n\nexport class FolderSettingsPage extends PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      isLoading: false,\n    };\n  }\n\n  componentDidMount() {\n    this.props.getFolderByUid(this.props.folderUid);\n  }\n\n  onTitleChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n    this.props.setFolderTitle(evt.target.value);\n  };\n\n  onSave = async (evt: React.FormEvent<HTMLFormElement>) => {\n    evt.preventDefault();\n    evt.stopPropagation();\n    this.setState({ isLoading: true });\n    await this.props.saveFolder(this.props.folder);\n    this.setState({ isLoading: false });\n  };\n\n  onDelete = (evt: React.MouseEvent<HTMLButtonElement>) => {\n    evt.stopPropagation();\n    evt.preventDefault();\n\n    appEvents.emit(CoreEvents.showConfirmModal, {\n      title: 'Delete',\n      text: `Do you want to delete this folder and all its dashboards?`,\n      icon: 'trash-alt',\n      yesText: 'Delete',\n      onConfirm: () => {\n        this.props.deleteFolder(this.props.folder.uid);\n      },\n    });\n  };\n\n  render() {\n    const { navModel, folder } = this.props;\n\n    return (\n      <Page navModel={navModel}>\n        <Page.Contents isLoading={this.state.isLoading}>\n          <h3 className=\"page-sub-heading\">Folder Settings</h3>\n\n          <div className=\"section gf-form-group\">\n            <form name=\"folderSettingsForm\" onSubmit={this.onSave}>\n              <div className=\"gf-form\">\n                <label className=\"gf-form-label width-7\">Name</label>\n                <Input\n                  type=\"text\"\n                  className=\"gf-form-input width-30\"\n                  value={folder.title}\n                  onChange={this.onTitleChange}\n                />\n              </div>\n              <div className=\"gf-form-button-row\">\n                <button type=\"submit\" className=\"btn btn-primary\" disabled={!folder.canSave || !folder.hasChanged}>\n                  Save\n                </button>\n                <button className=\"btn btn-danger\" onClick={this.onDelete} disabled={!folder.canSave}>\n                  Delete\n                </button>\n              </div>\n            </form>\n          </div>\n        </Page.Contents>\n      </Page>\n    );\n  }\n}\n\nconst mapStateToProps = (state: StoreState) => {\n  const uid = state.location.routeParams.uid;\n\n  return {\n    navModel: getNavModel(state.navIndex, `folder-settings-${uid}`, getLoadingNav(2)),\n    folderUid: uid,\n    folder: state.folder,\n  };\n};\n\nconst mapDispatchToProps = {\n  getFolderByUid,\n  saveFolder,\n  setFolderTitle,\n  deleteFolder,\n};\n\nexport default hot(module)(connect(mapStateToProps, mapDispatchToProps)(FolderSettingsPage));\n","import { FolderDTO } from 'app/types';\nimport { NavModelItem, NavModel } from '@grafana/data';\n\nexport function buildNavModel(folder: FolderDTO): NavModelItem {\n  return {\n    icon: 'folder',\n    id: 'manage-folder',\n    subTitle: 'Manage folder dashboards & permissions',\n    url: '',\n    text: folder.title,\n    breadcrumbs: [{ title: 'Dashboards', url: 'dashboards' }],\n    children: [\n      {\n        active: false,\n        icon: 'apps',\n        id: `folder-dashboards-${folder.uid}`,\n        text: 'Dashboards',\n        url: folder.url,\n      },\n      {\n        active: false,\n        icon: 'lock',\n        id: `folder-permissions-${folder.uid}`,\n        text: 'Permissions',\n        url: `${folder.url}/permissions`,\n      },\n      {\n        active: false,\n        icon: 'cog',\n        id: `folder-settings-${folder.uid}`,\n        text: 'Settings',\n        url: `${folder.url}/settings`,\n      },\n    ],\n  };\n}\n\nexport function getLoadingNav(tabIndex: number): NavModel {\n  const main = buildNavModel({\n    id: 1,\n    uid: 'loading',\n    title: 'Loading',\n    url: 'url',\n    canSave: false,\n    canEdit: false,\n    canAdmin: false,\n    version: 0,\n  });\n\n  main.children[tabIndex].active = true;\n\n  return {\n    main: main,\n    node: main.children[tabIndex],\n  };\n}\n"],"sourceRoot":""}