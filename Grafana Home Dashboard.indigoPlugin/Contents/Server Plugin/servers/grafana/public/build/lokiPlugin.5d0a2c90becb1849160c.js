(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"+2Nz":function(e,t,r){"use strict";r.r(t);var a=r("Obii"),n=r("mrSG"),s=r("LvDl"),i=r.n(s),o=r("eqT+"),l=r("ceQ3"),c={comment:{pattern:/(^|[^\n])#.*/,lookbehind:!0},"context-labels":{pattern:/(^|\s)\{[^}]*(?=})/,lookbehind:!0,inside:{"label-key":{pattern:/[a-z_]\w*(?=\s*(=|!=|=~|!~))/,alias:"attr-name"},"label-value":{pattern:/"(?:\\.|[^\\"])*"/,greedy:!0,alias:"attr-value"},punctuation:/[{]/}},operator:new RegExp("/&&?|\\|?\\||!=?|<(?:=>?|<|>)?|>[>=]?","i"),punctuation:/[{}`,.]/},u=["job","namespace"],m=864e5,p=function(e){return{label:e}},f=function(e){return{start:1e6*e.from,end:1e6*e.to}};var d=function(e){function t(t,r){var a=e.call(this)||this;return a.cleanText=function(e){return e.replace(/[{}[\]="(),!~+\-*\/^%]/g,"").trim()},a.request=function(e,t){return a.datasource.metadataRequest(e,t)},a.start=function(){return a.startTask||(a.startTask=a.fetchLogLabels(a.initialRange).then(function(){return a.started=!0,[]})),a.startTask},a.datasource=t,a.labelKeys={},a.labelValues={},Object.assign(a,r),a}return Object(n.__extends)(t,e),t.prototype.getSyntax=function(){return c},t.prototype.getLabelKeys=function(){return this.labelKeys["{}"]},t.prototype.getLabelValues=function(e){return Object(n.__awaiter)(this,void 0,Promise,function(){return Object(n.__generator)(this,function(t){switch(t.label){case 0:return[4,this.fetchLabelValues(e,this.initialRange)];case 1:return t.sent(),[2,this.labelValues["{}"][e]]}})})},t.prototype.provideCompletionItems=function(e,t){return Object(n.__awaiter)(this,void 0,Promise,function(){var r,a,s;return Object(n.__generator)(this,function(n){switch(n.label){case 0:return r=e.wrapperClasses,a=e.value,s=0===a.document.text.length,i.a.includes(r,"context-labels")?[4,this.getLabelCompletionItems(e,t)]:[3,2];case 1:return[2,n.sent()];case 2:if(s)return[2,this.getEmptyCompletionItems(t||{})];n.label=3;case 3:return[2,{suggestions:[]}]}})})},t.prototype.getEmptyCompletionItems=function(e){var t=e.history,r=[];if(t&&t.length>0){var s=i.a.chain(t).map(function(e){return e.query.expr}).filter().uniq().take(10).map(p).map(function(e){return function(e,t){var r=Date.now()-m,s=t.filter(function(t){return t.ts>r&&t.query.expr===e.label}),i=s.length,o=s[0],l="Queried "+i+" times in the last 24h.";return o&&(l=l+" Last queried "+Object(a.dateTime)(o.ts).fromNow()+"."),Object(n.__assign)(Object(n.__assign)({},e),{documentation:l})}(e,t)}).value();r.push({prefixMatch:!0,skipSort:!0,label:"History",items:s})}return{suggestions:r}},t.prototype.getLabelCompletionItems=function(e,t){var r=e.text,a=e.wrapperClasses,s=e.labelKey,o=e.value,c=t.absoluteRange;return Object(n.__awaiter)(this,void 0,Promise,function(){var e,t,m,f,d,h,b,g,v,_;return Object(n.__generator)(this,function(n){switch(n.label){case 0:t=[],m=o.anchorBlock.getText(),f=o.selection.anchor.offset,d="{}";try{h=Object(l.c)(m,f)}catch(e){}return b=h?h.labelKeys:[],r&&r.match(/^!?=~?/)||a.includes("attr-value")?s&&this.labelValues[d]?(g=this.labelValues[d][s])?[3,2]:[4,this.fetchLabelValues(s,c)]:[3,3]:[3,4];case 1:n.sent(),g=this.labelValues[d][s],n.label=2;case 2:e="context-label-values",t.push({label:'Label values for "'+s+'"',items:g.map(p)}),n.label=3;case 3:return[3,5];case 4:(v=this.labelKeys[d]||u)&&(_=i.a.difference(v,b)).length>0&&(e="context-labels",t.push({label:"Labels",items:_.map(p)})),n.label=5;case 5:return[2,{context:e,suggestions:t}]}})})},t.prototype.importQueries=function(e,t){return Object(n.__awaiter)(this,void 0,Promise,function(){var r=this;return Object(n.__generator)(this,function(a){return"prometheus"===t?[2,Promise.all(e.map(function(e){return Object(n.__awaiter)(r,void 0,void 0,function(){var t,r,a;return Object(n.__generator)(this,function(s){switch(s.label){case 0:return[4,this.importPrometheusQuery(e.expr)];case 1:return t=s.sent(),(r=e).context,a=Object(n.__rest)(r,["context"]),[2,Object(n.__assign)(Object(n.__assign)({},a),{expr:t})]}})})}))]:[2,e.map(function(e){return{refId:e.refId,expr:""}})]})})},t.prototype.importPrometheusQuery=function(e){return Object(n.__awaiter)(this,void 0,Promise,function(){var t,r,a,s,i,o,c;return Object(n.__generator)(this,function(n){switch(n.label){case 0:return e?(t=e.match(l.f))?(r=t[0],a={},r.replace(l.b,function(e,t,r,n){return a[t]={value:n,operator:r},""}),[4,this.start()]):[3,2]:[2,""];case 1:if(n.sent(),s=this.labelKeys["{}"],i={},s&&s.length>0)for(o in a)s&&s.includes(o)&&(i[o]=a[o]);else i=a;return c=Object.keys(i).sort(),[2,["{",c.map(function(e){return""+e+i[e].operator+i[e].value}).join(","),"}"].join("")];case 2:return[2,""]}})})},t.prototype.fetchLogLabels=function(e){return Object(n.__awaiter)(this,void 0,Promise,function(){var t,r,a,s,i,o,l;return Object(n.__generator)(this,function(c){switch(c.label){case 0:t="/api/prom/label",c.label=1;case 1:return c.trys.push([1,4,,5]),this.logLabelFetchTs=Date.now(),[4,this.request(t,f(e))];case 2:return[4,(r=c.sent()).data||r.json()];case 3:return a=c.sent(),s=a.data.slice().sort(),this.labelKeys=Object(n.__assign)(Object(n.__assign)({},this.labelKeys),((o={})["{}"]=s,o)),this.labelValues=((l={})["{}"]={},l),this.logLabelOptions=s.map(function(e){return{label:e,value:e,isLeaf:!1}}),[3,5];case 4:return i=c.sent(),console.error(i),[3,5];case 5:return[2,[]]}})})},t.prototype.refreshLogLabels=function(e,t){return Object(n.__awaiter)(this,void 0,void 0,function(){return Object(n.__generator)(this,function(r){switch(r.label){case 0:return this.labelKeys&&Date.now()-this.logLabelFetchTs>3e4||t?[4,this.fetchLogLabels(e)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.fetchLabelValues=function(e,t){return Object(n.__awaiter)(this,void 0,void 0,function(){var r,a,s,i,o,l,c,u,m;return Object(n.__generator)(this,function(p){switch(p.label){case 0:r="/api/prom/label/"+e+"/values",p.label=1;case 1:return p.trys.push([1,4,,5]),[4,this.request(r,f(t))];case 2:return[4,(a=p.sent()).data||a.json()];case 3:return s=p.sent(),i=s.data.slice().sort(),this.logLabelOptions=this.logLabelOptions.map(function(t){return t.value===e?Object(n.__assign)(Object(n.__assign)({},t),{children:i.map(function(e){return{label:e,value:e}})}):t}),o=this.labelValues["{}"],l=Object(n.__assign)(Object(n.__assign)({},o),((u={})[e]=i,u)),this.labelValues=Object(n.__assign)(Object(n.__assign)({},this.labelValues),((m={})["{}"]=l,m)),[3,5];case 4:return c=p.sent(),console.error(c),[3,5];case 5:return[2]}})})},t}(a.LanguageProvider);function h(e,t,r){var s,i,o=e.parsedLabels;!o&&e.labels&&(o=Object(a.parseLabels)(e.labels));var l=new a.ArrayVector([]),c=new a.ArrayVector([]),u=new a.ArrayVector([]);try{for(var m=Object(n.__values)(e.entries),p=m.next();!p.done;p=m.next()){var f=p.value,d=f.ts||f.timestamp;l.add(d),c.add(f.line),u.add(d+"_"+e.labels)}}catch(e){s={error:e}}finally{try{p&&!p.done&&(i=m.return)&&i.call(m)}finally{if(s)throw s.error}}return t&&(l.buffer=l.buffer.reverse(),c.buffer=c.buffer.reverse()),{refId:r,fields:[{name:"ts",type:a.FieldType.time,config:{title:"Time"},values:l},{name:"line",type:a.FieldType.string,config:{},values:c,labels:o},{name:"id",type:a.FieldType.string,config:{},values:u}],length:l.length}}var b=/(?:^|\s){[^{]*}/g,g="(?i)";function v(e){var t=(e=e||"").match(b),r=e,a="";return t&&((a=e.replace(b,"").trim())&&-1===a.search(/\|=|\|~|!=|!~/)?(r=t[0].trim(),a.startsWith(g)||(a=""+g+a)):a=""),{regexp:a,query:r}}function _(e,t){return((e||"")+" "+(t||"")).trim()}function y(e){var t=v(e);if(t.regexp)return[t.regexp];for(var r=e,a=[];r;){var n=r.search(/\|=|\|~|!=|!~/);if(-1===n)break;var s=0===r.substr(n).search(/!=|!~/);if(r=r.substr(n+2),!s){var i=r.search(/\|=|\|~|!=|!~/),o=void 0;-1===i?o=r.trim():(o=r.substr(0,i).trim(),r=r.substr(i));var l=o.match(/^"((?:[^\\"]|\\")*)"$/);if(!l)return null;var c=l[1];a.push(c)}}return a}var O=r("m257"),x=r("K9Ia"),j=r("FFOo"),w=r("6blF"),E=r("pugT"),k=r("S5bw"),L={url:"",deserializer:function(e){return JSON.parse(e.data)},serializer:function(e){return JSON.stringify(e)}},S=function(e){function t(t,r){var a=e.call(this)||this;if(t instanceof w.a)a.destination=r,a.source=t;else{var s=a._config=n.__assign({},L);if(a._output=new x.b,"string"==typeof t)s.url=t;else for(var i in t)t.hasOwnProperty(i)&&(s[i]=t[i]);if(!s.WebSocketCtor&&WebSocket)s.WebSocketCtor=WebSocket;else if(!s.WebSocketCtor)throw new Error("no WebSocket constructor can be found");a.destination=new k.a}return a}return n.__extends(t,e),t.prototype.lift=function(e){var r=new t(this._config,this.destination);return r.operator=e,r.source=this,r},t.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new k.a),this._output=new x.b},t.prototype.multiplex=function(e,t,r){var a=this;return new w.a(function(n){try{a.next(e())}catch(e){n.error(e)}var s=a.subscribe(function(e){try{r(e)&&n.next(e)}catch(e){n.error(e)}},function(e){return n.error(e)},function(){return n.complete()});return function(){try{a.next(t())}catch(e){n.error(e)}s.unsubscribe()}})},t.prototype._connectSocket=function(){var e=this,t=this._config,r=t.WebSocketCtor,a=t.protocol,n=t.url,s=t.binaryType,i=this._output,o=null;try{o=a?new r(n,a):new r(n),this._socket=o,s&&(this._socket.binaryType=s)}catch(e){return void i.error(e)}var l=new E.a(function(){e._socket=null,o&&1===o.readyState&&o.close()});o.onopen=function(t){if(!e._socket)return o.close(),void e._resetState();var r=e._config.openObserver;r&&r.next(t);var a=e.destination;e.destination=j.a.create(function(t){if(1===o.readyState)try{var r=e._config.serializer;o.send(r(t))}catch(t){e.destination.error(t)}},function(t){var r=e._config.closingObserver;r&&r.next(void 0),t&&t.code?o.close(t.code,t.reason):i.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),e._resetState()},function(){var t=e._config.closingObserver;t&&t.next(void 0),o.close(),e._resetState()}),a&&a instanceof k.a&&l.add(a.subscribe(e.destination))},o.onerror=function(t){e._resetState(),i.error(t)},o.onclose=function(t){e._resetState();var r=e._config.closeObserver;r&&r.next(t),t.wasClean?i.complete():i.error(t)},o.onmessage=function(t){try{var r=e._config.deserializer;i.next(r(t))}catch(e){i.error(e)}}},t.prototype._subscribe=function(e){var t=this,r=this.source;return r?r.subscribe(e):(this._socket||this._connectSocket(),this._output.subscribe(e),e.add(function(){var e=t._socket;0===t._output.observers.length&&(e&&1===e.readyState&&e.close(),t._resetState())}),e)},t.prototype.unsubscribe=function(){var t=this._socket;t&&1===t.readyState&&t.close(),this._resetState(),e.prototype.unsubscribe.call(this)},t}(x.a);var T=r("2WpN"),F=r("67Y/"),C=function(){function e(){this.streams={}}return e.prototype.getStream=function(e){var t,r=this,s=this.streams[e.url];if(!s){var i=new a.CircularDataFrame({capacity:e.size});i.addField({name:"ts",type:a.FieldType.time,config:{title:"Time"}}),i.addField({name:"line",type:a.FieldType.string}).labels=Object(a.parseLabels)(e.query),i.addField({name:"labels",type:a.FieldType.other}),i.addField({name:"id",type:a.FieldType.string}),s=(t=e.url,new S(t)).pipe(Object(T.a)(function(){delete r.streams[e.url]}),Object(F.a)(function(e){return function(e,t){var r,s,i,o,l,c,u=e.streams;if(u&&u.length){var m=t.values,p={};try{for(var f=Object(n.__values)(t.fields),d=f.next();!d.done;d=f.next()){var h=d.value;if(h.type===a.FieldType.string){h.labels&&(p=h.labels);break}}}catch(e){r={error:e}}finally{try{d&&!d.done&&(s=f.return)&&s.call(f)}finally{if(r)throw r.error}}try{for(var b=Object(n.__values)(u),g=b.next();!g.done;g=b.next()){var v=g.value,_=Object(a.parseLabels)(v.labels),y=Object(a.findUniqueLabels)(_,p);try{for(var O=(l=void 0,Object(n.__values)(v.entries)),x=O.next();!x.done;x=O.next()){var j=x.value,w=j.ts||j.timestamp;m.ts.add(w),m.line.add(j.line),m.labels.add(y),m.id.add(w+"_"+v.labels)}}catch(e){l={error:e}}finally{try{x&&!x.done&&(c=O.return)&&c.call(O)}finally{if(l)throw l.error}}}}catch(e){i={error:e}}finally{try{g&&!g.done&&(o=b.return)&&o.call(b)}finally{if(i)throw i.error}}}}(e,i),[i]})),this.streams[e.url]=s}return s},e}(),D=r("0/uQ"),q=r("F/XL"),R=r("p0ib"),N=r("VnD/"),I=1e3,Q={direction:"BACKWARD",limit:I,regexp:"",query:""};function P(e){return Object.keys(e).map(function(t){var r=e[t];return encodeURIComponent(t)+"="+encodeURIComponent(r)}).join("&")}function A(e){return"string"==typeof e?e.replace(/'/g,"\\\\'"):e}function V(e){return"string"==typeof e?A(e.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]+?.()|]/g,"\\\\$&")):e}var W,K,U,z,M,B,$=function(e){function t(t,r,s){var i=e.call(this,t)||this;i.instanceSettings=t,i.backendSrv=r,i.templateSrv=s,i.streams=new C,i.processError=function(e,t){var r={message:e&&e.statusText||"Unknown error during query transaction. Please check JS console logs.",refId:t.refId};return e.data?"string"==typeof e.data?r.message=e.data:e.data.error&&(r.message=Object(O.t)(e.data.error)):e.message?r.message=e.message:"string"==typeof e&&(r.message=e),r.status=e.status,r.statusText=e.statusText,r},i.processResult=function(e,t){var r,a,s=[];if(0===Object.keys(e).length)return s;if(!e.streams)return[h(e,!1,t.refId)];e=e;try{for(var o=Object(n.__values)(e.streams||[]),l=o.next();!l.done;l=o.next()){var c=h(l.value);i.enhanceDataFrame(c),c.refId=t.refId,c.meta={searchWords:y(_(t.query,t.regexp)),limit:i.maxLines},s.push(c)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}return s},i.runLiveQuery=function(e,t){var r=i.prepareLiveTarget(t,e);return i.streams.getStream(r).pipe(Object(F.a)(function(e){return{data:e,key:"loki-"+r.refId,state:a.LoadingState.Streaming}}))},i.runQuery=function(e,t){var r=i.prepareQueryTarget(t,e);return Object(D.a)(i._request("/api/prom/query",r).catch(function(e){if(e.cancelled)return e;throw i.processError(e,r)})).pipe(Object(N.a)(function(e){return!e.cancelled}),Object(F.a)(function(e){return{data:i.processResult(e.data,r),key:r.refId}}))},i.prepareLogRowContextQueryTarget=function(e,t,r){var a=Object.keys(e.labels).map(function(t){return t+'="'+e.labels[t]+'"'}).join(","),s=1e6*e.timeEpochMs,i={limit:t,query:"{"+a+"}",direction:r};return"BACKWARD"===r?Object(n.__assign)(Object(n.__assign)({},i),{start:s-72e11,end:e.timestamp,direction:r}):Object(n.__assign)(Object(n.__assign)({},i),{start:e.timestamp,end:s+72e11})},i.getLogRowContext=function(e,t){return Object(n.__awaiter)(i,void 0,void 0,function(){var r,a,s,i,o,l,c,u,m,p;return Object(n.__generator)(this,function(f){switch(f.label){case 0:r=this.prepareLogRowContextQueryTarget(e,t&&t.limit||10,t&&t.direction||"BACKWARD"),a=[],f.label=1;case 1:return f.trys.push([1,3,,4]),s=t&&"FORWARD"===t.direction,[4,this._request("/api/prom/query",r)];case 2:if((i=f.sent()).data)try{for(o=Object(n.__values)(i.data.streams||[]),l=o.next();!l.done;l=o.next())c=l.value,a.push(h(c,s))}catch(e){m={error:e}}finally{try{l&&!l.done&&(p=o.return)&&p.call(o)}finally{if(m)throw m.error}}return[2,{data:a}];case 3:throw u=f.sent(),{message:"Error during context query. Please check JS console logs.",status:u.status,statusText:u.statusText};case 4:return[2]}})})},i.languageProvider=new d(i);var o=t.jsonData||{};return i.maxLines=parseInt(o.maxLines,10)||I,i}return t.$inject=["instanceSettings","backendSrv","templateSrv"],Object(n.__extends)(t,e),t.prototype._request=function(e,t,r){var a=""+this.instanceSettings.url+e+"?"+(t?P(t):""),s=Object(n.__assign)(Object(n.__assign)({},r),{url:a});return this.backendSrv.datasourceRequest(s)},t.prototype.prepareLiveTarget=function(e,t){var r=v(this.templateSrv.replace(e.expr,{},this.interpolateQueryExpr)),a=r.query,n=r.regexp,s=e.refId,i=this.instanceSettings.url,o=P({query:a,regexp:n});return{query:a,regexp:n,url:Object(O.f)(i+"/api/prom/tail?"+o),refId:s,size:Math.min(t.maxDataPoints||1/0,this.maxLines)}},t.prototype.prepareQueryTarget=function(e,t){var r=v(this.templateSrv.replace(e.expr,{},this.interpolateQueryExpr)),a=r.query,s=r.regexp,i=this.getTime(t.range.from,!1),o=this.getTime(t.range.to,!0),l=e.refId;return Object(n.__assign)(Object(n.__assign)({},Q),{query:a,regexp:s,start:i,end:o,limit:Math.min(t.maxDataPoints||1/0,this.maxLines),refId:l})},t.prototype.query=function(e){var t=this,r=e.targets.filter(function(e){return e.expr&&!e.hide}).map(function(r){return r.liveStreaming?t.runLiveQuery(e,r):t.runQuery(e,r)});return Object(s.isEmpty)(r)?Object(q.a)({data:[],state:a.LoadingState.Done}):R.a.apply(void 0,Object(n.__spread)(r))},t.prototype.interpolateVariablesInQueries=function(e){var t=this,r=e;return e&&e.length>0&&(r=e.map(function(e){return Object(n.__assign)(Object(n.__assign)({},e),{datasource:t.name,expr:t.templateSrv.replace(e.expr,{},t.interpolateQueryExpr)})})),r},t.prototype.importQueries=function(e,t){return Object(n.__awaiter)(this,void 0,Promise,function(){return Object(n.__generator)(this,function(r){return[2,this.languageProvider.importQueries(e,t.id)]})})},t.prototype.metadataRequest=function(e,t){var r=e.replace("v1","prom");return this._request(r,t,{silent:!0}).then(function(e){return{data:{data:e.data.values||[]}}})},t.prototype.interpolateQueryExpr=function(e,t){return t.multi||t.includeAll?"string"==typeof e?V(e):Object(s.map)(e,V).join("|"):A(e)},t.prototype.modifyQuery=function(e,t){var r=v(e.expr||""),a=r.query;switch(t.type){case"ADD_FILTER":a=Object(o.a)(a,t.key,t.value)+" "+Object(o.c)(a);break;case"ADD_FILTER_OUT":a=Object(o.a)(a,t.key,t.value,"!=")+" "+Object(o.c)(a)}var s=_(a,r.regexp);return Object(n.__assign)(Object(n.__assign)({},e),{expr:s})},t.prototype.getHighlighterExpression=function(e){return y(e.expr)},t.prototype.getTime=function(e,t){return Object(s.isString)(e)&&(e=a.dateMath.parse(e,t)),Math.ceil(1e6*e.valueOf())},t.prototype.testDatasource=function(){var e=Date.now()-6e5+"000000";return this._request("/api/prom/label",{start:e}).then(function(e){return e&&e.data&&e.data.values&&e.data.values.length>0?{status:"success",message:"Data source connected and labels found."}:{status:"error",message:"Data source connected, but no labels received. Verify that Loki and Promtail is configured properly."}}).catch(function(e){var t="Loki: ";return e.statusText?t+=e.statusText:t+="Cannot connect to Loki",e.status&&(t+=". "+e.status),e.data&&e.data.message?t+=". "+e.data.message:e.data&&(t+=". "+e.data),{status:"error",message:t}})},t.prototype.annotationQuery=function(e){return Object(n.__awaiter)(this,void 0,Promise,function(){var t,r,s,i,o,l,c,u,m;return Object(n.__generator)(this,function(p){switch(p.label){case 0:return e.annotation.expr?(t=function(e){var t="annotation-"+e.annotation.name,r={refId:t,expr:e.annotation.expr};return{requestId:t,range:e.range,targets:[r],dashboardId:e.dashboard.id,scopedVars:null,startTime:Date.now(),maxDataPoints:0,timezone:"utc",panelId:0,interval:"",intervalMs:0}}(e),[4,this.runQuery(t,t.targets[0]).toPromise()]):[2,[]];case 1:r=p.sent().data,s=[],i=function(e){var t,r,i=[];try{for(var o=(t=void 0,Object(n.__values)(e.fields)),l=o.next();!l.done;l=o.next()){var c=l.value;c.labels&&i.push.apply(i,Object.values(c.labels))}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}new a.DataFrameView(e).forEachRow(function(e){s.push({time:new Date(e.ts).valueOf(),text:e.line,tags:i})})};try{for(o=Object(n.__values)(r),l=o.next();!l.done;l=o.next())c=l.value,i(c)}catch(e){u={error:e}}finally{try{l&&!l.done&&(m=o.return)&&m.call(o)}finally{if(u)throw u.error}}return[2,s]}})})},t.prototype.enhanceDataFrame=function(e){if(this.instanceSettings.jsonData){var t=this.instanceSettings.jsonData.derivedFields||[];if(t.length){var r=Object(s.fromPairs)(t.map(function(e){var t={};e.url&&(t.links=[{url:e.url,title:""}]);var r={name:e.name,type:a.FieldType.string,config:t,values:new a.ArrayVector([])};return[e.name,r]}));new a.DataFrameView(e).forEachRow(function(e){var a,s;try{for(var i=Object(n.__values)(t),o=i.next();!o.done;o=i.next()){var l=o.value,c=e.line.match(l.matcherRegex);r[l.name].values.add(c&&c[1])}}catch(e){a={error:e}}finally{try{o&&!o.done&&(s=i.return)&&s.call(i)}finally{if(a)throw a.error}}}),e.fields=Object(n.__spread)(e.fields,Object.values(r))}}},t}(a.DataSourceApi),J=r("q1tI"),H=r.n(J),Y=['{job="default/prometheus"}'],Z=["job","app","k8s_app"],G=5,X=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={userExamples:Y},t.checkUserLabels=function(){return Object(n.__awaiter)(t,void 0,void 0,function(){var e,t,r,a,i;return Object(n.__generator)(this,function(n){switch(n.label){case 0:return(e=this.props.datasource.languageProvider).started?(t=e.getLabelKeys()||[],(r=Z.find(function(e){return t.includes(e)}))?[4,e.getLabelValues(r)]:[3,2]):[3,3];case 1:a=n.sent(),i=Object(s.shuffle)(a).slice(0,G).map(function(e){return"{"+r+'="'+e+'"}'}),this.setState({userExamples:i}),n.label=2;case 2:return[3,4];case 3:this.scheduleUserLabelChecking(),n.label=4;case 4:return[2]}})})},t}return Object(n.__extends)(t,e),t.prototype.componentDidMount=function(){this.scheduleUserLabelChecking()},t.prototype.componentWillUnmount=function(){clearTimeout(this.userLabelTimer)},t.prototype.scheduleUserLabelChecking=function(){this.userLabelTimer=setTimeout(this.checkUserLabels,1e3)},t.prototype.renderExpression=function(e){var t=this.props.onClickExample;return H.a.createElement("div",{className:"cheat-sheet-item__example",key:e,onClick:function(r){return t({refId:"A",expr:e})}},H.a.createElement("code",null,e))},t.prototype.render=function(){var e=this,t=this.state.userExamples;return H.a.createElement(H.a.Fragment,null,H.a.createElement("h2",null,"Loki Cheat Sheet"),H.a.createElement("div",{className:"cheat-sheet-item"},H.a.createElement("div",{className:"cheat-sheet-item__title"},"See your logs"),H.a.createElement("div",{className:"cheat-sheet-item__label"},"Start by selecting a log stream from the Log labels selector."),H.a.createElement("div",{className:"cheat-sheet-item__label"},"Alternatively, you can write a stream selector into the query field:"),this.renderExpression('{job="default/prometheus"}'),t!==Y&&t.length>0?H.a.createElement("div",null,H.a.createElement("div",{className:"cheat-sheet-item__label"},"Here are some example streams from your logs:"),t.map(function(t){return e.renderExpression(t)})):null),H.a.createElement("div",{className:"cheat-sheet-item"},H.a.createElement("div",{className:"cheat-sheet-item__title"},"Combine stream selectors"),this.renderExpression('{app="cassandra",namespace="prod"}'),H.a.createElement("div",{className:"cheat-sheet-item__label"},"Returns all log lines from streams that have both labels.")),H.a.createElement("div",{className:"cheat-sheet-item"},H.a.createElement("div",{className:"cheat-sheet-item__title"},"Filtering for search terms."),this.renderExpression('{app="cassandra"} |~ "(duration|latency)s*(=|is|of)s*[d.]+"'),this.renderExpression('{app="cassandra"} |= "exact match"'),this.renderExpression('{app="cassandra"} != "do not match"'),H.a.createElement("div",{className:"cheat-sheet-item__label"},H.a.createElement("a",{href:"https://github.com/grafana/loki/blob/master/docs/logql.md#filter-expression",target:"logql"},"LogQL")," ","supports exact and regular expression filters.")))},t}(J.PureComponent),ee=r("KwPh"),te=r("uz0r"),re=function(e){var t=e.datasource,r=Object(n.__rest)(e,["datasource"]),a=Object(te.a)(t.languageProvider,r.absoluteRange),s=a.isSyntaxReady,i=a.setActiveOption,o=a.refreshLabels,l=Object(n.__rest)(a,["isSyntaxReady","setActiveOption","refreshLabels"]);return H.a.createElement(ee.a,Object(n.__assign)({datasource:t,syntaxLoaded:s,onLoadOptions:i,onLabelsRefresh:o},l,r))},ae=re,ne=Object(J.memo)(function(e){var t,r=e.query,a=e.data,s=e.datasource,i=e.onChange,o=e.onRunQuery;if(a&&a.request){var l=a.request.range;t={from:l.from.valueOf(),to:l.to.valueOf()}}else t={from:Date.now()-1e4,to:Date.now()};var c=Object(te.a)(s.languageProvider,t),u=c.isSyntaxReady,m=c.setActiveOption,p=c.refreshLabels,f=Object(n.__rest)(c,["isSyntaxReady","setActiveOption","refreshLabels"]);return H.a.createElement("div",null,H.a.createElement(re,Object(n.__assign)({datasource:s,query:r,onChange:i,onRunQuery:o,history:[],data:a,onLoadOptions:m,onLabelsRefresh:p,syntaxLoaded:u,absoluteRange:t},f)))}),se=function(){function e(){this.annotation.target=this.annotation.target||{},this.onQueryChange=this.onQueryChange.bind(this)}return e.prototype.onQueryChange=function(e){this.annotation.expr=e},e.templateUrl="partials/annotations.editor.html",e}(),ie=r("kDLi"),oe=function(e){var t=e.value,r=e.onChange;return H.a.createElement(ie.FormField,{label:"Maximum lines",labelWidth:11,inputWidth:20,inputEl:H.a.createElement("input",{type:"number",className:"gf-form-input width-8 gf-form-input--has-help-icon",value:t,onChange:function(e){return r(e.currentTarget.value)},spellCheck:!1,placeholder:"1000"}),tooltip:H.a.createElement(H.a.Fragment,null,"Loki queries must contain a limit of the maximum number of lines returned (default: 1000). Increase this limit to have a bigger result set for ad-hoc analysis. Decrease this limit if your browser becomes sluggish when displaying the log results.")})},le=r("PAeb"),ce=Object(ie.stylesFactory)(function(){return{firstRow:Object(le.css)(W||(W=Object(n.__makeTemplateObject)(["\n    display: flex;\n    align-items: baseline;\n  "],["\n    display: flex;\n    align-items: baseline;\n  "]))),nameField:Object(le.css)(K||(K=Object(n.__makeTemplateObject)(["\n    flex: 2;\n  "],["\n    flex: 2;\n  "]))),regexField:Object(le.css)(U||(U=Object(n.__makeTemplateObject)(["\n    flex: 3;\n  "],["\n    flex: 3;\n  "])))}}),ue=function(e){var t=e.value,r=e.onChange,a=e.onDelete,s=e.suggestions,i=e.className,o=ce(),l=function(e){return function(a){var s;r(Object(n.__assign)(Object(n.__assign)({},t),((s={})[e]=a.currentTarget.value,s)))}};return H.a.createElement("div",{className:i},H.a.createElement("div",{className:o.firstRow},H.a.createElement(ie.FormField,{className:o.nameField,labelWidth:5,inputWidth:null,label:"Name",type:"text",value:t.name,onChange:l("name")}),H.a.createElement(ie.FormField,{className:o.regexField,inputWidth:null,label:"Regex",type:"text",value:t.matcherRegex,onChange:l("matcherRegex"),tooltip:"Use to parse and capture some part of the log message. You can use the captured groups in the template."}),H.a.createElement(ie.Button,{variant:"inverse",title:"Remove field",icon:"fa fa-times",onClick:function(e){e.preventDefault(),a()},className:Object(le.css)(z||(z=Object(n.__makeTemplateObject)(["\n            margin-left: 8px;\n          "],["\n            margin-left: 8px;\n          "])))})),H.a.createElement(ie.FormField,{label:"URL",labelWidth:5,inputEl:H.a.createElement(ie.DataLinkInput,{placeholder:"http://example.com/${__value.raw}",value:t.url||"",onChange:function(e){return r(Object(n.__assign)(Object(n.__assign)({},t),{url:e}))},suggestions:s}),className:Object(le.css)(M||(M=Object(n.__makeTemplateObject)(["\n          width: 100%;\n        "],["\n          width: 100%;\n        "])))}))},me=r("TSYQ"),pe=r.n(me),fe=r("MAcC"),de=function(e){var t=e.derivedFields,r=e.className,s=Object(n.__read)(Object(J.useState)(""),2),i=s[0],o=s[1],l=[];return i&&t&&(l=function(e,t){return e.filter(function(e){return e.name&&e.matcherRegex}).map(function(e){try{var r=t.match(e.matcherRegex),n=r&&r[1],s=void 0;return e.url&&n&&(s=Object(fe.b)({name:"",type:a.FieldType.string,values:new a.ArrayVector([n]),config:{links:[{title:"",url:e.url}]}},0)[0]),{name:e.name,value:n||"<no match>",href:s&&s.href}}catch(t){return{name:e.name,error:t}}})}(t,i)),H.a.createElement("div",{className:r},H.a.createElement(ie.FormField,{labelWidth:12,label:"Debug log message",inputEl:H.a.createElement("textarea",{placeholder:"Paste an example log line here to test the regular expressions of your derived fields",className:pe()("gf-form-input gf-form-textarea",Object(le.css)(B||(B=Object(n.__makeTemplateObject)(["\n                width: 100%;\n              "],["\n                width: 100%;\n              "])))),value:i,onChange:function(e){return o(e.currentTarget.value)}})}),!!l.length&&H.a.createElement(he,{fields:l}))},he=function(e){var t=e.fields;return H.a.createElement("table",{className:"filter-table"},H.a.createElement("thead",null,H.a.createElement("tr",null,H.a.createElement("th",null,"Name"),H.a.createElement("th",null,"Value"),H.a.createElement("th",null,"Url"))),H.a.createElement("tbody",null,t.map(function(e){var t=e.value;return e.error?t=e.error.message:e.href&&(t=H.a.createElement("a",{href:e.href},t)),H.a.createElement("tr",{key:e.name+"="+e.value},H.a.createElement("td",null,e.name),H.a.createElement("td",null,t),H.a.createElement("td",null,e.href?H.a.createElement("a",{href:e.href},e.href):""))})))};var be,ge,ve,_e,ye=Object(ie.stylesFactory)(function(e){return{infoText:Object(le.css)(be||(be=Object(n.__makeTemplateObject)(["\n    padding-bottom: ",";\n    color: ",";\n  "],["\n    padding-bottom: ",";\n    color: ",";\n  "])),e.spacing.md,e.colors.textWeak),derivedField:Object(le.css)(ge||(ge=Object(n.__makeTemplateObject)(["\n    margin-bottom: ",";\n  "],["\n    margin-bottom: ",";\n  "])),e.spacing.sm)}}),Oe=function(e){var t=e.value,r=e.onChange,a=Object(ie.useTheme)(),s=ye(a),i=Object(n.__read)(Object(J.useState)(!1),2),o=i[0],l=i[1];return H.a.createElement(H.a.Fragment,null,H.a.createElement("h3",{className:"page-heading"},"Derived fields"),H.a.createElement("div",{className:s.infoText},"Derived fields can be used to extract new fields from the log message and create link from it's value."),H.a.createElement("div",{className:"gf-form-group"},t&&t.map(function(e,a){return H.a.createElement(ue,{className:s.derivedField,key:a,value:e,onChange:function(e){var s=Object(n.__spread)(t);s.splice(a,1,e),r(s)},onDelete:function(){var e=Object(n.__spread)(t);e.splice(a,1),r(e)},suggestions:[{value:ie.DataLinkBuiltInVars.valueRaw,label:"Raw value",documentation:"Exact string captured by the regular expression",origin:ie.VariableOrigin.Value}]})}),H.a.createElement("div",null,H.a.createElement(ie.Button,{variant:"inverse",className:Object(le.css)(ve||(ve=Object(n.__makeTemplateObject)(["\n              margin-right: 10px;\n            "],["\n              margin-right: 10px;\n            "]))),icon:"fa fa-plus",onClick:function(e){e.preventDefault();var a=Object(n.__spread)(t||[],[{name:"",matcherRegex:""}]);r(a)}},"Add"),t&&t.length>0&&H.a.createElement(ie.Button,{variant:"inverse",onClick:function(){return l(!o)}},o?"Hide example log message":"Show example log message"))),o&&H.a.createElement("div",{className:"gf-form-group"},H.a.createElement(de,{className:Object(le.css)(_e||(_e=Object(n.__makeTemplateObject)(["\n              margin-bottom: 10px;\n            "],["\n              margin-bottom: 10px;\n            "]))),derivedFields:t})))},xe=function(e){return function(t,r){var a;return Object(n.__assign)(Object(n.__assign)({},t),{jsonData:Object(n.__assign)(Object(n.__assign)({},t.jsonData),(a={},a[e]=r,a))})}},je=xe("maxLines"),we=xe("derivedFields");r.d(t,"plugin",function(){return Ee});var Ee=new a.DataSourcePlugin($).setQueryEditor(ne).setConfigEditor(function(e){var t=e.options,r=e.onOptionsChange;return H.a.createElement(H.a.Fragment,null,H.a.createElement(ie.DataSourceHttpSettings,{defaultUrl:"http://localhost:3100",dataSourceConfig:t,showAccessOptions:!1,onChange:r}),H.a.createElement("div",{className:"gf-form-group"},H.a.createElement("div",{className:"gf-form-inline"},H.a.createElement("div",{className:"gf-form"},H.a.createElement(oe,{value:t.jsonData.maxLines,onChange:function(e){return r(je(t,e))}})))),H.a.createElement(Oe,{value:t.jsonData.derivedFields,onChange:function(e){return r(we(t,e))}}))}).setExploreQueryField(ae).setExploreStartPage(X).setAnnotationQueryCtrl(se)},ceQ3:function(e,t,r){"use strict";r.d(t,"d",function(){return n}),r.d(t,"e",function(){return s}),r.d(t,"f",function(){return i}),r.d(t,"b",function(){return o}),r.d(t,"c",function(){return l}),r.d(t,"a",function(){return c});var a=r("mrSG"),n=function(e){for(var t=[],r=new RegExp("_bucket($|:)"),a=0;a<e.length;a++){var n=e[a];r.test(n)&&-1===t.indexOf(n)&&t.push(n)}return{values:{__name__:t}}};function s(e,t){void 0===t&&(t=!1);var r={};return e.forEach(function(e){var n=e.__name__,s=Object(a.__rest)(e,["__name__"]);t&&(r.__name__=r.__name__||[],r.__name__.includes(n)||r.__name__.push(n)),Object.keys(s).forEach(function(e){r[e]||(r[e]=[]),r[e].includes(s[e])||r[e].push(s[e])})}),{values:r,keys:Object.keys(r)}}var i=/\{[^}]*?\}/,o=/\b(\w+)(!?=~?)("[^"\n]*?")/g;function l(e,t){if(void 0===t&&(t=1),!e.match(i)){if(e.match(/^[A-Za-z:][\w:]*$/))return{selector:'{__name__="'+e+'"}',labelKeys:["__name__"]};throw new Error("Query must contain a selector: "+e)}var r=e.slice(0,t),a=r.lastIndexOf("{"),n=r.lastIndexOf("}");if(-1===a)throw new Error("Not inside selector, missing open brace: "+r);if(n>-1&&n>a)throw new Error("Not inside selector, previous selector already closed: "+r);var s=e.slice(t),l=s.indexOf("}")+t,c=s.indexOf("{"),u=c+t;if(-1===l)throw new Error("Not inside selector, missing closing brace in suffix: "+s);if(c>-1&&u<l)throw new Error("Not inside selector, next selector opens before this one closed: "+s);var m=e.slice(a,l),p={};m.replace(o,function(e,t,r,a){return p[t]={value:a,operator:r},""});var f=e.slice(0,a).match(/[A-Za-z:][\w:]*$/);f&&(p.__name__={value:'"'+f[0]+'"',operator:"="});var d=Object.keys(p).sort(),h=d.map(function(e){return""+e+p[e].operator+p[e].value}).join(",");return{labelKeys:d,selector:["{",h,"}"].join("")}}function c(e,t){var r=Object.keys(t),a=new RegExp("(\\s|^)("+r.join("|")+")(\\s|$|\\(|\\[|\\{)","ig");return e.replace(a,function(e,r,a,n){return""+r+t[a]+n})}},"eqT+":function(e,t,r){"use strict";r.d(t,"a",function(){return u}),r.d(t,"c",function(){return m});var a=r("LvDl"),n=r.n(a),s="by|without|on|ignoring|group_left|group_right|bool|or|and|unless",i=[s,"count|count_values|min|max|avg|sum|stddev|stdvar|bottomk|topk|quantile","true|false|null|__name__|job","abs|absent|ceil|changes|clamp_max|clamp_min|count_scalar|day_of_month|day_of_week|days_in_month|delta|deriv","drop_common_labels|exp|floor|histogram_quantile|holt_winters|hour|idelta|increase|irate|label_replace|ln|log2","log10|minute|month|predict_linear|rate|resets|round|scalar|sort|sort_desc|sqrt|time|vector|year|avg_over_time","min_over_time|max_over_time|sum_over_time|count_over_time|quantile_over_time|stddev_over_time|stdvar_over_time"].join("|").split("|"),o=/([A-Za-z:][\w:]*)\b(?![\(\]{=!",])/g,l=/{([^{]*)}/g;var c=/(\w+)\s*(=|!=|=~|!~)\s*("[^"]*")/g;function u(e,t,r,a){var s=[];if(e)for(var i=c.exec(e);i;)s.push({key:i[1],operator:i[2],value:i[3]}),i=c.exec(e);var o=a||"=";return s.push({key:t,operator:o,value:'"'+r+'"'}),"{"+n.a.chain(s).uniqWith(n.a.isEqual).compact().sortBy("key").map(function(e){return""+e.key+e.operator+e.value}).value().join(",")+"}"}function m(e){return e.replace(/\{(.*?)\}/g,"").replace(/^ /,"")}t.b=function(e,t,r,a){if(!t||!r)throw new Error("Need label to add to query.");var n;e=e.replace(o,function(t,r,a){var o,l,c,u,m,p,f=(l=a,c="{",u="}",m=(o=e).slice(l).indexOf(c),(p=o.slice(l).indexOf(u))>-1&&(-1===m||m>p)),d=n&&s.split("|").indexOf(n)>-1,h=r.endsWith(":");return n=r,f||h||d||-1!==i.indexOf(r)?r:r+"{}"});for(var c=l.exec(e),m=[],p=0,f="";c;){var d=e.slice(p,c.index),h=u(c[1],t,r,a);p=c.index+c[1].length+2,f=e.slice(c.index+c[0].length),m.push(d,h),c=l.exec(e)}return m.push(f),m.join("")}}}]);
//# sourceMappingURL=lokiPlugin.5d0a2c90becb1849160c.js.map