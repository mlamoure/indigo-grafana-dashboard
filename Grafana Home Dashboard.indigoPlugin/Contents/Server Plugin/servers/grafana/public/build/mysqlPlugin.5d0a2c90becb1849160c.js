(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{QjE0:function(t,e,r){"use strict";var a;r.d(e,"a",function(){return a}),r.d(e,"c",function(){return n}),r.d(e,"b",function(){return i}),function(t){t.Password="password",t.BasicAuthPassword="basicAuthPassword"}(a||(a={}));var n=function(t,e){return function(r){r.preventDefault(),t.current[e]=null,t.current.secureJsonFields[e]=!1,t.current.secureJsonData=t.current.secureJsonData||{},t.current.secureJsonData[e]=""}},i=function(t,e){return function(r){t.current.secureJsonData=t.current.secureJsonData||{},t.current.secureJsonData[e]=r.currentTarget.value}}},"XXK+":function(t,e,r){"use strict";r.d(e,"b",function(){return i}),r.d(e,"a",function(){return s});var a=r("LvDl"),n=r.n(a),i=function(){return function(t){this.type=t.type,t.label?this.label=t.label:this.label=this.type[0].toUpperCase()+this.type.substring(1)+":",this.style=t.style,"function"===this.style?(this.wrapOpen="(",this.wrapClose=")",this.separator=", "):(this.wrapOpen=" ",this.wrapClose=" ",this.separator=" "),this.params=t.params,this.defaultParams=t.defaultParams}}(),s=function(){function t(t,e){if(this.part=t,this.def=e,!this.def)throw{message:"Could not find sql part "+t.type};this.datatype=t.datatype,t.name?(this.name=t.name,this.label=e.label+" "+t.name):(this.name="",this.label=e.label),t.params=t.params||n.a.clone(this.def.defaultParams),this.params=t.params}return t.prototype.updateParam=function(t,e){""===t&&this.def.params[e].optional?this.params.splice(e,1):this.params[e]=t,this.part.params=this.params},t}()},"qSU+":function(t,e,r){"use strict";r.r(e);var a=r("mrSG"),n=r("LvDl"),i=r.n(n),s=function(){function t(t){this.$q=t}return t.prototype.processQueryResult=function(t){var e,r,n,i,s=[];if(!t.data.results)return{data:s};for(var o in t.data.results){var u=t.data.results[o];if(u.series)try{for(var l=(e=void 0,Object(a.__values)(u.series)),m=l.next();!m.done;m=l.next()){var c=m.value;s.push({target:c.name,datapoints:c.points,refId:u.refId,meta:u.meta})}}catch(t){e={error:t}}finally{try{m&&!m.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}if(u.tables)try{for(var p=(n=void 0,Object(a.__values)(u.tables)),h=p.next();!h.done;h=p.next()){var d=h.value;d.type="table",d.refId=u.refId,d.meta=u.meta,s.push(d)}}catch(t){n={error:t}}finally{try{h&&!h.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}}return{data:s}},t.prototype.parseMetricFindQueryResult=function(t,e){if(!e||0===e.data.length||0===e.data.results[t].meta.rowCount)return[];var r=e.data.results[t].tables[0].columns,a=e.data.results[t].tables[0].rows,n=this.findColIndex(r,"__text"),i=this.findColIndex(r,"__value");return 2===r.length&&-1!==n&&-1!==i?this.transformToKeyValueList(a,n,i):this.transformToSimpleList(a)},t.prototype.transformToKeyValueList=function(t,e,r){for(var a=[],n=0;n<t.length;n++)this.containsKey(a,t[n][e])||a.push({text:t[n][e],value:t[n][r]});return a},t.prototype.transformToSimpleList=function(t){for(var e=[],r=0;r<t.length;r++)for(var a=0;a<t[r].length;a++){var n=t[r][a];-1===e.indexOf(n)&&e.push(n)}return i.a.map(e,function(t){return{text:t}})},t.prototype.findColIndex=function(t,e){for(var r=0;r<t.length;r++)if(t[r].text===e)return r;return-1},t.prototype.containsKey=function(t,e){for(var r=0;r<t.length;r++)if(t[r].text===e)return!0;return!1},t.prototype.transformAnnotationResponse=function(t,e){for(var r=e.data.results[t.annotation.name].tables[0],a=-1,n=-1,i=-1,s=0;s<r.columns.length;s++)if("time_sec"===r.columns[s].text||"time"===r.columns[s].text)a=s;else{if("title"===r.columns[s].text)return this.$q.reject({message:"The title column for annotations is deprecated, now only a column named text is returned"});"text"===r.columns[s].text?n=s:"tags"===r.columns[s].text&&(i=s)}if(-1===a)return this.$q.reject({message:"Missing mandatory time column (with time_sec column alias) in annotation query."});var o=[];for(s=0;s<r.rows.length;s++){var u=r.rows[s];o.push({annotation:t.annotation,time:Math.floor(u[a]),text:u[n]?u[n].toString():"",tags:u[i]?u[i].trim().split(/\s*,\s*/):[]})}return o},t}(),o=function(){function t(t,e,r){this.target=t,this.templateSrv=e,this.scopedVars=r,t.format=t.format||"time_series",t.timeColumn=t.timeColumn||"time",t.metricColumn=t.metricColumn||"none",t.group=t.group||[],t.where=t.where||[{type:"macro",name:"$__timeFilter",params:[]}],t.select=t.select||[[{type:"column",params:["value"]}]],"rawQuery"in this.target||(t.rawQuery="rawSql"in t),this.interpolateQueryStr=this.interpolateQueryStr.bind(this)}return t.$inject=["target","templateSrv","scopedVars"],t.prototype.unquoteIdentifier=function(t){return'"'===t[0]&&'"'===t[t.length-1]?t.substring(1,t.length-1).replace(/""/g,'"'):t},t.prototype.quoteIdentifier=function(t){return'"'+t.replace(/"/g,'""')+'"'},t.prototype.quoteLiteral=function(t){return"'"+t.replace(/'/g,"''")+"'"},t.prototype.escapeLiteral=function(t){return String(t).replace(/'/g,"''")},t.prototype.hasTimeGroup=function(){return i.a.find(this.target.group,function(t){return"time"===t.type})},t.prototype.hasMetricColumn=function(){return"none"!==this.target.metricColumn},t.prototype.interpolateQueryStr=function(t,e,r){return e.multi||e.includeAll?"string"==typeof t?this.quoteLiteral(t):i.a.map(t,this.quoteLiteral).join(","):this.escapeLiteral(t)},t.prototype.render=function(t){var e=this.target;return this.target.rawQuery||"table"in this.target?(e.rawQuery||(e.rawSql=this.buildQuery()),t?this.templateSrv.replace(e.rawSql,this.scopedVars,this.interpolateQueryStr):e.rawSql):""},t.prototype.hasUnixEpochTimecolumn=function(){return["int","bigint","double"].indexOf(this.target.timeColumnType)>-1},t.prototype.buildTimeColumn=function(t){void 0===t&&(t=!0);var e,r=this.hasTimeGroup(),a="$__timeGroup";if(r){var n=void 0;n=r.params.length>1&&"none"!==r.params[1]?r.params.join(","):r.params[0],this.hasUnixEpochTimecolumn()&&(a="$__unixEpochGroup"),t&&(a+="Alias"),e=a+"("+this.target.timeColumn+","+n+")"}else e=this.target.timeColumn,t&&(e+=' AS "time"');return e},t.prototype.buildMetricColumn=function(){return this.hasMetricColumn()?this.target.metricColumn+" AS metric":""},t.prototype.buildValueColumns=function(){var t,e,r="";try{for(var n=Object(a.__values)(this.target.select),i=n.next();!i.done;i=n.next()){var s=i.value;r+=",\n  "+this.buildValueColumn(s)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return r},t.prototype.buildValueColumn=function(t){var e="";e=i.a.find(t,function(t){return"column"===t.type}).params[0];var r=i.a.find(t,function(t){return"aggregate"===t.type});r&&(e=r.params[0]+"("+e+")");var a=i.a.find(t,function(t){return"alias"===t.type});return a&&(e+=" AS "+this.quoteIdentifier(a.params[0])),e},t.prototype.buildWhereClause=function(){var t=this,e="",r=i.a.map(this.target.where,function(e,r){switch(e.type){case"macro":return e.name+"("+t.target.timeColumn+")";case"expression":return e.params.join(" ")}});return r.length>0&&(e="\nWHERE\n  "+r.join(" AND\n  ")),e},t.prototype.buildGroupClause=function(){for(var t="",e="",r=0;r<this.target.group.length;r++){var a=this.target.group[r];r>0&&(e+=", "),"time"===a.type?e+="1":e+=a.params[0]}return e.length&&(t="\nGROUP BY "+e,this.hasMetricColumn()&&(t+=",2")),t},t.prototype.buildQuery=function(){var t="SELECT";return t+="\n  "+this.buildTimeColumn(),this.hasMetricColumn()&&(t+=",\n  "+this.buildMetricColumn()),t+=this.buildValueColumns(),t+="\nFROM "+this.target.table,t+=this.buildWhereClause(),t+=this.buildGroupClause(),t+="\nORDER BY "+this.buildTimeColumn(!1)},t}(),u=r("4qJB"),l=function(){function t(t,e,r,a,n){var u=this;this.backendSrv=e,this.$q=r,this.templateSrv=a,this.timeSrv=n,this.interpolateVariable=function(t,e){return"string"==typeof t?e.multi||e.includeAll?u.queryModel.quoteLiteral(t):t:"number"==typeof t?t:i.a.map(t,function(t){return u.queryModel.quoteLiteral(t)}).join(",")},this.name=t.name,this.id=t.id,this.responseParser=new s(this.$q),this.queryModel=new o({}),this.interval=(t.jsonData||{}).timeInterval||"1m"}return t.$inject=["instanceSettings","backendSrv","$q","templateSrv","timeSrv"],t.prototype.interpolateVariablesInQueries=function(t){var e=this,r=t;return t&&t.length>0&&(r=t.map(function(t){return Object(a.__assign)(Object(a.__assign)({},t),{datasource:e.name,rawSql:e.templateSrv.replace(t.rawSql,{},e.interpolateVariable)})})),r},t.prototype.query=function(t){var e=this,r=i.a.filter(t.targets,function(t){return!0!==t.hide}).map(function(r){var a=new o(r,e.templateSrv,t.scopedVars);return{refId:r.refId,intervalMs:t.intervalMs,maxDataPoints:t.maxDataPoints,datasourceId:e.id,rawSql:a.render(e.interpolateVariable),format:r.format}});return 0===r.length?this.$q.when({data:[]}):this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:{from:t.range.from.valueOf().toString(),to:t.range.to.valueOf().toString(),queries:r}}).then(this.responseParser.processQueryResult)},t.prototype.annotationQuery=function(t){var e=this;if(!t.annotation.rawQuery)return this.$q.reject({message:"Query missing in annotation definition"});var r={refId:t.annotation.name,datasourceId:this.id,rawSql:this.templateSrv.replace(t.annotation.rawQuery,t.scopedVars,this.interpolateVariable),format:"table"};return this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:{from:t.range.from.valueOf().toString(),to:t.range.to.valueOf().toString(),queries:[r]}}).then(function(r){return e.responseParser.transformAnnotationResponse(t,r)})},t.prototype.metricFindQuery=function(t,e){var r=this,a="tempvar";e&&e.variable&&e.variable.name&&(a=e.variable.name);var n=this.templateSrv.replace(t,Object(u.g)({query:t,wildcardChar:"%",options:e}),this.interpolateVariable),i={refId:a,datasourceId:this.id,rawSql:n,format:"table"},s=this.timeSrv.timeRange(),o={queries:[i],from:s.from.valueOf().toString(),to:s.to.valueOf().toString()};return e&&e.range&&e.range.from&&(o.from=e.range.from.valueOf().toString()),e&&e.range&&e.range.to&&(o.to=e.range.to.valueOf().toString()),this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:o}).then(function(t){return r.responseParser.parseMetricFindQueryResult(a,t)})},t.prototype.testDatasource=function(){return this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:{from:"5m",to:"now",queries:[{refId:"A",intervalMs:1,maxDataPoints:1,datasourceId:this.id,rawSql:"SELECT 1",format:"table"}]}}).then(function(t){return{status:"success",message:"Database Connection OK"}}).catch(function(t){return console.log(t),t.data&&t.data.message?{status:"error",message:t.data.message}:{status:"error",message:t.status}})},t.prototype.targetContainsTemplate=function(t){var e="";t.rawQuery?e=t.rawSql:e=new o(t).buildQuery();return e=e.replace("$__",""),this.templateSrv.variableExists(e)},t}(),m=r("Xmxp"),c=function(){function t(t,e){this.target=t,this.queryModel=e}return t.prototype.getOperators=function(t){switch(t){case"double":case"float":return["=","!=","<","<=",">",">="];case"text":case"tinytext":case"mediumtext":case"longtext":case"varchar":case"char":return["=","!=","<","<=",">",">=","IN","NOT IN","LIKE","NOT LIKE"];default:return["=","!=","<","<=",">",">=","IN","NOT IN"]}},t.prototype.quoteIdentAsLiteral=function(t){return this.queryModel.quoteLiteral(this.queryModel.unquoteIdentifier(t))},t.prototype.findMetricTable=function(){return"\n  SELECT\n    table_name as table_name,\n    ( SELECT\n        column_name as column_name\n      FROM information_schema.columns c\n      WHERE\n        c.table_schema = t.table_schema AND\n        c.table_name = t.table_name AND\n        c.data_type IN ('timestamp', 'datetime')\n      ORDER BY ordinal_position LIMIT 1\n    ) AS time_column,\n    ( SELECT\n        column_name AS column_name\n      FROM information_schema.columns c\n      WHERE\n        c.table_schema = t.table_schema AND\n        c.table_name = t.table_name AND\n        c.data_type IN('float', 'int', 'bigint')\n      ORDER BY ordinal_position LIMIT 1\n    ) AS value_column\n  FROM information_schema.tables t\n  WHERE\n    t.table_schema = database() AND\n    EXISTS\n    ( SELECT 1\n      FROM information_schema.columns c\n      WHERE\n        c.table_schema = t.table_schema AND\n        c.table_name = t.table_name AND\n        c.data_type IN ('timestamp', 'datetime')\n    ) AND\n    EXISTS\n    ( SELECT 1\n      FROM information_schema.columns c\n      WHERE\n        c.table_schema = t.table_schema AND\n        c.table_name = t.table_name AND\n        c.data_type IN('float', 'int', 'bigint')\n    )\n  LIMIT 1\n;"},t.prototype.buildTableConstraint=function(t){var e="";if(t.includes(".")){var r=t.split(".");return e="table_schema = "+this.quoteIdentAsLiteral(r[0]),e+=" AND table_name = "+this.quoteIdentAsLiteral(r[1])}return e="table_schema = database() AND table_name = "+this.quoteIdentAsLiteral(t)},t.prototype.buildTableQuery=function(){return"SELECT table_name FROM information_schema.tables WHERE table_schema = database() ORDER BY table_name"},t.prototype.buildColumnQuery=function(t){var e="SELECT column_name FROM information_schema.columns WHERE ";switch(e+=this.buildTableConstraint(this.target.table),t){case"time":e+=" AND data_type IN ('timestamp','datetime','bigint','int','double','float')";break;case"metric":e+=" AND data_type IN ('text','tinytext','mediumtext','longtext','varchar','char')";break;case"value":e+=" AND data_type IN ('bigint','int','smallint','mediumint','tinyint','double','decimal','float')",e+=" AND column_name <> "+this.quoteIdentAsLiteral(this.target.timeColumn);break;case"group":e+=" AND data_type IN ('text','tinytext','mediumtext','longtext','varchar','char')"}return e+=" ORDER BY column_name"},t.prototype.buildValueQuery=function(t){var e="SELECT DISTINCT QUOTE("+t+")";return e+=" FROM "+this.target.table,e+=" WHERE $__timeFilter("+this.target.timeColumn+")",e+=" ORDER BY 1 LIMIT 100"},t.prototype.buildDatatypeQuery=function(t){var e="\nSELECT data_type\nFROM information_schema.columns\nWHERE ";return e+=" table_name = "+this.quoteIdentAsLiteral(this.target.table),e+=" AND column_name = "+this.quoteIdentAsLiteral(t)},t}(),p=r("LzXI"),h=r("XXK+"),d=[];function f(t){d[t.type]=new h.b(t)}f({type:"column",style:"label",params:[{type:"column",dynamicLookup:!0}],defaultParams:["value"]}),f({type:"expression",style:"expression",label:"Expr:",params:[{name:"left",type:"string",dynamicLookup:!0},{name:"op",type:"string",dynamicLookup:!0},{name:"right",type:"string",dynamicLookup:!0}],defaultParams:["value","=","value"]}),f({type:"macro",style:"label",label:"Macro:",params:[],defaultParams:[]}),f({type:"aggregate",style:"label",params:[{name:"name",type:"string",options:["avg","count","min","max","sum","stddev","variance"]}],defaultParams:["avg"]}),f({type:"alias",style:"label",params:[{name:"name",type:"string",quote:"double"}],defaultParams:["alias"]}),f({type:"time",style:"function",label:"time",params:[{name:"interval",type:"interval",options:["$__interval","1s","10s","1m","5m","10m","15m","1h"]},{name:"fill",type:"string",options:["none","NULL","previous","0"]}],defaultParams:["$__interval","none"]});var y={create:function(t){var e=d[t.type];return e?new h.a(t,e):null}},g=r("GQ3c"),v=r("Obii"),b="SELECT\n  UNIX_TIMESTAMP(<time_column>) as time_sec,\n  <value column> as value,\n  <series name column> as metric\nFROM <table name>\nWHERE $__timeFilter(time_column)\nORDER BY <time_column> ASC\n",S=function(t){function e(e,r,a,n,i){var s=t.call(this,e,r)||this;return s.templateSrv=a,s.$q=n,s.uiSegmentSrv=i,s.target=s.target,s.queryModel=new o(s.target,a,s.panel.scopedVars),s.metaBuilder=new c(s.target,s.queryModel),s.updateProjection(),s.formats=[{text:"Time series",value:"time_series"},{text:"Table",value:"table"}],s.target.rawSql||("table"===s.panelCtrl.panel.type?(s.target.format="table",s.target.rawSql="SELECT 1",s.target.rawQuery=!0):(s.target.rawSql=b,s.datasource.metricFindQuery(s.metaBuilder.findMetricTable()).then(function(t){if(t.length>0){s.target.table=t[0].text;var e=s.uiSegmentSrv.newSegment(s.target.table);s.tableSegment.html=e.html,s.tableSegment.value=e.value,s.target.timeColumn=t[1].text,e=s.uiSegmentSrv.newSegment(s.target.timeColumn),s.timeColumnSegment.html=e.html,s.timeColumnSegment.value=e.value,s.target.timeColumnType="timestamp",s.target.select=[[{type:"column",params:[t[2].text]}]],s.updateProjection(),s.updateRawSqlAndRefresh()}}))),s.target.table?s.tableSegment=i.newSegment(s.target.table):s.tableSegment=i.newSegment({value:"select table",fake:!0}),s.timeColumnSegment=i.newSegment(s.target.timeColumn),s.metricColumnSegment=i.newSegment(s.target.metricColumn),s.buildSelectMenu(),s.whereAdd=s.uiSegmentSrv.newPlusButton(),s.groupAdd=s.uiSegmentSrv.newPlusButton(),s.panelCtrl.events.on(v.PanelEvents.dataReceived,s.onDataReceived.bind(s),e),s.panelCtrl.events.on(v.PanelEvents.dataError,s.onDataError.bind(s),e),s}return e.$inject=["$scope","$injector","templateSrv","$q","uiSegmentSrv"],Object(a.__extends)(e,t),e.prototype.updateRawSqlAndRefresh=function(){this.target.rawQuery||(this.target.rawSql=this.queryModel.buildQuery()),this.panelCtrl.refresh()},e.prototype.updateProjection=function(){this.selectParts=i.a.map(this.target.select,function(t){return i.a.map(t,y.create).filter(function(t){return t})}),this.whereParts=i.a.map(this.target.where,y.create).filter(function(t){return t}),this.groupParts=i.a.map(this.target.group,y.create).filter(function(t){return t})},e.prototype.updatePersistedParts=function(){this.target.select=i.a.map(this.selectParts,function(t){return i.a.map(t,function(t){return{type:t.def.type,datatype:t.datatype,params:t.params}})}),this.target.where=i.a.map(this.whereParts,function(t){return{type:t.def.type,datatype:t.datatype,name:t.name,params:t.params}}),this.target.group=i.a.map(this.groupParts,function(t){return{type:t.def.type,datatype:t.datatype,params:t.params}})},e.prototype.buildSelectMenu=function(){this.selectMenu=[];this.selectMenu.push({text:"Aggregate Functions",value:"aggregate",submenu:[{text:"Average",value:"avg"},{text:"Count",value:"count"},{text:"Maximum",value:"max"},{text:"Minimum",value:"min"},{text:"Sum",value:"sum"},{text:"Standard deviation",value:"stddev"},{text:"Variance",value:"variance"}]}),this.selectMenu.push({text:"Alias",value:"alias"}),this.selectMenu.push({text:"Column",value:"column"})},e.prototype.toggleEditorMode=function(){var t=this;this.target.rawQuery?m.b.emit(g.CoreEvents.showConfirmModal,{title:"Warning",text2:"Switching to query builder may overwrite your raw SQL.",icon:"fa-exclamation",yesText:"Switch",onConfirm:function(){t.target.rawQuery=!t.target.rawQuery}}):this.target.rawQuery=!this.target.rawQuery},e.prototype.resetPlusButton=function(t){var e=this.uiSegmentSrv.newPlusButton();t.html=e.html,t.value=e.value},e.prototype.getTableSegments=function(){return this.datasource.metricFindQuery(this.metaBuilder.buildTableQuery()).then(this.transformToSegments({})).catch(this.handleQueryError.bind(this))},e.prototype.tableChanged=function(){var t=this;this.target.table=this.tableSegment.value,this.target.where=[],this.target.group=[],this.updateProjection();var e=this.uiSegmentSrv.newSegment("none");this.metricColumnSegment.html=e.html,this.metricColumnSegment.value=e.value,this.target.metricColumn="none";var r=this.datasource.metricFindQuery(this.metaBuilder.buildColumnQuery("time")).then(function(e){if(e.length>0&&!i.a.find(e,function(e){return e.text===t.target.timeColumn})){var r=t.uiSegmentSrv.newSegment(e[0].text);t.timeColumnSegment.html=r.html,t.timeColumnSegment.value=r.value}return t.timeColumnChanged(!1)}),a=this.datasource.metricFindQuery(this.metaBuilder.buildColumnQuery("value")).then(function(e){e.length>0&&(t.target.select=[[{type:"column",params:[e[0].text]}]],t.updateProjection())});this.$q.all([r,a]).then(function(){t.updateRawSqlAndRefresh()})},e.prototype.getTimeColumnSegments=function(){return this.datasource.metricFindQuery(this.metaBuilder.buildColumnQuery("time")).then(this.transformToSegments({})).catch(this.handleQueryError.bind(this))},e.prototype.timeColumnChanged=function(t){var e=this;return this.target.timeColumn=this.timeColumnSegment.value,this.datasource.metricFindQuery(this.metaBuilder.buildDatatypeQuery(this.target.timeColumn)).then(function(r){if(1===r.length){e.target.timeColumnType!==r[0].text&&(e.target.timeColumnType=r[0].text);var a=void 0;a=e.queryModel.hasUnixEpochTimecolumn()?y.create({type:"macro",name:"$__unixEpochFilter",params:[]}):y.create({type:"macro",name:"$__timeFilter",params:[]}),e.whereParts.length>=1&&"macro"===e.whereParts[0].def.type?e.whereParts[0]=a:e.whereParts.splice(0,0,a)}e.updatePersistedParts(),!1!==t&&e.updateRawSqlAndRefresh()})},e.prototype.getMetricColumnSegments=function(){return this.datasource.metricFindQuery(this.metaBuilder.buildColumnQuery("metric")).then(this.transformToSegments({addNone:!0})).catch(this.handleQueryError.bind(this))},e.prototype.metricColumnChanged=function(){this.target.metricColumn=this.metricColumnSegment.value,this.updateRawSqlAndRefresh()},e.prototype.onDataReceived=function(t){this.lastQueryMeta=null,this.lastQueryError=null;var e=i.a.find(t,{refId:this.target.refId});e&&(this.lastQueryMeta=e.meta)},e.prototype.onDataError=function(t){if(t.data&&t.data.results){var e=t.data.results[this.target.refId];e&&(this.lastQueryMeta=e.meta,this.lastQueryError=e.error)}},e.prototype.transformToSegments=function(t){var e=this;return function(r){var n,s,o=i.a.map(r,function(t){return e.uiSegmentSrv.newSegment({value:t.text,expandable:t.expandable})});if(t.addTemplateVars)try{for(var u=Object(a.__values)(e.templateSrv.variables),l=u.next();!l.done;l=u.next()){var m=l.value,c=void 0;c="$"+m.name,t.templateQuoter&&!1===m.multi&&(c=t.templateQuoter(c)),o.unshift(e.uiSegmentSrv.newSegment({type:"template",value:c,expandable:!0}))}}catch(t){n={error:t}}finally{try{l&&!l.done&&(s=u.return)&&s.call(u)}finally{if(n)throw n.error}}return t.addNone&&o.unshift(e.uiSegmentSrv.newSegment({type:"template",value:"none",expandable:!0})),o}},e.prototype.findAggregateIndex=function(t){return i.a.findIndex(t,function(t){return"aggregate"===t.def.type||"percentile"===t.def.type})},e.prototype.findWindowIndex=function(t){return i.a.findIndex(t,function(t){return"window"===t.def.type||"moving_window"===t.def.type})},e.prototype.addSelectPart=function(t,e,r){var a=e.value;r&&r.type&&(a=r.type);var n=y.create({type:a});r&&(n.params[0]=r.value);var s=!1;switch(a){case"column":var o=i.a.map(t,function(t){return y.create({type:t.def.type,params:i.a.clone(t.params)})});this.selectParts.push(o);break;case"percentile":case"aggregate":0===this.target.group.length&&this.addGroup("time","$__interval");var u=this.findAggregateIndex(t);-1!==u?t[u]=n:t.splice(1,0,n),i.a.find(t,function(t){return"alias"===t.def.type})||(s=!0);break;case"moving_window":case"window":var l=this.findWindowIndex(t);if(-1!==l)t[l]=n;else{var m=this.findAggregateIndex(t);-1!==m?t.splice(m+1,0,n):t.splice(1,0,n)}i.a.find(t,function(t){return"alias"===t.def.type})||(s=!0);break;case"alias":s=!0}s&&(n=y.create({type:"alias",params:[t[0].params[0].replace(/"/g,"")]}),"alias"===t[t.length-1].def.type?t[t.length-1]=n:t.push(n)),this.updatePersistedParts(),this.updateRawSqlAndRefresh()},e.prototype.removeSelectPart=function(t,e){if("column"===e.def.type){if(this.selectParts.length>1){var r=i.a.indexOf(this.selectParts,t);this.selectParts.splice(r,1)}}else{var a=i.a.indexOf(t,e);t.splice(a,1)}this.updatePersistedParts()},e.prototype.handleSelectPartEvent=function(t,e,r){switch(r.name){case"get-param-options":switch(e.def.type){case"column":return this.datasource.metricFindQuery(this.metaBuilder.buildColumnQuery("value")).then(this.transformToSegments({})).catch(this.handleQueryError.bind(this))}case"part-param-changed":this.updatePersistedParts(),this.updateRawSqlAndRefresh();break;case"action":this.removeSelectPart(t,e),this.updateRawSqlAndRefresh();break;case"get-part-actions":return this.$q.when([{text:"Remove",value:"remove-part"}])}},e.prototype.handleGroupPartEvent=function(t,e,r){switch(r.name){case"get-param-options":return this.datasource.metricFindQuery(this.metaBuilder.buildColumnQuery()).then(this.transformToSegments({})).catch(this.handleQueryError.bind(this));case"part-param-changed":this.updatePersistedParts(),this.updateRawSqlAndRefresh();break;case"action":this.removeGroup(t,e),this.updateRawSqlAndRefresh();break;case"get-part-actions":return this.$q.when([{text:"Remove",value:"remove-part"}])}},e.prototype.addGroup=function(t,e){var r,n,i=[e];"time"===t&&(i=["$__interval","none"]);var s=y.create({type:t,params:i});"time"===t?this.groupParts.splice(0,0,s):this.groupParts.push(s);try{for(var o=Object(a.__values)(this.selectParts),u=o.next();!u.done;u=o.next()){var l=u.value;if(!l.some(function(t){return"aggregate"===t.def.type})){var m=y.create({type:"aggregate",params:["avg"]});if(l.splice(1,0,m),!l.some(function(t){return"alias"===t.def.type})){var c=y.create({type:"alias",params:[l[0].part.params[0]]});l.push(c)}}}}catch(t){r={error:t}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}this.updatePersistedParts()},e.prototype.removeGroup=function(t,e){"time"===t.def.type&&(this.selectParts=i.a.map(this.selectParts,function(t){return i.a.filter(t,function(t){return"aggregate"!==t.def.type&&"percentile"!==t.def.type})})),this.groupParts.splice(e,1),this.updatePersistedParts()},e.prototype.handleWherePartEvent=function(t,e,r,a){var n=this;switch(r.name){case"get-param-options":switch(r.param.name){case"left":return this.datasource.metricFindQuery(this.metaBuilder.buildColumnQuery()).then(this.transformToSegments({})).catch(this.handleQueryError.bind(this));case"right":return["int","bigint","double","datetime"].indexOf(e.datatype)>-1?this.$q.when([]):this.datasource.metricFindQuery(this.metaBuilder.buildValueQuery(e.params[0])).then(this.transformToSegments({addTemplateVars:!0,templateQuoter:function(t){return n.queryModel.quoteLiteral(t)}})).catch(this.handleQueryError.bind(this));case"op":return this.$q.when(this.uiSegmentSrv.newOperators(this.metaBuilder.getOperators(e.datatype)));default:return this.$q.when([])}case"part-param-changed":this.updatePersistedParts(),this.datasource.metricFindQuery(this.metaBuilder.buildDatatypeQuery(e.params[0])).then(function(t){1===t.length&&(e.datatype=t[0].text)}),this.updateRawSqlAndRefresh();break;case"action":t.splice(a,1),this.updatePersistedParts(),this.updateRawSqlAndRefresh();break;case"get-part-actions":return this.$q.when([{text:"Remove",value:"remove-part"}])}},e.prototype.getWhereOptions=function(){var t=[];return this.queryModel.hasUnixEpochTimecolumn()?t.push(this.uiSegmentSrv.newSegment({type:"macro",value:"$__unixEpochFilter"})):t.push(this.uiSegmentSrv.newSegment({type:"macro",value:"$__timeFilter"})),t.push(this.uiSegmentSrv.newSegment({type:"expression",value:"Expression"})),this.$q.when(t)},e.prototype.addWhereAction=function(t,e){switch(this.whereAdd.type){case"macro":var r=y.create({type:"macro",name:this.whereAdd.value,params:[]});this.whereParts.length>=1&&"macro"===this.whereParts[0].def.type?this.whereParts[0]=r:this.whereParts.splice(0,0,r);break;default:this.whereParts.push(y.create({type:"expression",params:["value","=","value"]}))}this.updatePersistedParts(),this.resetPlusButton(this.whereAdd),this.updateRawSqlAndRefresh()},e.prototype.getGroupOptions=function(){var t=this;return this.datasource.metricFindQuery(this.metaBuilder.buildColumnQuery("group")).then(function(e){var r,n,i=[];t.queryModel.hasTimeGroup()||i.push(t.uiSegmentSrv.newSegment({type:"time",value:"time($__interval,none)"}));try{for(var s=Object(a.__values)(e),o=s.next();!o.done;o=s.next()){var u=o.value;i.push(t.uiSegmentSrv.newSegment({type:"column",value:u.text}))}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i}).catch(this.handleQueryError.bind(this))},e.prototype.addGroupAction=function(){this.groupAdd.value,this.addGroup(this.groupAdd.type,this.groupAdd.value),this.resetPlusButton(this.groupAdd),this.updateRawSqlAndRefresh()},e.prototype.handleQueryError=function(t){return this.error=t.message||"Failed to issue metric query",[]},e.templateUrl="partials/query.editor.html",e}(p.QueryCtrl),w=r("QjE0");r.d(e,"ConfigCtrl",function(){return _}),r.d(e,"AnnotationsQueryCtrl",function(){return x}),r.d(e,"MysqlDatasource",function(){return l}),r.d(e,"Datasource",function(){return l}),r.d(e,"QueryCtrl",function(){return S});var _=function(){function t(){this.onPasswordReset=Object(w.c)(this,w.a.Password),this.onPasswordChange=Object(w.b)(this,w.a.Password)}return t.templateUrl="partials/config.html",t}(),C="SELECT\n    UNIX_TIMESTAMP(<time_column>) as time_sec,\n    <text_column> as text,\n    <tags_column> as tags\n  FROM <table name>\n  WHERE $__timeFilter(time_column)\n  ORDER BY <time_column> ASC\n  LIMIT 100\n  ",x=function(){function t(){this.annotation.rawQuery=this.annotation.rawQuery||C}return t.templateUrl="partials/annotations.editor.html",t}()}}]);
//# sourceMappingURL=mysqlPlugin.5d0a2c90becb1849160c.js.map