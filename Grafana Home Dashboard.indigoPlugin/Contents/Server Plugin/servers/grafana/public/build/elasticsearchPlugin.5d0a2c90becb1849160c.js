(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{EnIS:function(e,t,r){"use strict";r.r(t);var i=r("Obii"),a=r("mrSG"),n=r("KHwQ"),s=r.n(n),o=r("LvDl"),l=r.n(o),u=r("wEtz"),g=[{text:"Count",value:"count",requiresField:!1},{text:"Average",value:"avg",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0},{text:"Sum",value:"sum",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0},{text:"Max",value:"max",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0},{text:"Min",value:"min",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0},{text:"Extended Stats",value:"extended_stats",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0},{text:"Percentiles",value:"percentiles",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0},{text:"Unique Count",value:"cardinality",requiresField:!0,supportsMissing:!0},{text:"Moving Average",value:"moving_avg",requiresField:!1,isPipelineAgg:!0,minVersion:2},{text:"Derivative",value:"derivative",requiresField:!1,isPipelineAgg:!0,minVersion:2},{text:"Bucket Script",value:"bucket_script",requiresField:!1,isPipelineAgg:!0,supportsMultipleBucketPaths:!0,minVersion:2},{text:"Raw Document",value:"raw_document",requiresField:!1},{text:"Logs",value:"logs",requiresField:!1}],c=[{text:"Terms",value:"terms",requiresField:!0},{text:"Filters",value:"filters"},{text:"Geo Hash Grid",value:"geohash_grid",requiresField:!0},{text:"Date Histogram",value:"date_histogram",requiresField:!0},{text:"Histogram",value:"histogram",requiresField:!0}],d=[{text:"Doc Count",value:"_count"},{text:"Term value",value:"_term"}],p=[{text:"Top",value:"desc"},{text:"Bottom",value:"asc"}],f=[{text:"No limit",value:"0"},{text:"1",value:"1"},{text:"2",value:"2"},{text:"3",value:"3"},{text:"5",value:"5"},{text:"10",value:"10"},{text:"15",value:"15"},{text:"20",value:"20"}],m=[{text:"Avg",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Sum",value:"sum"},{text:"Count",value:"count"},{text:"Std Dev",value:"std_deviation"},{text:"Std Dev Upper",value:"std_deviation_bounds_upper"},{text:"Std Dev Lower",value:"std_deviation_bounds_lower"}],h=[{text:"auto",value:"auto"},{text:"10s",value:"10s"},{text:"1m",value:"1m"},{text:"5m",value:"5m"},{text:"10m",value:"10m"},{text:"20m",value:"20m"},{text:"1h",value:"1h"},{text:"1d",value:"1d"}],v=[{text:"Simple",value:"simple"},{text:"Linear",value:"linear"},{text:"Exponentially Weighted",value:"ewma"},{text:"Holt Linear",value:"holt"},{text:"Holt Winters",value:"holt_winters"}],y={moving_avg:[{text:"window",default:5},{text:"model",default:"simple"},{text:"predict",default:void 0},{text:"minimize",default:!1}],derivative:[{text:"unit",default:void 0}],bucket_script:[]},_={simple:[],linear:[],ewma:[{text:"Alpha",value:"alpha",default:void 0}],holt:[{text:"Alpha",value:"alpha",default:void 0},{text:"Beta",value:"beta",default:void 0}],holt_winters:[{text:"Alpha",value:"alpha",default:void 0},{text:"Beta",value:"beta",default:void 0},{text:"Gamma",value:"gamma",default:void 0},{text:"Period",value:"period",default:void 0},{text:"Pad",value:"pad",default:void 0,isCheckbox:!0}]};function b(e){return l.a.filter(g,function(t){return!t.minVersion||t.minVersion<=e})}function x(e){if(e){var t=y[e];return null!=t}return!1}function F(e){return!!e&&void 0!==g.find(function(t){return t.value===e&&t.supportsMultipleBucketPaths})}function k(e,t){var r=[];return t?(l.a.each(_[e],function(e){e.isCheckbox||r.push(e)}),r):_[e]}function O(e){var t=l.a.find(g,{value:e.type});return t.requiresField||x(e.type)?t.text+" "+e.field:t.text}var q=function(e,t){return l.a.find(e,{id:t})};function S(e,t){return e&&e.metrics&&e.metrics.some(function(e){return e.type===t})}var w=r("iZOS"),j=function(){function e(e,t){this.targets=e,this.response=t,this.targets=e,this.response=t}return e.prototype.processMetrics=function(e,t,r,i){var a,n,s,o,l,u;for(n=0;n<t.metrics.length;n++)if(!(a=t.metrics[n]).hide)switch(a.type){case"count":for(o={datapoints:[],metric:"count",props:i},s=0;s<e.buckets.length;s++)u=(l=e.buckets[s]).doc_count,o.datapoints.push([u,l.key]);r.push(o);break;case"percentiles":if(0===e.buckets.length)break;var g=e.buckets[0][a.id].values;for(var c in g){for(o={datapoints:[],metric:"p"+c,props:i,field:a.field},s=0;s<e.buckets.length;s++){var d=(l=e.buckets[s])[a.id].values;o.datapoints.push([d[c],l.key])}r.push(o)}break;case"extended_stats":for(var p in a.meta)if(a.meta[p]){for(o={datapoints:[],metric:p,props:i,field:a.field},s=0;s<e.buckets.length;s++){var f=(l=e.buckets[s])[a.id];f.std_deviation_bounds_upper=f.std_deviation_bounds.upper,f.std_deviation_bounds_lower=f.std_deviation_bounds.lower,o.datapoints.push([f[p],l.key])}r.push(o)}break;default:for(o={datapoints:[],metric:a.type,field:a.field,metricId:a.id,props:i},s=0;s<e.buckets.length;s++)void 0!==(u=(l=e.buckets[s])[a.id])&&(u.normalized_value?o.datapoints.push([u.normalized_value,l.key]):o.datapoints.push([u.value,l.key]));r.push(o)}},e.prototype.processAggregationDocs=function(e,t,r,i,n){var s,o,u,g,c,d,p,f;if(0===i.columns.length){try{for(var m=Object(a.__values)(l.a.keys(n)),h=m.next();!h.done;h=m.next()){var v=h.value;i.addColumn({text:v,filterable:!0})}}catch(e){s={error:e}}finally{try{h&&!h.done&&(o=m.return)&&o.call(m)}finally{if(s)throw s.error}}i.addColumn({text:t.field,filterable:!0})}var y=function(e,t,r){i.addColumn({text:t}),e.push(r)};try{for(var _=Object(a.__values)(e.buckets),b=_.next();!b.done;b=_.next()){var x=b.value,F=[];try{for(var k=(c=void 0,Object(a.__values)(l.a.values(n))),O=k.next();!O.done;O=k.next()){var q=O.value;F.push(q)}}catch(e){c={error:e}}finally{try{O&&!O.done&&(d=k.return)&&d.call(k)}finally{if(c)throw c.error}}F.push(x.key);try{for(var S=(p=void 0,Object(a.__values)(r.metrics)),w=S.next();!w.done;w=S.next()){var j=w.value;switch(j.type){case"count":y(F,this.getMetricName(j.type),x.doc_count);break;case"extended_stats":for(var A in j.meta)if(j.meta[A]){var E=x[j.id];E.std_deviation_bounds_upper=E.std_deviation_bounds.upper,E.std_deviation_bounds_lower=E.std_deviation_bounds.lower,y(F,this.getMetricName(A),E[A])}break;case"percentiles":var C=x[j.id].values;for(var M in C)y(F,"p"+M+" "+j.field,C[M]);break;default:var T=this.getMetricName(j.type);l.a.filter(r.metrics,{type:j.type}).length>1&&(T+=" "+j.field),y(F,T,x[j.id].value)}}}catch(e){p={error:e}}finally{try{w&&!w.done&&(f=S.return)&&f.call(S)}finally{if(p)throw p.error}}i.rows.push(F)}}catch(e){u={error:e}}finally{try{b&&!b.done&&(g=_.return)&&g.call(_)}finally{if(u)throw u.error}}},e.prototype.processBuckets=function(e,t,r,i,a,n){var s,o,u,g,c=t.bucketAggs.length-1;for(g in e)if(o=l.a.find(t.bucketAggs,{id:g}),u=e[g],o)if(n===c)"date_histogram"===o.type?this.processMetrics(u,t,r,a):this.processAggregationDocs(u,o,t,i,a);else for(var d in u.buckets)s=u.buckets[d],a=l.a.clone(a),void 0!==s.key?a[o.field]=s.key:a.filter=d,s.key_as_string&&(a[o.field]=s.key_as_string),this.processBuckets(s,t,r,i,a,n+1)},e.prototype.getMetricName=function(e){var t=l.a.find(g,{value:e});return t||(t=l.a.find(m,{value:e})),t?t.text:e},e.prototype.getSeriesName=function(e,t,r){var i,n,s=this.getMetricName(e.metric);if(t.alias){return t.alias.replace(/\{\{([\s\S]+?)\}\}/g,function(t,r,i){var a=r||i;return 0===a.indexOf("term ")?e.props[a.substring(5)]:void 0!==e.props[a]?e.props[a]:"metric"===a?s:"field"===a?e.field||"":t})}if(e.field&&x(e.metric))if(e.metric&&F(e.metric)){var o=l.a.find(t.metrics,{id:e.metricId});if(o&&o.settings.script){s=o.settings.script;try{for(var u=Object(a.__values)(o.pipelineVariables),g=u.next();!g.done;g=u.next()){var c=g.value;(d=l.a.find(t.metrics,{id:c.pipelineAgg}))&&(s=s.replace("params."+c.name,O(d)))}}catch(e){i={error:e}}finally{try{g&&!g.done&&(n=u.return)&&n.call(u)}finally{if(i)throw i.error}}}else s="Unset"}else{var d;(d=l.a.find(t.metrics,{id:e.field}))?s+=" "+O(d):s="Unset"}else e.field&&(s+=" "+e.field);if(0===l.a.keys(e.props).length)return s;var p="";for(var f in e.props)p+=e.props[f]+" ";return 1===r?p.trim():p.trim()+" "+s},e.prototype.nameSeries=function(e,t){for(var r=l.a.uniq(l.a.map(e,"metric")).length,i=0;i<e.length;i++){var a=e[i];a.target=this.getSeriesName(a,t,r)}},e.prototype.processHits=function(e,t){var r,i,a,n,s={target:"docs",type:"docs",datapoints:[],total:"number"==typeof e.total?e.total:e.total.value,filterable:!0};for(n=0;n<e.hits.length;n++){if(a={_id:(i=e.hits[n])._id,_type:i._type,_index:i._index},i._source)for(r in i._source)a[r]=i._source[r];for(r in i.fields)a[r]=i.fields[r];s.datapoints.push(a)}t.push(s)},e.prototype.trimDatapoints=function(e,t){var r=l.a.find(t.bucketAggs,{type:"date_histogram"});if(r&&r.settings&&r.settings.trimEdges){var i=r.settings.trimEdges;for(var a in e){var n=e[a];n.datapoints.length>2*i&&(n.datapoints=n.datapoints.slice(i,n.datapoints.length-i))}}},e.prototype.getErrorFromElasticResponse=function(e,t){var r={};return r.data=JSON.stringify(t,null,4),t.root_cause&&t.root_cause.length>0&&t.root_cause[0].reason?r.message=t.root_cause[0].reason:r.message=t.reason||"Unkown elastic error response",e.$$config&&(r.config=e.$$config),r},e.prototype.getTimeSeries=function(){for(var e=[],t=0;t<this.response.responses.length;t++){var r=this.response.responses[t];if(r.error)throw this.getErrorFromElasticResponse(this.response,r.error);if(r.hits&&r.hits.hits.length>0&&this.processHits(r.hits,e),r.aggregations){var i=r.aggregations,a=this.targets[t],n=[],s=new w.a;this.processBuckets(i,a,n,s,{},0),this.trimDatapoints(n,a),this.nameSeries(n,a);for(var o=0;o<n.length;o++)e.push(n[o]);s.rows.length>0&&e.push(s)}}return{data:e}},e.prototype.getLogs=function(e,t){for(var r,n,s,o,l=[],g=[],c=0;c<this.response.responses.length;c++){var d=this.response.responses[c];if(d.error)throw this.getErrorFromElasticResponse(this.response,d.error);var p=d.hits,f=[],m=void 0,h=void 0,v=void 0,y=void 0;for(y=0;y<p.hits.length;y++){var _=(h=p.hits[y])._source?Object(u.default)(h._source,null):{};for(m in(v={})[this.targets[0].timeField]=null,v=Object(a.__assign)(Object(a.__assign)(Object(a.__assign)({},v),{_id:h._id,_type:h._type,_index:h._index}),_),h.fields)-1===f.indexOf(m)&&f.push(m),v[m]=h.fields[m];for(m in v)-1===f.indexOf(m)&&f.push(m);v._source=Object(a.__assign)({},_),g.push(v)}if(g.length>0){f=f.sort(),(M=new i.MutableDataFrame({fields:[]})).addField({name:this.targets[0].timeField,type:i.FieldType.time}).parse=function(e){return e[0]||""},e?M.addField({name:e,type:i.FieldType.string}).parse=function(e){return e||""}:M.addField({name:"_source",type:i.FieldType.string}).parse=function(e){return JSON.stringify(e,null,2)},t&&(M.addField({name:"level",type:i.FieldType.string}).parse=function(e){return e||""});try{for(var b=(r=void 0,Object(a.__values)(f)),x=b.next();!x.done;x=b.next()){var F=x.value;F!==this.targets[0].timeField&&"_source"!==F&&(M.addField({name:F,type:i.FieldType.string}).parse=function(e){return e||""})}}catch(e){r={error:e}}finally{try{x&&!x.done&&(n=b.return)&&n.call(b)}finally{if(r)throw r.error}}try{for(var k=(s=void 0,Object(a.__values)(g)),O=k.next();!O.done;O=k.next()){var q=O.value;M.add(q)}}catch(e){s={error:e}}finally{try{O&&!O.done&&(o=k.return)&&o.call(k)}finally{if(s)throw s.error}}l.push(M)}if(d.aggregations){var S=d.aggregations,j=this.targets[c],A=[],E=new w.a;this.processBuckets(S,j,A,E,{},0),this.trimDatapoints(A,j),this.nameSeries(A,j);for(var C=0;C<A.length;C++){var M=Object(i.toDataFrame)(A[C]);l.push(M)}}}return{data:l}},e}(),A={Hourly:{startOf:"hour",amount:"hours"},Daily:{startOf:"day",amount:"days"},Weekly:{startOf:"isoWeek",amount:"weeks"},Monthly:{startOf:"month",amount:"months"},Yearly:{startOf:"year",amount:"years"}},E=function(){function e(e,t){this.pattern=e,this.interval=t}return e.prototype.getIndexForToday=function(){return this.interval?Object(i.toUtc)().format(this.pattern):this.pattern},e.prototype.getIndexList=function(e,t){if(!this.interval)return this.pattern;for(var r=A[this.interval],a=Object(i.dateTime)(e).utc().startOf(r.startOf),n=Object(i.dateTime)(t).utc().startOf(r.startOf).valueOf(),s=[];a.valueOf()<=n;)s.push(a.format(this.pattern)),a.add(1,r.amount);return s},e}(),C=function(){function e(e){this.timeField=e.timeField,this.esVersion=e.esVersion}return e.prototype.getRangeFilter=function(){var e={};return e[this.timeField]={gte:"$timeFrom",lte:"$timeTo",format:"epoch_millis"},e},e.prototype.buildTermsAgg=function(e,t,r){var i,a,n;if(t.terms={field:e.field},!e.settings)return t;if(t.terms.size=0===parseInt(e.settings.size,10)?500:parseInt(e.settings.size,10),void 0!==e.settings.orderBy&&(t.terms.order={},"_term"===e.settings.orderBy&&this.esVersion>=60?t.terms.order._key=e.settings.order:t.terms.order[e.settings.orderBy]=e.settings.order,i=parseInt(e.settings.orderBy,10),!isNaN(i)))for(n=0;n<r.metrics.length;n++)if((a=r.metrics[n]).id===e.settings.orderBy){t.aggs={},t.aggs[a.id]={},t.aggs[a.id][a.type]={field:a.field};break}return void 0!==e.settings.min_doc_count&&(t.terms.min_doc_count=parseInt(e.settings.min_doc_count,10)),e.settings.missing&&(t.terms.missing=e.settings.missing),t},e.prototype.getDateHistogramAgg=function(e){var t={},r=e.settings||{};return t.interval=r.interval,t.field=this.timeField,t.min_doc_count=r.min_doc_count||0,t.extended_bounds={min:"$timeFrom",max:"$timeTo"},t.format="epoch_millis",""!==r.offset&&(t.offset=r.offset),"auto"===t.interval&&(t.interval="$__interval"),r.missing&&(t.missing=r.missing),t},e.prototype.getHistogramAgg=function(e){var t={},r=e.settings||{};return t.interval=r.interval,t.field=e.field,t.min_doc_count=r.min_doc_count||0,r.missing&&(t.missing=r.missing),t},e.prototype.getFiltersAgg=function(e){for(var t={},r=0;r<e.settings.filters.length;r++){var i=e.settings.filters[r].query,a=e.settings.filters[r].label;t[a=""===a||void 0===a?i:a]={query_string:{query:i,analyze_wildcard:!0}}}return t},e.prototype.documentQuery=function(e,t){return e.size=t,e.sort={},e.sort[this.timeField]={order:"desc",unmapped_type:"boolean"},this.esVersion<5&&(e.fields=["*","_source"]),e.script_fields={},this.esVersion<5?e.fielddata_fields=[this.timeField]:e.docvalue_fields=[this.timeField],e},e.prototype.addAdhocFilters=function(e,t){var r,i,a,n;if(t)for(r=0;r<t.length;r++)switch((a={})[(i=t[r]).key]=i.value,(n={})[i.key]={query:i.value},i.operator){case"=":e.query.bool.must||(e.query.bool.must=[]),e.query.bool.must.push({match_phrase:n});break;case"!=":e.query.bool.must_not||(e.query.bool.must_not=[]),e.query.bool.must_not.push({match_phrase:n});break;case"<":a[i.key]={lt:i.value},e.query.bool.filter.push({range:a});break;case">":a[i.key]={gt:i.value},e.query.bool.filter.push({range:a});break;case"=~":e.query.bool.filter.push({regexp:a});break;case"!~":e.query.bool.filter.push({bool:{must_not:{regexp:a}}})}},e.prototype.build=function(e,t,r){var i,a,n,s,o;e.metrics=e.metrics||[{type:"count",id:"1"}],e.bucketAggs=e.bucketAggs||[{type:"date_histogram",id:"2",settings:{interval:"auto"}}],e.timeField=this.timeField;var l={size:0,query:{bool:{filter:[{range:this.getRangeFilter()},{query_string:{analyze_wildcard:!0,query:r}}]}}};if(this.addAdhocFilters(l,t),0===e.bucketAggs.length){if(!(o=e.metrics[0])||"raw_document"!==o.type)throw{message:"Invalid query"};var u=o.settings&&o.settings.size||500;return this.documentQuery(l,u)}for(s=l,i=0;i<e.bucketAggs.length;i++){var g=e.bucketAggs[i],c={};switch(g.type){case"date_histogram":c.date_histogram=this.getDateHistogramAgg(g);break;case"histogram":c.histogram=this.getHistogramAgg(g);break;case"filters":c.filters={filters:this.getFiltersAgg(g)};break;case"terms":this.buildTermsAgg(g,c,e);break;case"geohash_grid":c.geohash_grid={field:g.field,precision:g.settings.precision}}s.aggs=s.aggs||{},s.aggs[g.id]=c,s=c}for(s.aggs={},i=0;i<e.metrics.length;i++)if("count"!==(o=e.metrics[i]).type){var d={},p=null;if(x(o.type))if(F(o.type)){if(!o.pipelineVariables)continue;for(p={buckets_path:{}},a=0;a<o.pipelineVariables.length;a++){if((n=o.pipelineVariables[a]).name&&n.pipelineAgg&&/^\d*$/.test(n.pipelineAgg))(f=q(e.metrics,n.pipelineAgg))&&("count"===f.type?p.buckets_path[n.name]="_count":p.buckets_path[n.name]=n.pipelineAgg)}}else{if(!o.pipelineAgg||!/^\d*$/.test(o.pipelineAgg))continue;var f;(f=q(e.metrics,o.pipelineAgg))&&(p="count"===f.type?{buckets_path:"_count"}:{buckets_path:o.pipelineAgg})}else p={field:o.field};for(var m in o.settings)o.settings.hasOwnProperty(m)&&null!==o.settings[m]&&(p[m]=o.settings[m]);d[o.type]=p,s.aggs[o.id]=d}return l},e.prototype.getTermsQuery=function(e){var t={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};e.query&&t.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:e.query}});var r=500;e.size&&(r=e.size),t.aggs={1:{terms:{field:e.field,size:r,order:{}}}};var i=e.orderBy,a=void 0===i?"key":i,n=e.order,s=void 0===n?"doc_count"===a?"desc":"asc":n;if(["asc","desc"].indexOf(s)<0)throw{message:"Invalid query sort order "+s};switch(a){case"key":case"term":var o=this.esVersion>=60?"_key":"_term";t.aggs[1].terms.order[o]=s;break;case"doc_count":t.aggs[1].terms.order._count=s;break;default:throw{message:"Invalid query sort type "+a}}return t},e.prototype.getLogsQuery=function(e,t){var r={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};return e.query&&r.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:e.query}}),r=this.documentQuery(r,500),Object(a.__assign)(Object(a.__assign)({},r),{aggs:this.build(e,null,t).aggs})},e}(),M=function(e){function t(t,r,i,a,n){var s=e.call(this,t)||this;s.$q=r,s.backendSrv=i,s.templateSrv=a,s.timeSrv=n,s.basicAuth=t.basicAuth,s.withCredentials=t.withCredentials,s.url=t.url,s.name=t.name,s.index=t.database;var o=t.jsonData||{};return s.timeField=o.timeField,s.esVersion=o.esVersion,s.indexPattern=new E(s.index,o.interval),s.interval=o.timeInterval,s.maxConcurrentShardRequests=o.maxConcurrentShardRequests,s.queryBuilder=new C({timeField:s.timeField,esVersion:s.esVersion}),s.logMessageField=o.logMessageField||"",s.logLevelField=o.logLevelField||"",""===s.logMessageField&&(s.logMessageField=null),""===s.logLevelField&&(s.logLevelField=null),s}return t.$inject=["instanceSettings","$q","backendSrv","templateSrv","timeSrv"],Object(a.__extends)(t,e),t.prototype.request=function(e,t,r){var i={url:this.url+"/"+t,method:e,data:r};return(this.basicAuth||this.withCredentials)&&(i.withCredentials=!0),this.basicAuth&&(i.headers={Authorization:this.basicAuth}),this.backendSrv.datasourceRequest(i)},t.prototype.get=function(e){var t=this.timeSrv.timeRange(),r=this.indexPattern.getIndexList(t.from.valueOf(),t.to.valueOf());return l.a.isArray(r)&&r.length?this.request("GET",r[0]+e).then(function(e){return e.data.$$config=e.config,e.data}):this.request("GET",this.indexPattern.getIndexForToday()+e).then(function(e){return e.data.$$config=e.config,e.data})},t.prototype.post=function(e,t){return this.request("POST",e,t).then(function(e){return e.data.$$config=e.config,e.data}).catch(function(e){if(e.data&&e.data.error)throw{message:"Elasticsearch error: "+e.data.error.reason,error:e.data.error};throw e})},t.prototype.annotationQuery=function(e){var t=e.annotation,r=t.timeField||"@timestamp",a=t.timeEndField||null,n=t.query||"*",o=t.tagsField||"tags",u=t.textField||null,g=[],c={};if(c[r]={from:e.range.from.valueOf(),to:e.range.to.valueOf(),format:"epoch_millis"},g.push({range:c}),a){var d={};d[a]={from:e.range.from.valueOf(),to:e.range.to.valueOf(),format:"epoch_millis"},g.push({range:d})}var p={query:{bool:{filter:[{bool:{should:g,minimum_should_match:1}},{query_string:{query:this.templateSrv.replace(n,{},"lucene")}}]}},size:1e4};this.esVersion<5&&(p.fields=[r,"_source"]);var f={search_type:"query_then_fetch",ignore_unavailable:!0};t.index?f.index=t.index:f.index=this.indexPattern.getIndexList(e.range.from,e.range.to);var m=s.a.toJson(f)+"\n"+s.a.toJson(p)+"\n";return this.post("_msearch",m).then(function(e){for(var n=[],s=e.responses[0].hits.hits,g=function(e,t){if(t){for(var r=t.split("."),i=e,a=0;a<r.length;a++)if(!(i=i[r[a]]))return console.log("could not find field in annotation: ",t),"";return i}},c=0;c<s.length;c++){var d=s[c]._source,p=g(d,r);if(void 0!==s[c].fields){var f=s[c].fields;(l.a.isString(f[r])||l.a.isNumber(f[r]))&&(p=f[r])}var m={annotation:t,time:Object(i.toUtc)(p).valueOf(),text:g(d,u),tags:g(d,o)};if(a){var h=g(d,a);h&&(m.timeEnd=Object(i.toUtc)(h).valueOf())}if(t.titleField){var v=g(d,t.titleField);v&&(m.text=v+"\n"+m.text)}"string"==typeof m.tags&&(m.tags=m.tags.split(",")),n.push(m)}return n})},t.prototype.interpolateVariablesInQueries=function(e){var t=this,r=e;return e&&e.length>0&&(r=e.map(function(e){return Object(a.__assign)(Object(a.__assign)({},e),{datasource:t.name,query:t.templateSrv.replace(e.query,{},"lucene")})})),r},t.prototype.testDatasource=function(){var e=this;return this.getFields({type:"date"}).then(function(t){return l.a.find(t,{text:e.timeField})?{status:"success",message:"Index OK. Time field name OK."}:{status:"error",message:"No date field named "+e.timeField+" found"}},function(e){if(console.log(e),e.data&&e.data.error){var t=s.a.toJson(e.data.error);return e.data.error.reason&&(t=e.data.error.reason),{status:"error",message:t}}return{status:"error",message:e.status}})},t.prototype.getQueryHeader=function(e,t,r){var i={search_type:e,ignore_unavailable:!0,index:this.indexPattern.getIndexList(t,r)};return this.esVersion>=56&&this.esVersion<70&&(i.max_concurrent_shard_requests=this.maxConcurrentShardRequests),s.a.toJson(i)},t.prototype.query=function(e){var t,r,i=this,n="",o=l.a.cloneDeep(e.targets),u=[],g=this.templateSrv.getAdhocFilters(this.name);try{for(var c=Object(a.__values)(o),d=c.next();!d.done;d=c.next()){var p=d.value;if(!p.hide){var f=this.templateSrv.replace(p.query,e.scopedVars,"lucene");f&&""!==f||(f="*");var m=void 0;p.isLogsQuery||S(p,"logs")?(p.bucketAggs=[{type:"date_histogram",id:"2",settings:{interval:"auto"}}],p.metrics=[{type:"count",id:"1"}],p.isLogsQuery=!0,m=this.queryBuilder.getLogsQuery(p,f)):(p.alias&&(p.alias=this.templateSrv.replace(p.alias,e.scopedVars,"lucene")),m=this.queryBuilder.build(p,g,f));var h=s.a.toJson(m),v=0===m.size&&this.esVersion<5?"count":"query_then_fetch";n+=this.getQueryHeader(v,e.range.from,e.range.to)+"\n",n+=h+"\n",u.push(p)}}}catch(e){t={error:e}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}if(0===u.length)return Promise.resolve({data:[]});n=(n=n.replace(/\$timeFrom/g,e.range.from.valueOf().toString())).replace(/\$timeTo/g,e.range.to.valueOf().toString()),n=this.templateSrv.replace(n,e.scopedVars);var y=this.getMultiSearchUrl();return this.post(y,n).then(function(e){var t=new j(u,e);return u.some(function(e){return e.isLogsQuery})?t.getLogs(i.logMessageField,i.logLevelField):t.getTimeSeries()})},t.prototype.getFields=function(e){var t=this.esVersion;return this.get("/_mapping").then(function(r){var i={float:"number",double:"number",integer:"number",long:"number",date:"date",string:"string",text:"string",scaled_float:"number",nested:"nested"};function a(e,t,r){return"_"!==t[0]&&(!r.type||(r.type===e.type||r.type===i[e.type]))}var n=[],s={};function o(t){for(var r in t){var i=t[r];if(l.a.isObject(i.properties)&&(n.push(r),o(i.properties)),l.a.isObject(i.fields)&&(n.push(r),o(i.fields)),l.a.isString(i.type)){var u=n.concat(r).join(".");a(i,r,e)&&(s[u]={text:u,type:i.type})}}n.pop()}for(var u in r){var g=r[u];if(g&&g.mappings){var c=g.mappings;if(t<70)for(var d in c){o(c[d].properties)}else o(c.properties)}}return l.a.map(s,function(e){return e})})},t.prototype.getTerms=function(e){var t=this.timeSrv.timeRange(),r=this.esVersion>=5?"query_then_fetch":"count",i=this.getQueryHeader(r,t.from,t.to),a=s.a.toJson(this.queryBuilder.getTermsQuery(e));a=i+"\n"+(a=(a=a.replace(/\$timeFrom/g,t.from.valueOf().toString())).replace(/\$timeTo/g,t.to.valueOf().toString()))+"\n";var n=this.getMultiSearchUrl();return this.post(n,a).then(function(e){if(!e.responses[0].aggregations)return[];var t=e.responses[0].aggregations[1].buckets;return l.a.map(t,function(e){return{text:e.key_as_string||e.key,value:e.key}})})},t.prototype.getMultiSearchUrl=function(){return this.esVersion>=70&&this.maxConcurrentShardRequests?"_msearch?max_concurrent_shard_requests="+this.maxConcurrentShardRequests:"_msearch"},t.prototype.metricFindQuery=function(e){return(e=s.a.fromJson(e))?"fields"===e.find?(e.field=this.templateSrv.replace(e.field,{},"lucene"),this.getFields(e)):"terms"===e.find?(e.field=this.templateSrv.replace(e.field,{},"lucene"),e.query=this.templateSrv.replace(e.query||"*",{},"lucene"),this.getTerms(e)):void 0:this.$q.when([])},t.prototype.getTagKeys=function(){return this.getFields({})},t.prototype.getTagValues=function(e){return this.getTerms({field:e.key,query:"*"})},t.prototype.targetContainsTemplate=function(e){var t,r,i,n;if(this.templateSrv.variableExists(e.query)||this.templateSrv.variableExists(e.alias))return!0;try{for(var s=Object(a.__values)(e.bucketAggs),o=s.next();!o.done;o=s.next()){var l=o.value;if(this.templateSrv.variableExists(l.field)||this.objectContainsTemplate(l.settings))return!0}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}try{for(var u=Object(a.__values)(e.metrics),g=u.next();!g.done;g=u.next()){var c=g.value;if(this.templateSrv.variableExists(c.field)||this.objectContainsTemplate(c.settings)||this.objectContainsTemplate(c.meta))return!0}}catch(e){i={error:e}}finally{try{g&&!g.done&&(n=u.return)&&n.call(u)}finally{if(i)throw i.error}}return!1},t.prototype.isPrimitive=function(e){return null==e||!!["string","number","boolean"].some(function(e){return e===typeof!0})},t.prototype.objectContainsTemplate=function(e){var t,r,i,n;if(!e)return!1;try{for(var s=Object(a.__values)(Object.keys(e)),o=s.next();!o.done;o=s.next()){var l=o.value;if(this.isPrimitive(e[l])){if(this.templateSrv.variableExists(e[l]))return!0}else if(Array.isArray(e[l]))try{for(var u=(i=void 0,Object(a.__values)(e[l])),g=u.next();!g.done;g=u.next()){var c=g.value;if(this.objectContainsTemplate(c))return!0}}catch(e){i={error:e}}finally{try{g&&!g.done&&(n=u.return)&&n.call(u)}finally{if(i)throw i.error}}else if(this.objectContainsTemplate(e[l]))return!0}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return!1},t}(i.DataSourceApi),T=r("txxJ"),D=r("GQ3c"),V=function(){function e(e,t,r,i){var a=e.target.bucketAggs;e.orderByOptions=[],e.getBucketAggTypes=function(){return c},e.getOrderOptions=function(){return p},e.getSizeOptions=function(){return f},i.onAppEvent(D.CoreEvents.elasticQueryUpdated,function(){e.validateModel()},e),e.init=function(){e.agg=a[e.index],e.validateModel()},e.onChangeInternal=function(){e.onChange()},e.onTypeChanged=function(){switch(e.agg.settings={},e.showOptions=!1,e.agg.type){case"date_histogram":case"histogram":case"terms":delete e.agg.query,e.agg.field="select field";break;case"filters":delete e.agg.field,e.agg.query="*";break;case"geohash_grid":e.agg.settings.precision=3}e.validateModel(),e.onChange()},e.validateModel=function(){e.index=l.a.indexOf(a,e.agg),e.isFirst=0===e.index,e.bucketAggCount=a.length;var t,r="",i=e.agg.settings||{};switch(e.agg.type){case"terms":i.order=i.order||"desc",i.size=i.size||"10",i.min_doc_count=i.min_doc_count||1,i.orderBy=i.orderBy||"_term","0"!==i.size&&(t=i.order,r=l.a.find(p,{value:t}).text+" "+i.size+", "),i.min_doc_count>0&&(r+="Min Doc Count: "+i.min_doc_count+", "),r+="Order by: "+function(e,t){var r=l.a.find(d,{value:e});if(r)return r.text;var i=l.a.find(t.metrics,{id:e});return i?O(i):"metric not found"}(i.orderBy,e.target),"0"===i.size&&(r+=" ("+i.order+")");break;case"filters":i.filters=i.filters||[{query:"*"}],(r=l.a.reduce(i.filters,function(e,t,r){return e+="Q"+(r+1)+"  = "+t.query+" "},"")).length>50&&(r=r.substr(0,50)+"..."),r="Filter Queries ("+i.filters.length+")";break;case"date_histogram":i.interval=i.interval||"auto",i.min_doc_count=i.min_doc_count||0,e.agg.field=e.target.timeField,r="Interval: "+i.interval,i.min_doc_count>0&&(r+=", Min Doc Count: "+i.min_doc_count),(void 0===i.trimEdges||i.trimEdges<0)&&(i.trimEdges=0),i.trimEdges&&i.trimEdges>0&&(r+=", Trim edges: "+i.trimEdges);break;case"histogram":i.interval=i.interval||1e3,i.min_doc_count=l.a.defaultTo(i.min_doc_count,1),r="Interval: "+i.interval,i.min_doc_count>0&&(r+=", Min Doc Count: "+i.min_doc_count);break;case"geohash_grid":i.precision=Math.max(Math.min(i.precision,7),1),r="Precision: "+i.precision}return e.settingsLinkText=r,e.agg.settings=i,!0},e.addFiltersQuery=function(){e.agg.settings.filters.push({query:"*"})},e.removeFiltersQuery=function(t){e.agg.settings.filters=l.a.without(e.agg.settings.filters,t)},e.toggleOptions=function(){e.showOptions=!e.showOptions},e.getOrderByOptions=function(){return t=e.target,r=[],l.a.each(t.metrics,function(e){"count"!==e.type&&r.push({text:O(e),value:e.id})}),d.concat(r);var t,r},e.getFieldsInternal=function(){return"date_histogram"===e.agg.type?e.getFields({$fieldType:"date"}):e.getFields()},e.getIntervalOptions=function(){return r.when(t.transformToSegments(!0,"interval")(h))},e.addBucketAgg=function(){var t=a[a.length-1],r=a.length-1;t&&"date_histogram"===t.type&&(r-=1);var i=l.a.reduce(e.target.bucketAggs.concat(e.target.metrics),function(e,t){return parseInt(t.id,10)>e?parseInt(t.id,10):e},0);a.splice(r,0,{type:"terms",field:"select field",id:(i+1).toString(),fake:!0}),e.onChange()},e.removeBucketAgg=function(){a.splice(e.index,1),e.onChange()},e.init()}return e.$inject=["$scope","uiSegmentSrv","$q","$rootScope"],e}();T.c.directive("elasticBucketAgg",function(){return{templateUrl:"public/app/plugins/datasource/elasticsearch/partials/bucket_agg.html",controller:V,restrict:"E",scope:{target:"=",index:"=",onChange:"&",getFields:"&"}}});var L=function(){function e(e,t,r,i){var a=e.target.metrics;e.metricAggTypes=b(e.esVersion),e.extendedStats=m,e.pipelineAggOptions=[],e.modelSettingsValues={},e.init=function(){e.agg=a[e.index],e.validateModel(),e.updatePipelineAggOptions()},e.updatePipelineAggOptions=function(){var t,r;e.pipelineAggOptions=(t=e.target,r=[],l.a.each(t.metrics,function(e){x(e.type)||r.push({text:O(e),value:e.id})}),r)},i.onAppEvent(D.CoreEvents.elasticQueryUpdated,function(){e.index=l.a.indexOf(a,e.agg),e.updatePipelineAggOptions(),e.validateModel()},e),e.validateModel=function(){if(e.isFirst=0===e.index,e.isSingle=1===a.length,e.settingsLinkText="",e.variablesLinkText="",e.aggDef=l.a.find(e.metricAggTypes,{value:e.agg.type}),x(e.agg.type)){F(e.agg.type)?(e.variablesLinkText="Options",e.agg.settings.script&&(e.variablesLinkText="Script: "+e.agg.settings.script.replace(new RegExp("params.","g"),""))):(e.agg.pipelineAgg=e.agg.pipelineAgg||"select metric",e.agg.field=e.agg.pipelineAgg);var t=x((r=e.agg).type)?y[r.type]:[];t.length>0&&(l.a.each(t,function(t){e.agg.settings[t.text]=e.agg.settings[t.text]||t.default}),e.settingsLinkText="Options")}else e.agg.field||(e.agg.field="select field");var r;switch(e.agg.type){case"cardinality":var i=e.agg.settings.precision_threshold||"";e.settingsLinkText="Precision threshold: "+i;break;case"percentiles":e.agg.settings.percents=e.agg.settings.percents||[25,50,75,95,99],e.settingsLinkText="Values: "+e.agg.settings.percents.join(",");break;case"extended_stats":0===l.a.keys(e.agg.meta).length&&(e.agg.meta.std_deviation_bounds_lower=!0,e.agg.meta.std_deviation_bounds_upper=!0);var n=l.a.reduce(e.agg.meta,function(t,r,i){if(r){var a=l.a.find(e.extendedStats,{value:i});t.push(a.text)}return t},[]);e.settingsLinkText="Stats: "+n.join(", ");break;case"moving_avg":e.movingAvgModelTypes=v,e.modelSettings=k(e.agg.settings.model,!0),e.updateMovingAvgModelSettings();break;case"raw_document":e.agg.settings.size=e.agg.settings.size||500,e.settingsLinkText="Size: "+e.agg.settings.size,e.target.metrics.splice(0,e.target.metrics.length,e.agg),e.target.bucketAggs=[]}if(e.aggDef.supportsInlineScript){var s=e.agg.inlineScript;s?e.agg.settings.script={inline:s}:delete e.agg.settings.script,""===e.settingsLinkText&&(e.settingsLinkText="Options")}},e.toggleOptions=function(){e.showOptions=!e.showOptions,e.updatePipelineAggOptions()},e.toggleVariables=function(){e.showVariables=!e.showVariables},e.onChangeInternal=function(){e.onChange()},e.updateMovingAvgModelSettings=function(){for(var t=[],r=k(e.agg.settings.model,!1),i=0;i<r.length;i++)t.push(r[i].value);for(var a in e.agg.settings.settings)null!==e.agg.settings.settings[a]&&-1!==t.indexOf(a)||delete e.agg.settings.settings[a]},e.onChangeClearInternal=function(){delete e.agg.settings.minimize,e.onChange()},e.onTypeChange=function(){e.agg.settings={},e.agg.meta={},e.showOptions=!1,0===e.target.bucketAggs.length&&"raw_document"!==e.agg.type&&(e.target.bucketAggs=[{type:"date_histogram",id:"2",settings:{interval:"auto"}}]),e.showVariables=F(e.agg.type),e.updatePipelineAggOptions(),e.onChange()},e.getFieldsInternal=function(){return"cardinality"===e.agg.type?e.getFields():e.getFields({$fieldType:"number"})},e.addMetricAgg=function(){var t=a.length,r=l.a.reduce(e.target.bucketAggs.concat(e.target.metrics),function(e,t){return parseInt(t.id,10)>e?parseInt(t.id,10):e},0);a.splice(t,0,{type:"count",field:"select field",id:(r+1).toString()}),e.onChange()},e.removeMetricAgg=function(){a.splice(e.index,1),e.onChange()},e.toggleShowMetric=function(){e.agg.hide=!e.agg.hide,e.agg.hide||delete e.agg.hide,e.onChange()},e.init()}return e.$inject=["$scope","uiSegmentSrv","$q","$rootScope"],e}();T.c.directive("elasticMetricAgg",function(){return{templateUrl:"public/app/plugins/datasource/elasticsearch/partials/metric_agg.html",controller:L,restrict:"E",scope:{target:"=",index:"=",onChange:"&",getFields:"&",esVersion:"="}}});var Q=function(e){return{name:"var"+e,pipelineAgg:"select metric"}},I=function(){function e(e){e.variables=e.variables||[Q(1)],e.onChangeInternal=function(){e.onChange()},e.add=function(){e.variables.push(Q(e.variables.length+1)),e.onChange()},e.remove=function(t){e.variables.splice(t,1),e.onChange()}}return e.$inject=["$scope"],e}();T.c.directive("elasticPipelineVariables",function(){return{templateUrl:"public/app/plugins/datasource/elasticsearch/partials/pipeline_variables.html",controller:"ElasticPipelineVariablesCtrl",restrict:"E",scope:{onChange:"&",variables:"=",options:"="}}}),T.c.controller("ElasticPipelineVariablesCtrl",I);var $=function(e){function t(t,r,i,a){var n=e.call(this,t,r)||this;if(n.$rootScope=i,n.uiSegmentSrv=a,n.esVersion=n.datasource.esVersion,n.target=n.target||{},n.target.metrics=n.target.metrics||[{type:"count",id:"1"}],n.target.bucketAggs=n.target.bucketAggs||[{type:"date_histogram",id:"2",settings:{interval:"auto"}}],0===n.target.bucketAggs.length){var s=n.target.metrics[0];s&&"raw_document"===s.type||(n.target.bucketAggs=[{type:"date_histogram",id:"2",settings:{interval:"auto"}}]),n.refresh()}return n.queryUpdated(),n}return t.$inject=["$scope","$injector","$rootScope","uiSegmentSrv"],Object(a.__extends)(t,e),t.prototype.getFields=function(e){var t=s.a.toJson({find:"fields",type:e});return this.datasource.metricFindQuery(t).then(this.uiSegmentSrv.transformToSegments(!1)).catch(this.handleQueryError.bind(this))},t.prototype.queryUpdated=function(){var e=s.a.toJson(this.datasource.queryBuilder.build(this.target),!0);this.rawQueryOld&&e!==this.rawQueryOld&&this.refresh(),this.rawQueryOld=e,this.$rootScope.appEvent(D.CoreEvents.elasticQueryUpdated)},t.prototype.getCollapsedText=function(){var e=this.target.metrics,t=this.target.bucketAggs,r=b(this.esVersion),i=c,a="";return this.target.query&&(a+="Query: "+this.target.query+", "),a+="Metrics: ",l.a.each(e,function(e,t){var i=l.a.find(r,{value:e.type});a+=i.text+"(",i.requiresField&&(a+=e.field),i.supportsMultipleBucketPaths&&(a+=e.settings.script.replace(new RegExp("params.","g"),"")),a+="), "}),l.a.each(t,function(e,t){0===t&&(a+=" Group by: ");var r=l.a.find(i,{value:e.type});a+=r.text+"(",r.requiresField&&(a+=e.field),a+="), "}),this.target.alias&&(a+="Alias: "+this.target.alias),a},t.prototype.handleQueryError=function(e){return this.error=e.message||"Failed to issue metric query",[]},t.templateUrl="partials/query.editor.html",t}(r("LzXI").QueryCtrl),z=r("q1tI"),N=r.n(z),P=r("kDLi"),B=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.onChangeQuery=function(e,t){var r=i.props,n=r.query,s=r.onChange,o=r.onRunQuery;s&&(s(Object(a.__assign)(Object(a.__assign)({},n),{query:e,isLogsQuery:!0})),t&&o&&o())},i.plugins=[Object(P.SlatePrism)({onlyIn:function(e){return"code_block"===e.type},getSyntax:function(e){return"lucene"}})],i.state={syntaxLoaded:!1},i}return Object(a.__extends)(t,e),t.prototype.componentDidMount=function(){this.props.query.isLogsQuery||this.onChangeQuery("",!0)},t.prototype.componentWillUnmount=function(){},t.prototype.componentDidUpdate=function(e){this.props.query.isLogsQuery||this.onChangeQuery("",!0)},t.prototype.render=function(){var e=this.props,t=e.data,r=e.query,i=this.state.syntaxLoaded;return N.a.createElement(N.a.Fragment,null,N.a.createElement("div",{className:"gf-form-inline gf-form-inline--nowrap"},N.a.createElement("div",{className:"gf-form gf-form--grow flex-shrink-1"},N.a.createElement(P.QueryField,{additionalPlugins:this.plugins,query:r.query,onChange:this.onChangeQuery,onRunQuery:this.props.onRunQuery,placeholder:"Enter a Lucene query",portalOrigin:"elasticsearch",syntaxLoaded:i}))),t&&t.error?N.a.createElement("div",{className:"prom-query-field-info text-error"},t.error.message):null)},t}(N.a.PureComponent),R=[{label:"No pattern",value:"none"},{label:"Hourly",value:"Hourly",example:"[logstash-]YYYY.MM.DD.HH"},{label:"Daily",value:"Daily",example:"[logstash-]YYYY.MM.DD"},{label:"Weekly",value:"Weekly",example:"[logstash-]GGGG.WW"},{label:"Monthly",value:"Monthly",example:"[logstash-]YYYY.MM"},{label:"Yearly",value:"Yearly",example:"[logstash-]YYYY"}],U=[{label:"2.x",value:2},{label:"5.x",value:5},{label:"5.6+",value:56},{label:"6.0+",value:60},{label:"7.0+",value:70}],H=function(e){var t,r=e.value,i=e.onChange;return N.a.createElement(N.a.Fragment,null,N.a.createElement("h3",{className:"page-heading"},"Elasticsearch details"),N.a.createElement("div",{className:"gf-form-group"},N.a.createElement("div",{className:"gf-form-inline"},N.a.createElement("div",{className:"gf-form max-width-25"},N.a.createElement(P.FormField,{labelWidth:10,inputWidth:15,label:"Index name",value:r.database||"",onChange:W("database",r,i),placeholder:"es-index-name",required:!0})),N.a.createElement("div",{className:"gf-form width-14"},N.a.createElement(P.FormField,{labelWidth:10,label:"Pattern",inputEl:N.a.createElement(P.Select,{options:R,onChange:J(r,i),value:R.find(function(e){return e.value===(void 0===r.jsonData.interval?"none":r.jsonData.interval)})})}))),N.a.createElement("div",{className:"gf-form max-width-25"},N.a.createElement(P.FormField,{labelWidth:10,inputWidth:15,label:"Time field name",value:r.jsonData.timeField||"",onChange:Y("timeField",r,i),required:!0})),N.a.createElement("div",{className:"gf-form"},N.a.createElement("span",{className:"gf-form-select-wrapper"},N.a.createElement(P.FormField,{labelWidth:10,label:"Version",inputEl:N.a.createElement(P.Select,{options:U,onChange:function(e){var t=function(e,t){if(5===e&&t<70)return 256;if(256===e&&t>=70)return 5;return e||G(t)}(r.jsonData.maxConcurrentShardRequests,e.value);i(Object(a.__assign)(Object(a.__assign)({},r),{jsonData:Object(a.__assign)(Object(a.__assign)({},r.jsonData),{esVersion:e.value,maxConcurrentShardRequests:t})}))},value:U.find(function(e){return e.value===r.jsonData.esVersion})})}))),r.jsonData.esVersion>=56&&N.a.createElement("div",{className:"gf-form max-width-30"},N.a.createElement(P.FormField,{"aria-label":"Max concurrent Shard Requests input",labelWidth:15,label:"Max concurrent Shard Requests",value:r.jsonData.maxConcurrentShardRequests||"",onChange:Y("maxConcurrentShardRequests",r,i)})),N.a.createElement("div",{className:"gf-form-inline"},N.a.createElement("div",{className:"gf-form"},N.a.createElement(P.FormField,{labelWidth:10,label:"Min time interval",inputEl:N.a.createElement(P.Input,{className:"width-6",value:r.jsonData.timeInterval||"",onChange:Y("timeInterval",r,i),placeholder:"10s",validationEvents:(t={},t[P.EventsWithValidation.onBlur]=[Object(P.regexValidation)(/^\d+(ms|[Mwdhmsy])$/,"Value is not valid, you can use number with time unit specifier: y, M, w, d, h, m, s")],t)}),tooltip:N.a.createElement(N.a.Fragment,null,"A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example ",N.a.createElement("code",null,"1m")," if your data is written every minute.")})))))},W=function(e,t,r){return function(i){var n;r(Object(a.__assign)(Object(a.__assign)({},t),((n={})[e]=i.currentTarget.value,n)))}},Y=function(e,t,r){return function(i){var n;r(Object(a.__assign)(Object(a.__assign)({},t),{jsonData:Object(a.__assign)(Object(a.__assign)({},t.jsonData),(n={},n[e]=i.currentTarget.value,n))}))}},J=function(e,t){return function(r){var i=e.database,n="none"===r.value?void 0:r.value;if(!i||0===i.length||i.startsWith("[logstash-]")){var s="";if(void 0!==n){var o=R.find(function(e){return e.value===n});o&&(s=o.example)}t(Object(a.__assign)(Object(a.__assign)({},e),{database:s,jsonData:Object(a.__assign)(Object(a.__assign)({},e.jsonData),{interval:n})}))}else t(Object(a.__assign)(Object(a.__assign)({},e),{jsonData:Object(a.__assign)(Object(a.__assign)({},e.jsonData),{interval:n})}))}};function G(e){return e>=70?5:256}var K=function(e){var t=e.value,r=e.onChange,i=function(e){return function(i){var n;r(Object(a.__assign)(Object(a.__assign)({},t),((n={})[e]=i.currentTarget.value,n)))}};return N.a.createElement(N.a.Fragment,null,N.a.createElement("h3",{className:"page-heading"},"Logs"),N.a.createElement("div",{className:"gf-form-group"},N.a.createElement("div",{className:"gf-form max-width-30"},N.a.createElement(P.FormField,{labelWidth:11,label:"Message field name",value:t.logMessageField,onChange:i("logMessageField"),placeholder:"_source"})),N.a.createElement("div",{className:"gf-form max-width-30"},N.a.createElement(P.FormField,{labelWidth:11,label:"Level field name",value:t.logLevelField,onChange:i("logLevelField")}))))};r.d(t,"plugin",function(){return Z});var X=function(){function e(){}return e.templateUrl="partials/annotations.editor.html",e}(),Z=new i.DataSourcePlugin(M).setQueryCtrl($).setConfigEditor(function(e){var t=e.options,r=e.onOptionsChange;return Object(z.useEffect)(function(){var e=t.jsonData.esVersion||5;r(Object(a.__assign)(Object(a.__assign)({},t),{jsonData:Object(a.__assign)(Object(a.__assign)({},t.jsonData),{timeField:t.jsonData.timeField||"@timestamp",esVersion:e,maxConcurrentShardRequests:t.jsonData.maxConcurrentShardRequests||G(e),logMessageField:t.jsonData.logMessageField||"",logLevelField:t.jsonData.logLevelField||""})}))},[]),N.a.createElement(N.a.Fragment,null,N.a.createElement(P.DataSourceHttpSettings,{defaultUrl:"http://localhost:9200",dataSourceConfig:t,showAccessOptions:!0,onChange:r}),N.a.createElement(H,{value:t,onChange:r}),N.a.createElement(K,{value:t.jsonData,onChange:function(e){return r(Object(a.__assign)(Object(a.__assign)({},t),{jsonData:e}))}}))}).setExploreLogsQueryField(B).setAnnotationQueryCtrl(X)}}]);
//# sourceMappingURL=elasticsearchPlugin.5d0a2c90becb1849160c.js.map