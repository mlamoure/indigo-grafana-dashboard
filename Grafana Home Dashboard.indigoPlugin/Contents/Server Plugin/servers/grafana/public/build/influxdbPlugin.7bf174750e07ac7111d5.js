(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{sl8e:function(e,t,r){"use strict";r.r(t);var a=r("LvDl"),n=r.n(a),i=r("Obii"),o=r("iZOS");function s(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.series=t.series,this.alias=t.alias,this.annotation=t.annotation,this.meta=t.meta,this.refId=t.refId}var t,r,a;return t=e,(r=[{key:"getTimeSeries",value:function(){var e,t,r=this,a=[];return 0===this.series.length?a:(n.a.each(this.series,(function(i){var o=i.columns.length,s=n.a.map(i.tags,(function(e,t){return t+": "+e}));for(t=1;t<o;t++){var u=i.name,l=i.columns[t];"value"!==l&&(u=u+"."+l),r.alias?u=r._getSeriesName(i,t):i.tags&&(u=u+" {"+s.join(", ")+"}");var c=[];if(i.values)for(e=0;e<i.values.length;e++)c[e]=[i.values[e][t],i.values[e][0]];a.push({target:u,datapoints:c,meta:r.meta,refId:r.refId})}})),a)}},{key:"_getSeriesName",value:function(e,t){var r=e.name.split(".");return this.alias.replace(/\$(\w+)|\[\[([\s\S]+?)\]\]/g,(function(a,n,i){var o=n||i,s=parseInt(o,10);if("m"===o||"measurement"===o)return e.name;if("col"===o)return e.columns[t];if(!isNaN(s))return r[s];if(0!==o.indexOf("tag_"))return a;var u=o.replace("tag_","");return e.tags?e.tags[u]:a}))}},{key:"getAnnotations",value:function(){var e=this,t=[];return n.a.each(this.series,(function(r){var a=null,i=null,o=[],s=null;n.a.each(r.columns,(function(t,r){"time"!==t?"sequence_number"!==t&&(t!==e.annotation.titleColumn?n.a.includes((e.annotation.tagsColumn||"").replace(" ","").split(","),t)?o.push(r):t!==e.annotation.textColumn?a||s===r||(a=r):s=r:a=r):i=r})),n.a.each(r.values,(function(r){var u={annotation:e.annotation,time:+new Date(r[i]),title:r[a],tags:n.a.flatten(o.filter((function(e){return r[e]})).map((function(e){return r[e].split(",")}))),text:r[s]};t.push(u)}))})),t}},{key:"getTable",value:function(){var e,t,r=new o.a;return r.refId=this.refId,r.meta=this.meta,0===this.series.length?r:(n.a.each(this.series,(function(a,o){if(0===o)for(t=0,"time"===a.columns[0]&&(r.columns.push({text:"Time",type:i.FieldType.time}),t++),n.a.each(n.a.keys(a.tags),(function(e){r.columns.push({text:e})}));t<a.columns.length;t++)r.columns.push({text:a.columns[t]});if(a.values)for(e=0;e<a.values.length;e++){var s=a.values[e],u=[s[0]];if(a.tags)for(var l in a.tags)a.tags.hasOwnProperty(l)&&u.push(a.tags[l]);for(t=1;t<s.length;t++)u.push(s[t]);r.rows.push(u)}})),r)}}])&&s(t.prototype,r),a&&s(t,a),e}(),l=r("QNPh"),c=[],m={Aggregations:[],Selectors:[],Transformations:[],Predictors:[],Math:[],Aliasing:[],Fields:[]};function p(e){var t=c[e.type];if(!t)throw{message:"Could not find query part "+e.type};return new l.a(e,t)}function f(e){c[e.type]=new l.b(e),e.category.push(c[e.type])}var g=[];function d(e,t){return"*"===e.params[0]?"*":'"'+e.params[0]+'"'}function h(e,t){for(var r=0;r<e.length;r++){var a=e[r];if(a.def.category===m.Aggregations){if(a.def.type===t.def.type)return;if("count"===a.def.type&&"distinct"===t.def.type)break;if("distinct"===a.def.type){var n=e.length>=r+2;if("count"!==t.def.type&&n)e[r+1].def.category===m.Aggregations&&e.splice(r+1,1);else if("count"===t.def.type)return void(n&&"count"===e[r+1].def.type||e.splice(r+1,0,t))}return void(e[r]=t)}if(a.def.category===m.Selectors)return void(e[r]=t)}e.splice(1,0,t)}function y(e,t){var r;for(r=0;r<e.length;r++){var a=e[r];if(a.def.category===m.Math||a.def.category===m.Aliasing)break}e.splice(r,0,t)}f({type:"field",addStrategy:function(e,t,r){var a=n.a.map(e,(function(e){return p({type:e.def.type,params:n.a.clone(e.params)})}));r.selectModels.push(a)},category:m.Fields,params:[{type:"field",dynamicLookup:!0}],defaultParams:["value"],renderer:d}),f({type:"count",addStrategy:h,category:m.Aggregations,params:[],defaultParams:[],renderer:l.c}),f({type:"distinct",addStrategy:h,category:m.Aggregations,params:[],defaultParams:[],renderer:l.c}),f({type:"integral",addStrategy:h,category:m.Aggregations,params:[],defaultParams:[],renderer:l.c}),f({type:"mean",addStrategy:h,category:m.Aggregations,params:[],defaultParams:[],renderer:l.c}),f({type:"median",addStrategy:h,category:m.Aggregations,params:[],defaultParams:[],renderer:l.c}),f({type:"mode",addStrategy:h,category:m.Aggregations,params:[],defaultParams:[],renderer:l.c}),f({type:"sum",addStrategy:h,category:m.Aggregations,params:[],defaultParams:[],renderer:l.c}),f({type:"derivative",addStrategy:y,category:m.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:l.c}),f({type:"spread",addStrategy:y,category:m.Transformations,params:[],defaultParams:[],renderer:l.c}),f({type:"non_negative_derivative",addStrategy:y,category:m.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:l.c}),f({type:"difference",addStrategy:y,category:m.Transformations,params:[],defaultParams:[],renderer:l.c}),f({type:"non_negative_difference",addStrategy:y,category:m.Transformations,params:[],defaultParams:[],renderer:l.c}),f({type:"moving_average",addStrategy:y,category:m.Transformations,params:[{name:"window",type:"int",options:[5,10,20,30,40]}],defaultParams:[10],renderer:l.c}),f({type:"cumulative_sum",addStrategy:y,category:m.Transformations,params:[],defaultParams:[],renderer:l.c}),f({type:"stddev",addStrategy:y,category:m.Transformations,params:[],defaultParams:[],renderer:l.c}),f({type:"time",category:g,params:[{name:"interval",type:"time",options:["$__interval","1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["$__interval"],renderer:l.c}),f({type:"fill",category:g,params:[{name:"fill",type:"string",options:["none","null","0","previous","linear"]}],defaultParams:["null"],renderer:l.c}),f({type:"elapsed",addStrategy:y,category:m.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:l.c}),f({type:"holt_winters",addStrategy:y,category:m.Predictors,params:[{name:"number",type:"int",options:[5,10,20,30,40]},{name:"season",type:"int",options:[0,1,2,5,10]}],defaultParams:[10,2],renderer:l.c}),f({type:"holt_winters_with_fit",addStrategy:y,category:m.Predictors,params:[{name:"number",type:"int",options:[5,10,20,30,40]},{name:"season",type:"int",options:[0,1,2,5,10]}],defaultParams:[10,2],renderer:l.c}),f({type:"bottom",addStrategy:h,category:m.Selectors,params:[{name:"count",type:"int"}],defaultParams:[3],renderer:l.c}),f({type:"first",addStrategy:h,category:m.Selectors,params:[],defaultParams:[],renderer:l.c}),f({type:"last",addStrategy:h,category:m.Selectors,params:[],defaultParams:[],renderer:l.c}),f({type:"max",addStrategy:h,category:m.Selectors,params:[],defaultParams:[],renderer:l.c}),f({type:"min",addStrategy:h,category:m.Selectors,params:[],defaultParams:[],renderer:l.c}),f({type:"percentile",addStrategy:h,category:m.Selectors,params:[{name:"nth",type:"int"}],defaultParams:[95],renderer:l.c}),f({type:"top",addStrategy:h,category:m.Selectors,params:[{name:"count",type:"int"}],defaultParams:[3],renderer:l.c}),f({type:"tag",category:g,params:[{name:"tag",type:"string",dynamicLookup:!0}],defaultParams:["tag"],renderer:d}),f({type:"math",addStrategy:function(e,t){var r=e.length;if(r>0){if("math"===e[r-1].def.type)return void(e[r-1]=t);if(r>1&&"math"===e[r-2].def.type)return void(e[r-2]=t);if("alias"===e[r-1].def.type)return void e.splice(r-1,0,t)}e.push(t)},category:m.Math,params:[{name:"expr",type:"string"}],defaultParams:[" / 100"],renderer:l.d}),f({type:"alias",addStrategy:function(e,t){var r=e.length;r>0&&"alias"===e[r-1].def.type?e[r-1]=t:e.push(t)},category:m.Aliasing,params:[{name:"name",type:"string",quote:"double"}],defaultParams:["alias"],renderMode:"suffix",renderer:function(e,t){return t+' AS "'+e.params[0]+'"'}});var v={create:p,getCategories:function(){return m},replaceAggregationAdd:h},b=r("PbtU");function S(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var w=function(){function e(t,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=t,this.templateSrv=r,this.scopedVars=a,t.policy=t.policy||"default",t.resultFormat=t.resultFormat||"time_series",t.orderByTime=t.orderByTime||"ASC",t.tags=t.tags||[],t.groupBy=t.groupBy||[{type:"time",params:["$__interval"]},{type:"fill",params:["null"]}],t.select=t.select||[[{type:"field",params:["value"]},{type:"mean",params:[]}]],this.updateProjection()}var t,r,a;return e.$inject=["target","templateSrv","scopedVars"],t=e,(r=[{key:"updateProjection",value:function(){this.selectModels=n.a.map(this.target.select,(function(e){return n.a.map(e,v.create)})),this.groupByParts=n.a.map(this.target.groupBy,v.create)}},{key:"updatePersistedParts",value:function(){this.target.select=n.a.map(this.selectModels,(function(e){return n.a.map(e,(function(e){return{type:e.def.type,params:e.params}}))}))}},{key:"hasGroupByTime",value:function(){return n.a.find(this.target.groupBy,(function(e){return"time"===e.type}))}},{key:"hasFill",value:function(){return n.a.find(this.target.groupBy,(function(e){return"fill"===e.type}))}},{key:"addGroupBy",value:function(e){var t=e.match(/^(\w+)\((.*)\)$/);if(t&&this.target.groupBy){var r=t[1],a=t[2],n=v.create({type:r,params:[a]}),i=this.target.groupBy.length;0===i?this.target.groupBy.push(n.part):"time"===r?this.target.groupBy.splice(0,0,n.part):"tag"===r&&"fill"===this.target.groupBy[i-1].type?this.target.groupBy.splice(i-1,0,n.part):this.target.groupBy.push(n.part),this.updateProjection()}}},{key:"removeGroupByPart",value:function(e,t){var r=v.getCategories();"time"===e.def.type&&(this.target.groupBy=n.a.filter(this.target.groupBy,(function(e){return"fill"!==e.type})),this.target.select=n.a.map(this.target.select,(function(e){return n.a.filter(e,(function(e){var t=v.create(e);return t.def.category!==r.Aggregations&&t.def.category!==r.Selectors}))}))),this.target.groupBy.splice(t,1),this.updateProjection()}},{key:"removeSelect",value:function(e){this.target.select.splice(e,1),this.updateProjection()}},{key:"removeSelectPart",value:function(e,t){if("field"===t.def.type){if(this.selectModels.length>1){var r=n.a.indexOf(this.selectModels,e);this.selectModels.splice(r,1)}}else{var a=n.a.indexOf(e,t);e.splice(a,1)}this.updatePersistedParts()}},{key:"addSelectPart",value:function(e,t){var r=v.create({type:t});r.def.addStrategy(e,r,this),this.updatePersistedParts()}},{key:"renderTagCondition",value:function(e,t,r){var a="",n=e.operator,i=e.value;return t>0&&(a=(e.condition||"AND")+" "),n||(n=/^\/.*\/$/.test(i)?"=~":"="),"=~"!==n&&"!~"!==n?(r&&(i=this.templateSrv.replace(i,this.scopedVars)),">"!==n&&"<"!==n&&(i="'"+i.replace(/\\/g,"\\\\").replace(/\'/g,"\\'")+"'")):r&&(i=this.templateSrv.replace(i,this.scopedVars,"regex")),a+'"'+e.key+'" '+n+" "+i}},{key:"getMeasurementAndPolicy",value:function(e){var t=this.target.policy,r=this.target.measurement||"measurement";return r.match("^/.*/$")?e&&(r=this.templateSrv.replace(r,this.scopedVars,"regex")):r='"'+r+'"',(t="default"!==t?'"'+this.target.policy+'".':"")+r}},{key:"interpolateQueryStr",value:function(e,t,r){return t.multi||t.includeAll?"string"==typeof e?b.a.regexEscape(e):"("+n.a.map(e,b.a.regexEscape).join("|")+")":e}},{key:"render",value:function(e){var t=this,r=this.target;if(r.rawQuery)return e?this.templateSrv.replace(r.query,this.scopedVars,this.interpolateQueryStr):r.query;var a,i,o="SELECT ";for(a=0;a<this.selectModels.length;a++){var s=this.selectModels[a],u="";for(i=0;i<s.length;i++)u=s[i].render(u);a>0&&(o+=", "),o+=u}o+=" FROM "+this.getMeasurementAndPolicy(e)+" WHERE ";var l=n.a.map(r.tags,(function(r,a){return t.renderTagCondition(r,a,e)}));l.length>0&&(o+="("+l.join(" ")+") AND "),o+="$timeFilter";var c="";for(a=0;a<this.groupByParts.length;a++){var m=this.groupByParts[a];a>0&&(c+="fill"===m.def.type?" ":", "),c+=m.render("")}return c.length&&(o+=" GROUP BY "+c),r.fill&&(o+=" fill("+r.fill+")"),"DESC"===r.orderByTime&&(o+=" ORDER BY time DESC"),r.limit&&(o+=" LIMIT "+r.limit),r.slimit&&(o+=" SLIMIT "+r.slimit),r.tz&&(o+=" tz('"+r.tz+"')"),o}},{key:"renderAdhocFilters",value:function(e){var t=this;return n.a.map(e,(function(e,r){return t.renderTagCondition(e,r,!0)})).join(" ")}}])&&S(t.prototype,r),a&&S(t,a),e}();function E(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var O=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,a;return t=e,(r=[{key:"parse",value:function(e,t){if(!t||0===t.results.length)return[];var r=t.results[0];if(!r.series)return[];var a=e.toLowerCase(),i=a.indexOf("show field keys")>=0||a.indexOf("show retention policies")>=0,o={};return n.a.each(r.series,(function(e){n.a.each(e.values,(function(e){n.a.isArray(e)?i?P(o,e[0]):void 0!==e[1]?P(o,e[1]):P(o,e[0]):P(o,e)}))})),n.a.map(o,(function(e){return{text:e.toString()}}))}}])&&E(t.prototype,r),a&&E(t,a),e}();function P(e,t){e[t]=t}function x(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var k,T=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=t,this.database=r}var t,r,a;return t=e,(r=[{key:"buildExploreQuery",value:function(e,t,r){var a,i,o;if("TAG_KEYS"===e)a="SHOW TAG KEYS",i=this.target.measurement,o=this.target.policy;else if("TAG_VALUES"===e)a="SHOW TAG VALUES",i=this.target.measurement,o=this.target.policy;else if("MEASUREMENTS"===e)a="SHOW MEASUREMENTS",r&&(a+=" WITH MEASUREMENT =~ /"+b.a.regexEscape(r)+"/");else{if("FIELDS"===e)return i=this.target.measurement,o=this.target.policy,i.match("^/.*/")||(i='"'+i+'"',o&&"default"!==o&&(i=(o='"'+o+'"')+"."+i)),"SHOW FIELD KEYS FROM "+i;if("RETENTION POLICIES"===e)return a='SHOW RETENTION POLICIES on "'+this.database+'"'}if(i&&(i.match("^/.*/")||i.match(/^merge\(.*\)/)||(i='"'+i+'"'),o&&"default"!==o&&(i=(o='"'+o+'"')+"."+i),a+=" FROM "+i),t&&(a+=' WITH KEY = "'+t+'"'),this.target.tags&&this.target.tags.length>0){var s=n.a.reduce(this.target.tags,(function(e,r){return r.key===t?e:">"===r.operator||"<"===r.operator?e:(e.push(function(e,t){var r="",a=e.operator,n=e.value;return t>0&&(r=(e.condition||"AND")+" "),a||(a=/^\/.*\/$/.test(e.value)?"=~":"="),"=~"!==a&&"!~"!==a&&isNaN(+n)&&(n="'"+n+"'"),r+'"'+e.key+'" '+a+" "+n}(r,e.length)),e)}),[]);s.length>0&&(a+=" WHERE "+s.join(" "))}return"MEASUREMENTS"===e&&(a+=" LIMIT 100"),a}}])&&x(t.prototype,r),a&&x(t,a),e}();!function(e){e.InfluxQL="InfluxQL",e.Flux="Flux"}(k||(k={}));var j=r("t8hP"),C=r("0/uQ");function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t,r,a,n,i,o){try{var s=e[i](o),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(a,n)}function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){B(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function B(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function F(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function R(e,t){return!t||"object"!==I(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function A(e,t,r){return(A="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var a=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=M(e)););return e}(e,t);if(a){var n=Object.getOwnPropertyDescriptor(a,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var q=function(e){function t(e){var r,a,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=R(this,M(t).call(this,e))).type="influxdb",i.urls=n.a.map(e.url.split(","),(function(e){return e.trim()})),i.username=null!==(r=e.username)&&void 0!==r?r:"",i.password=null!==(a=e.password)&&void 0!==a?a:"",i.name=e.name,i.database=e.database,i.basicAuth=e.basicAuth,i.withCredentials=e.withCredentials;var o=e.jsonData||{};return i.interval=o.timeInterval,i.httpMode=o.httpMode||"GET",i.responseParser=new O,i.is2x=o.version===k.Flux,i}var r,a,o,s,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}(t,e),r=t,(a=[{key:"query",value:function(e){return this.is2x?A(M(t.prototype),"query",this).call(this,e):Object(C.a)(this.classicQuery(e))}},{key:"getQueryDisplayText",value:function(e){return this.is2x?e.query:new w(e).render(!1)}},{key:"applyTemplateVariables",value:function(e,t){return N({},e,{query:Object(j.getTemplateSrv)().replace(e.query,t)})}},{key:"classicQuery",value:(s=regeneratorRuntime.mark((function e(t){var r,a,i,o,s,l,c,m,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getTimeFilter(t),a=t.scopedVars,i=n.a.cloneDeep(t.targets),o=[],m=Object(j.getTemplateSrv)(),""!==(p=n.a.map(i,(function(e){return e.hide?"":(o.push(e),a.interval=a.__interval,(s=new w(e,m,a)).render(!0))})).reduce((function(e,t){return""!==t&&(e+=";"+t),e})))){e.next=8;break}return e.abrupt("return",Promise.resolve({data:[]}));case 8:return(f=m.getAdhocFilters(this.name)).length>0&&(r+=" AND "+s.renderAdhocFilters(f)),a.timeFilter={value:r},p=m.replace(p,a),e.abrupt("return",this._seriesQuery(p,t).then((function(e){if(!e||!e.results)return[];var r=[];for(l=0;l<e.results.length;l++){var a=e.results[l];if(a&&a.series){var n=o[l],i=n.alias;i&&(i=m.replace(n.alias,t.scopedVars));var s={executedQueryString:e.executedQueryString},p=new u({refId:n.refId,series:e.results[l].series,alias:i,meta:s});switch(n.resultFormat){case"logs":s.preferredVisualisationType="logs";case"table":r.push(p.getTable());break;default:var f=p.getTimeSeries();for(c=0;c<f.length;c++)r.push(f[c])}}}return{data:r}})));case 13:case"end":return e.stop()}}),e,this)})),l=function(){var e=this,t=arguments;return new Promise((function(r,a){var n=s.apply(e,t);function i(e){D(n,r,a,i,o,"next",e)}function o(e){D(n,r,a,i,o,"throw",e)}i(void 0)}))},function(e){return l.apply(this,arguments)})},{key:"annotationQuery",value:function(e){if(!e.annotation.query)return Promise.reject({message:"Query missing in annotation definition"});var t=this.getTimeFilter({rangeRaw:e.rangeRaw,timezone:e.timezone}),r=e.annotation.query.replace("$timeFilter",t);return r=Object(j.getTemplateSrv)().replace(r,null,"regex"),this._seriesQuery(r,e).then((function(t){if(!t||!t.results||!t.results[0])throw{message:"No results in response from InfluxDB"};return new u({series:t.results[0].series,annotation:e.annotation}).getAnnotations()}))}},{key:"targetContainsTemplate",value:function(e){var t=Object(j.getTemplateSrv)(),r=!0,a=!1,n=void 0;try{for(var i,o=e.groupBy[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var s=i.value,u=!0,l=!1,c=void 0;try{for(var m,p=s.params[Symbol.iterator]();!(u=(m=p.next()).done);u=!0){var f=m.value;if(t.variableExists(f))return!0}}catch(e){l=!0,c=e}finally{try{u||null==p.return||p.return()}finally{if(l)throw c}}}}catch(e){a=!0,n=e}finally{try{r||null==o.return||o.return()}finally{if(a)throw n}}for(var g in e.tags)if(t.variableExists(e.tags[g].value))return!0;return!1}},{key:"interpolateVariablesInQueries",value:function(e,t){var r=this;if(!e||0===e.length)return[];var a=e;if(e&&e.length>0){var n=Object(j.getTemplateSrv)();a=e.map((function(e){var a,i,o,s=N({},e,{datasource:r.name,measurement:n.replace(null!==(a=e.measurement)&&void 0!==a?a:"",t,"regex"),policy:n.replace(null!==(i=e.policy)&&void 0!==i?i:"",t,"regex")});if(e.rawQuery&&(s.query=n.replace(null!==(o=e.query)&&void 0!==o?o:"",t,"regex")),e.tags){var u=e.tags.map((function(e){return N({},e,{value:n.replace(e.value,null,"regex")})}));s.tags=u}return s}))}return a}},{key:"metricFindQuery",value:function(e,t){var r=this,a=Object(j.getTemplateSrv)().replace(e,null,"regex");return this._seriesQuery(a,t).then((function(t){return r.responseParser.parse(e,t)}))}},{key:"getTagKeys",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new T({measurement:e.measurement||"",tags:[]},this.database),r=t.buildExploreQuery("TAG_KEYS");return this.metricFindQuery(r,e)}},{key:"getTagValues",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new T({measurement:e.measurement||"",tags:[]},this.database),r=t.buildExploreQuery("TAG_VALUES",e.key);return this.metricFindQuery(r,e)}},{key:"_seriesQuery",value:function(e,t){if(!e)return Promise.resolve({results:[]});if(t&&t.range){var r=this.getTimeFilter({rangeRaw:t.range,timezone:t.timezone});e=e.replace("$timeFilter",r)}return this._influxRequest(this.httpMode,"/query",{q:e,epoch:"ms"},t)}},{key:"serializeParams",value:function(e){return e?n.a.reduce(e,(function(e,t,r){return null==t?e:(e.push(encodeURIComponent(r)+"="+encodeURIComponent(t)),e)}),[]).join("&"):""}},{key:"testDatasource",value:function(){if(this.is2x){var e={targets:[{refId:"test",query:"buckets()"}],requestId:"".concat(this.id,"-health-").concat(Date.now()),dashboardId:0,panelId:0,interval:"1m",intervalMs:6e4,maxDataPoints:423,range:{from:Object(i.dateTime)(1e3),to:Object(i.dateTime)(2e3)}};return A(M(t.prototype),"query",this).call(this,e).toPromise().then((function(e){if(!e||!e.data||e.state!==i.LoadingState.Done)return console.log("InfluxDB Error",e),{status:"error",message:"Error reading InfluxDB"};var t=e.data[0];return t&&t.length?{status:"success",message:"".concat(t.length," buckets found")}:(console.log("InfluxDB Error",e),{status:"error",message:"Error reading buckets"})})).catch((function(e){return console.log("InfluxDB Error",e),{status:"error",message:e.message}}))}var r=new T({measurement:"",tags:[]},this.database).buildExploreQuery("RETENTION POLICIES");return this._seriesQuery(r).then((function(e){var t=n.a.get(e,"results[0].error");return t?{status:"error",message:t}:{status:"success",message:"Data source is working"}})).catch((function(e){return{status:"error",message:e.message}}))}},{key:"_influxRequest",value:function(e,t,r,a){var i=this.urls.shift();this.urls.push(i);var o={};this.username&&(o.u=this.username,o.p=this.password),a&&a.database?o.db=a.database:this.database&&(o.db=this.database);var s=r.q;"POST"===e&&n.a.has(r,"q")?(n.a.extend(o,n.a.omit(r,["q"])),r=this.serializeParams(n.a.pick(r,["q"]))):"GET"!==e&&"POST"!==e||(n.a.extend(o,r),r=null);var u={method:e,url:i+t,params:o,data:r,precision:"ms",inspect:{type:"influxdb"},paramSerializer:this.serializeParams};return u.headers=u.headers||{},(this.basicAuth||this.withCredentials)&&(u.withCredentials=!0),this.basicAuth&&(u.headers.Authorization=this.basicAuth),"POST"===e&&(u.headers["Content-type"]="application/x-www-form-urlencoded"),Object(j.getBackendSrv)().datasourceRequest(u).then((function(e){var t=e.data;if(t&&(t.executedQueryString=s,t.results)){var r=e.data.results.filter((function(e){return e.error}));if(r.length>0)throw{message:"InfluxDB Error: "+r[0].error,data:t}}return t}),(function(e){throw Number.isInteger(e.status)&&0!==e.status||e.status>=300?e.data&&e.data.error?{message:"InfluxDB Error: "+e.data.error,data:e.data,config:e.config}:{message:"Network Error: "+e.statusText+"("+e.status+")",data:e.data,config:e.config}:e}))}},{key:"getTimeFilter",value:function(e){var t=this.getInfluxTime(e.rangeRaw.from,!1,e.timezone),r=this.getInfluxTime(e.rangeRaw.to,!0,e.timezone),a="ms"===t[t.length-1];return"now()"!==r||a?"time >= "+t+" and time <= "+r:"time >= "+t}},{key:"getInfluxTime",value:function(e,t,r){if(n.a.isString(e)){if("now"===e)return"now()";var a=/^now-(\d+)([dhms])$/.exec(e);if(a)return"now() - "+parseInt(a[1],10)+a[2];e=i.dateMath.parse(e,t,r)}return e.valueOf()+"ms"}}])&&F(r.prototype,a),o&&F(r,o),t}(j.DataSourceWithBackend),L=r("KHwQ"),U=r.n(L);function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function V(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function $(e,t){return!t||"object"!==G(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function z(e){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function K(e,t){return(K=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var H=function(e){function t(e,r,a,n){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=$(this,z(t).call(this,e,r))).templateSrv=a,i.uiSegmentSrv=n,i.onChange=function(e){i.target.query=e.query},i.onRunQuery=function(){i.panelCtrl.refresh()},i.target=i.target,i.queryModel=new w(i.target,a,i.panel.scopedVars),i.queryBuilder=new T(i.target,i.datasource.database),i.groupBySegment=i.uiSegmentSrv.newPlusButton(),i.resultFormats=[{text:"Time series",value:"time_series"},{text:"Table",value:"table"},{text:"Logs",value:"logs"}],i.policySegment=n.newSegment(i.target.policy),i.target.measurement?i.measurementSegment=n.newSegment(i.target.measurement):i.measurementSegment=n.newSelectMeasurement(),i.tagSegments=[];var o=!0,s=!1,u=void 0;try{for(var l,c=i.target.tags[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var m=l.value;m.operator||(/^\/.*\/$/.test(m.value)?m.operator="=~":m.operator="="),m.condition&&i.tagSegments.push(n.newCondition(m.condition)),i.tagSegments.push(n.newKey(m.key)),i.tagSegments.push(n.newOperator(m.operator)),i.tagSegments.push(n.newKeyValue(m.value))}}catch(e){s=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}return i.fixTagSegments(),i.buildSelectMenu(),i.removeTagFilterSegment=n.newSegment({fake:!0,value:"-- remove tag filter --"}),i}var r,a,i;return t.$inject=["$scope","$injector","templateSrv","uiSegmentSrv"],function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&K(e,t)}(t,e),r=t,(a=[{key:"removeOrderByTime",value:function(){this.target.orderByTime="ASC"}},{key:"buildSelectMenu",value:function(){var e=v.getCategories();this.selectMenu=n.a.reduce(e,(function(e,t,r){var a={text:r,submenu:t.map((function(e){return{text:e.type,value:e.type}}))};return e.push(a),e}),[])}},{key:"getGroupByOptions",value:function(){var e=this,t=this.queryBuilder.buildExploreQuery("TAG_KEYS");return this.datasource.metricFindQuery(t).then((function(t){var r=[];e.queryModel.hasFill()||r.push(e.uiSegmentSrv.newSegment({value:"fill(null)"})),e.target.limit||r.push(e.uiSegmentSrv.newSegment({value:"LIMIT"})),e.target.slimit||r.push(e.uiSegmentSrv.newSegment({value:"SLIMIT"})),e.target.tz||r.push(e.uiSegmentSrv.newSegment({value:"tz"})),"ASC"===e.target.orderByTime&&r.push(e.uiSegmentSrv.newSegment({value:"ORDER BY time DESC"})),e.queryModel.hasGroupByTime()||r.push(e.uiSegmentSrv.newSegment({value:"time($interval)"}));var a=!0,n=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var u=o.value;r.push(e.uiSegmentSrv.newSegment({value:"tag("+u.text+")"}))}}catch(e){n=!0,i=e}finally{try{a||null==s.return||s.return()}finally{if(n)throw i}}return r})).catch(this.handleQueryError.bind(this))}},{key:"groupByAction",value:function(){switch(this.groupBySegment.value){case"LIMIT":this.target.limit=10;break;case"SLIMIT":this.target.slimit=10;break;case"tz":this.target.tz="UTC";break;case"ORDER BY time DESC":this.target.orderByTime="DESC";break;default:this.queryModel.addGroupBy(this.groupBySegment.value)}var e=this.uiSegmentSrv.newPlusButton();this.groupBySegment.value=e.value,this.groupBySegment.html=e.html,this.groupBySegment.fake=!0,this.panelCtrl.refresh()}},{key:"addSelectPart",value:function(e,t,r){this.queryModel.addSelectPart(e,r.value),this.panelCtrl.refresh()}},{key:"handleSelectPartEvent",value:function(e,t,r){switch(r.name){case"get-param-options":var a=this.queryBuilder.buildExploreQuery("FIELDS");return this.datasource.metricFindQuery(a).then(this.transformToSegments(!0)).catch(this.handleQueryError.bind(this));case"part-param-changed":this.panelCtrl.refresh();break;case"action":this.queryModel.removeSelectPart(e,t),this.panelCtrl.refresh();break;case"get-part-actions":return Promise.resolve([{text:"Remove",value:"remove-part"}])}return Promise.resolve()}},{key:"handleGroupByPartEvent",value:function(e,t,r){switch(r.name){case"get-param-options":var a=this.queryBuilder.buildExploreQuery("TAG_KEYS");return this.datasource.metricFindQuery(a).then(this.transformToSegments(!0)).catch(this.handleQueryError.bind(this));case"part-param-changed":this.panelCtrl.refresh();break;case"action":this.queryModel.removeGroupByPart(e,t),this.panelCtrl.refresh();break;case"get-part-actions":return Promise.resolve([{text:"Remove",value:"remove-part"}])}return Promise.resolve()}},{key:"fixTagSegments",value:function(){var e=this.tagSegments.length,t=this.tagSegments[Math.max(e-1,0)];t&&"plus-button"===t.type||this.tagSegments.push(this.uiSegmentSrv.newPlusButton())}},{key:"measurementChanged",value:function(){this.target.measurement=this.measurementSegment.value,this.panelCtrl.refresh()}},{key:"getPolicySegments",value:function(){var e=this.queryBuilder.buildExploreQuery("RETENTION POLICIES");return this.datasource.metricFindQuery(e).then(this.transformToSegments(!1)).catch(this.handleQueryError.bind(this))}},{key:"policyChanged",value:function(){this.target.policy=this.policySegment.value,this.panelCtrl.refresh()}},{key:"toggleEditorMode",value:function(){if(!this.datasource.is2x){try{this.target.query=this.queryModel.render(!1)}catch(e){console.log("query render error")}this.target.rawQuery=!this.target.rawQuery}}},{key:"getMeasurements",value:function(e){var t=this.queryBuilder.buildExploreQuery("MEASUREMENTS",void 0,e);return this.datasource.metricFindQuery(t).then(this.transformToSegments(!0)).catch(this.handleQueryError.bind(this))}},{key:"handleQueryError",value:function(e){return this.error=e.message||"Failed to issue metric query",[]}},{key:"transformToSegments",value:function(e){var t=this;return function(r){var a=n.a.map(r,(function(e){return t.uiSegmentSrv.newSegment({value:e.text,expandable:e.expandable})}));if(e){var i=!0,o=!1,s=void 0;try{for(var u,l=t.templateSrv.getVariables()[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var c=u.value;a.unshift(t.uiSegmentSrv.newSegment({type:"value",value:"/^$"+c.name+"$/",expandable:!0}))}}catch(e){o=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw s}}}return a}}},{key:"getTagsOrValues",value:function(e,t){var r,a,n=this;if("condition"===e.type)return Promise.resolve([this.uiSegmentSrv.newSegment("AND"),this.uiSegmentSrv.newSegment("OR")]);if("operator"===e.type){var i=this.tagSegments[t+1].value;return/^\/.*\/$/.test(i)?Promise.resolve(this.uiSegmentSrv.newOperators(["=~","!~"])):Promise.resolve(this.uiSegmentSrv.newOperators(["=","!=","<>","<",">"]))}return"key"===e.type||"plus-button"===e.type?(r=this.queryBuilder.buildExploreQuery("TAG_KEYS"),a=!1):"value"===e.type&&(r=this.queryBuilder.buildExploreQuery("TAG_VALUES",this.tagSegments[t-2].value),a=!0),this.datasource.metricFindQuery(r).then(this.transformToSegments(a)).then((function(t){return"key"===e.type&&t.splice(0,0,U.a.copy(n.removeTagFilterSegment)),t})).catch(this.handleQueryError.bind(this))}},{key:"getFieldSegments",value:function(){var e=this.queryBuilder.buildExploreQuery("FIELDS");return this.datasource.metricFindQuery(e).then(this.transformToSegments(!1)).catch(this.handleQueryError)}},{key:"tagSegmentUpdated",value:function(e,t){this.tagSegments[t]=e,e.value===this.removeTagFilterSegment.value?(this.tagSegments.splice(t,3),0===this.tagSegments.length?this.tagSegments.push(this.uiSegmentSrv.newPlusButton()):this.tagSegments.length>2&&(this.tagSegments.splice(Math.max(t-1,0),1),"plus-button"!==this.tagSegments[this.tagSegments.length-1].type&&this.tagSegments.push(this.uiSegmentSrv.newPlusButton()))):("plus-button"===e.type&&(t>2&&this.tagSegments.splice(t,0,this.uiSegmentSrv.newCondition("AND")),this.tagSegments.push(this.uiSegmentSrv.newOperator("=")),this.tagSegments.push(this.uiSegmentSrv.newFake("select tag value","value","query-segment-value")),e.type="key",e.cssClass="query-segment-key"),t+1===this.tagSegments.length&&this.tagSegments.push(this.uiSegmentSrv.newPlusButton())),this.rebuildTargetTagConditions()}},{key:"rebuildTargetTagConditions",value:function(){var e=this,t=[],r=0,a="";n.a.each(this.tagSegments,(function(n,i){"key"===n.type?(0===t.length&&t.push({}),t[r].key=n.value):"value"===n.type?((a=e.getTagValueOperator(n.value,t[r].operator))&&(e.tagSegments[i-1]=e.uiSegmentSrv.newOperator(a),t[r].operator=a),t[r].value=n.value):"condition"===n.type?(t.push({condition:n.value}),r+=1):"operator"===n.type&&(t[r].operator=n.value)})),this.target.tags=t,this.panelCtrl.refresh()}},{key:"getTagValueOperator",value:function(e,t){return"=~"!==t&&"!~"!==t&&/^\/.*\/$/.test(e)?"=~":"=~"!==t&&"!~"!==t||!/^(?!\/.*\/$)/.test(e)?null:"="}}])&&V(r.prototype,a),i&&V(r,i),t}(r("LzXI").QueryCtrl);H.templateUrl="partials/query.editor.html";var W=r("q1tI"),J=r.n(W),Y=[{title:"Getting started",label:"Start by selecting a measurement and field from the dropdown above. You can then use the tag selector to further narrow your search."}],X=function(e){return J.a.createElement("div",null,J.a.createElement("h2",null,"InfluxDB Cheat Sheet"),Y.map((function(e){return J.a.createElement("div",{className:"cheat-sheet-item",key:e.title},J.a.createElement("div",{className:"cheat-sheet-item__title"},e.title),J.a.createElement("div",{className:"cheat-sheet-item__label"},e.label))})))};function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function te(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function re(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ae(e){return(ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ne(e,t){return(ne=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ie=function(e){function t(){return ee(this,t),re(this,ae(t).apply(this,arguments))}var r,a,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ne(e,t)}(t,e),r=t,(a=[{key:"render",value:function(){return J.a.createElement(X,{onClickExample:this.props.onClickExample})}}])&&te(r.prototype,a),n&&te(r,n),t}(W.PureComponent),oe=r("kDLi");function se(e){return(se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ue(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function le(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ue(Object(r),!0).forEach((function(t){ce(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ue(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ce(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function me(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pe(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function fe(e,t){return!t||"object"!==se(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ge(e){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function de(e,t){return(de=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var he=oe.LegacyForms.Select,ye=oe.LegacyForms.Input,ve=oe.LegacyForms.SecretFormField,be=[{label:"GET",value:"GET"},{label:"POST",value:"POST"}],Se=[{label:"InfluxQL",value:k.InfluxQL,description:"The InfluxDB SQL-like query language.  Supported in InfluxDB 1.x"},{label:"Flux",value:k.Flux,description:"Advanced data scripting and query language.  Supported in InfluxDB 2.x and 1.8+ (beta)"}],we=function(e){function t(){var e,r;me(this,t);for(var a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return(r=fe(this,(e=ge(t)).call.apply(e,[this].concat(n)))).onResetPassword=function(){Object(i.updateDatasourcePluginResetOption)(r.props,"password")},r.onResetToken=function(){Object(i.updateDatasourcePluginResetOption)(r.props,"token")},r.onVersionChanged=function(e){var t=r.props,a=t.options,n=t.onOptionsChange,i=le({},a,{jsonData:le({},a.jsonData,{version:e.value})});e.value===k.Flux&&(i.access="proxy",i.basicAuth=!0,i.jsonData.httpMode="POST",delete i.user,delete i.database),n(i)},r.onUpdateInflux2xURL=function(e){var t=r.props,a=t.options;(0,t.onOptionsChange)(le({},a,{url:e.currentTarget.value,access:"proxy",basicAuth:!0}))},r}var r,a,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&de(e,t)}(t,e),r=t,(a=[{key:"renderInflux2x",value:function(){var e=this.props.options,t=e.secureJsonFields,r=e.secureJsonData||{};return J.a.createElement("div",null,J.a.createElement("div",{className:"gf-form-group"},J.a.createElement("div",{className:"width-30 grafana-info-box"},J.a.createElement("h5",null,"Support for flux in Grafana is currently in beta"),J.a.createElement("p",null,"Please report any issues to: ",J.a.createElement("br",null),J.a.createElement("a",{href:"https://github.com/grafana/grafana/issues/new/choose"},"https://github.com/grafana/grafana/issues")))),J.a.createElement("br",null),J.a.createElement("h3",{className:"page-heading"},"Connection"),J.a.createElement("div",{className:"gf-form-inline"},J.a.createElement("div",{className:"gf-form"},J.a.createElement(oe.InlineFormLabel,{className:"width-10",tooltip:"This URL needs to be accessible from the grafana backend/server."},"URL"),J.a.createElement("div",{className:"width-20"},J.a.createElement(ye,{className:"width-20",value:e.url||"",placeholder:"http://localhost:9999/api/v2",onChange:this.onUpdateInflux2xURL})))),J.a.createElement("div",{className:"gf-form-inline"},J.a.createElement("div",{className:"gf-form"},J.a.createElement(oe.InlineFormLabel,{className:"width-10"},"Organization"),J.a.createElement("div",{className:"width-10"},J.a.createElement(ye,{className:"width-20",value:e.jsonData.organization||"",onChange:Object(i.onUpdateDatasourceJsonDataOption)(this.props,"organization")})))),J.a.createElement("div",{className:"gf-form-inline"},J.a.createElement("div",{className:"gf-form"},J.a.createElement(ve,{isConfigured:t&&t.token,value:r.token||"",label:"Token",labelWidth:10,inputWidth:20,onReset:this.onResetToken,onChange:Object(i.onUpdateDatasourceSecureJsonDataOption)(this.props,"token")}))),J.a.createElement("div",{className:"gf-form-inline"},J.a.createElement("div",{className:"gf-form"},J.a.createElement(oe.InlineFormLabel,{className:"width-10"},"Default Bucket"),J.a.createElement("div",{className:"width-10"},J.a.createElement(ye,{className:"width-20",placeholder:"default bucket",value:e.jsonData.defaultBucket||"",onChange:Object(i.onUpdateDatasourceJsonDataOption)(this.props,"defaultBucket")})))),J.a.createElement("div",{className:"gf-form-inline"},J.a.createElement("div",{className:"gf-form"},J.a.createElement(oe.InlineFormLabel,{className:"width-10",tooltip:"A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example 1m if your data is written every minute."},"Min time interval"),J.a.createElement("div",{className:"width-10"},J.a.createElement(ye,{className:"width-10",placeholder:"10s",value:e.jsonData.timeInterval||"",onChange:Object(i.onUpdateDatasourceJsonDataOption)(this.props,"timeInterval")})))))}},{key:"renderInflux1x",value:function(){var e=this.props,t=e.options,r=e.onOptionsChange,a=t.secureJsonFields,n=t.secureJsonData||{};return J.a.createElement("div",null,J.a.createElement(oe.DataSourceHttpSettings,{showAccessOptions:!0,dataSourceConfig:t,defaultUrl:"http://localhost:8086",onChange:r}),J.a.createElement("h3",{className:"page-heading"},"InfluxDB Details"),J.a.createElement("div",{className:"gf-form-group"},J.a.createElement("div",{className:"gf-form-inline"},J.a.createElement("div",{className:"gf-form"},J.a.createElement(oe.InlineFormLabel,{className:"width-10"},"Database"),J.a.createElement("div",{className:"width-20"},J.a.createElement(ye,{className:"width-20",value:t.database||"",onChange:Object(i.onUpdateDatasourceOption)(this.props,"database")})))),J.a.createElement("div",{className:"gf-form-inline"},J.a.createElement("div",{className:"gf-form"},J.a.createElement(oe.InlineFormLabel,{className:"width-10"},"User"),J.a.createElement("div",{className:"width-10"},J.a.createElement(ye,{className:"width-20",value:t.user||"",onChange:Object(i.onUpdateDatasourceOption)(this.props,"user")})))),J.a.createElement("div",{className:"gf-form-inline"},J.a.createElement("div",{className:"gf-form"},J.a.createElement(ve,{isConfigured:a&&a.password,value:n.password||"",label:"Password",labelWidth:10,inputWidth:20,onReset:this.onResetPassword,onChange:Object(i.onUpdateDatasourceSecureJsonDataOption)(this.props,"password")}))),J.a.createElement("div",{className:"gf-form-inline"},J.a.createElement("div",{className:"gf-form"},J.a.createElement(oe.InlineFormLabel,{className:"width-10",tooltip:"You can use either GET or POST HTTP method to query your InfluxDB database. The POST method allows you to perform heavy requests (with a lots of WHERE clause) while the GET method will restrict you and return an error if the query is too large."},"HTTP Method"),J.a.createElement(he,{className:"width-10",value:be.find((function(e){return e.value===t.jsonData.httpMode})),options:be,defaultValue:t.jsonData.httpMode,onChange:Object(i.onUpdateDatasourceJsonDataOptionSelect)(this.props,"httpMode")})))),J.a.createElement("div",{className:"gf-form-group"},J.a.createElement("div",{className:"grafana-info-box"},J.a.createElement("h5",null,"Database Access"),J.a.createElement("p",null,"Setting the database for this datasource does not deny access to other databases. The InfluxDB query syntax allows switching the database in the query. For example:",J.a.createElement("code",null,"SHOW MEASUREMENTS ON _internal")," or ",J.a.createElement("code",null,'SELECT * FROM "_internal".."database" LIMIT 10'),J.a.createElement("br",null),J.a.createElement("br",null),"To support data isolation and security, make sure appropriate permissions are configured in InfluxDB."))),J.a.createElement("div",{className:"gf-form-group"},J.a.createElement("div",{className:"gf-form-inline"},J.a.createElement("div",{className:"gf-form"},J.a.createElement(oe.InlineFormLabel,{className:"width-10",tooltip:"A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example 1m if your data is written every minute."},"Min time interval"),J.a.createElement("div",{className:"width-10"},J.a.createElement(ye,{className:"width-10",placeholder:"10s",value:t.jsonData.timeInterval||"",onChange:Object(i.onUpdateDatasourceJsonDataOption)(this.props,"timeInterval")}))))))}},{key:"render",value:function(){var e=this.props.options;return J.a.createElement(J.a.Fragment,null,J.a.createElement("h3",{className:"page-heading"},"Query Language"),J.a.createElement("div",{className:"gf-form-group"},J.a.createElement("div",{className:"gf-form-inline"},J.a.createElement("div",{className:"gf-form"},J.a.createElement(he,{className:"width-30",value:e.jsonData.version===k.Flux?Se[1]:Se[0],options:Se,defaultValue:Se[0],onChange:this.onVersionChanged})))),e.jsonData.version===k.Flux?this.renderInflux2x():this.renderInflux1x())}}])&&pe(r.prototype,a),n&&pe(r,n),t}(W.PureComponent),Ee=r("txxJ"),Oe=r("kDDq");function Pe(e){return(Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xe(){var e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n              margin-top: 6px;\n            "]);return xe=function(){return e},e}function ke(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Te(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(r),!0).forEach((function(t){je(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ke(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function je(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ce(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ie(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function De(e,t){return!t||"object"!==Pe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _e(e){return(_e=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ne(e,t){return(Ne=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Be=[{label:"Show buckets",description:"List the avaliable buckets (table)",value:"buckets()"},{label:"Simple query",description:"filter by measurment and field",value:'from(bucket: "db/rp")\n  |> range(start: v.timeRangeStart, stop:v.timeRangeStop)\n  |> filter(fn: (r) =>\n    r._measurement == "example-measurement" and\n    r._field == "example-field"\n  )'},{label:"Grouped Query",description:"Group by (min/max/sum/median)",value:'// v.windowPeriod is a variable referring to the current optimized window period (currently: $interval)\nfrom(bucket: v.bucket)\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r["_measurement"] == "measurement1" or r["_measurement"] =~ /^.*?regex.*$/)\n  |> filter(fn: (r) => r["_field"] == "field2" or r["_field"] =~ /^.*?regex.*$/)\n  |> aggregateWindow(every: v.windowPeriod, fn: mean|median|max|count|derivative|sum)\n  |> yield(name: "some-name")'},{label:"Filter by value",description:"Results between a min/max",value:'// v.bucket, v.timeRangeStart, and v.timeRange stop are all variables supported by the flux plugin and influxdb\nfrom(bucket: v.bucket)\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r["_value"] >= 10 and r["_value"] <= 20)'},{label:"Schema Exploration: (measurements)",description:"Get a list of measurement using flux",value:'import "influxdata/influxdb/v1"\nv1.measurements(bucket: v.bucket)'},{label:"Schema Exploration: (fields)",description:"Return every possible key in a single table",value:'from(bucket: v.bucket)\n  |> range(start: v.timeRangeStart, stop:timeRangeStop)\n  |> keys()\n  |> keep(columns: ["_value"])\n  |> group()\n  |> distinct()'},{label:"Schema Exploration: (tag keys)",description:"Get a list of tag keys using flux",value:'import "influxdata/influxdb/v1"\nv1.tagKeys(bucket: v.bucket)'},{label:"Schema Exploration: (tag values)",description:"Get a list of tag values using flux",value:'import "influxdata/influxdb/v1"\nv1.tagValues(\n    bucket: v.bucket,\n    tag: "host",\n    predicate: (r) => true,\n    start: -1d\n)'}],Fe=function(e){function t(){var e,r;Ce(this,t);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(r=De(this,(e=_e(t)).call.apply(e,[this].concat(n)))).onFluxQueryChange=function(e){var t=r.props,a=t.target;(0,t.change)(Te({},a,{query:e})),r.props.refresh()},r.onSampleChange=function(e){r.props.change(Te({},r.props.target,{query:e.value})),r.forceUpdate(),r.props.refresh()},r.getSuggestions=function(){var e=[{label:"v.timeRangeStart",kind:oe.CodeEditorSuggestionItemKind.Property,detail:"The start time"},{label:"v.timeRangeStop",kind:oe.CodeEditorSuggestionItemKind.Property,detail:"The stop time"},{label:"v.windowPeriod",kind:oe.CodeEditorSuggestionItemKind.Property,detail:"based on max data points"},{label:"v.defaultBucket",kind:oe.CodeEditorSuggestionItemKind.Property,detail:"bucket configured in the datsource"},{label:"v.organization",kind:oe.CodeEditorSuggestionItemKind.Property,detail:"org configured for the datsource"}],t=Object(j.getTemplateSrv)();return t.getVariables().forEach((function(r){var a="${"+r.name+"}",n=t.replace(a);n===a&&(n=""),e.push({label:a,kind:oe.CodeEditorSuggestionItemKind.Text,detail:"(Template Variable) ".concat(n)})})),e},r.editorDidMountCallbackHack=function(e){setTimeout((function(){return e.layout()}),100)},r}var r,a,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ne(e,t)}(t,e),r=t,(a=[{key:"render",value:function(){var e=this.props.target,t=J.a.createElement("div",null,"Type: ",J.a.createElement("i",null,"ctrl+space")," to show template variable suggestions ",J.a.createElement("br",null),"Many queries can be copied from chronograph");return J.a.createElement(J.a.Fragment,null,J.a.createElement(oe.CodeEditor,{height:"200px",language:"sql",value:e.query||"",onBlur:this.onFluxQueryChange,onSave:this.onFluxQueryChange,showMiniMap:!1,showLineNumbers:!0,getSuggestions:this.getSuggestions,onEditorDidMount:this.editorDidMountCallbackHack}),J.a.createElement("div",{className:Object(Oe.cx)("gf-form-inline",Object(Oe.css)(xe()))},J.a.createElement(oe.LinkButton,{icon:"external-link-alt",variant:"secondary",target:"blank",href:"https://docs.influxdata.com/flux/latest/introduction/getting-started/"},"Flux language syntax"),J.a.createElement(oe.Segment,{options:Be,value:"Sample Query",onChange:this.onSampleChange}),J.a.createElement("div",{className:"gf-form gf-form--grow"},J.a.createElement("div",{className:"gf-form-label gf-form-label--grow"})),J.a.createElement(oe.InlineFormLabel,{width:5,tooltip:t},"Help")))}}])&&Ie(r.prototype,a),n&&Ie(r,n),t}(W.PureComponent);Ee.c.directive("fluxQueryEditor",["reactDirective",function(e){return e(Fe,["target","change","refresh"])}]),r.d(t,"plugin",(function(){return Ae}));var Re=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)};Re.templateUrl="partials/annotations.editor.html";var Ae=new i.DataSourcePlugin(q).setConfigEditor(we).setQueryCtrl(H).setAnnotationQueryCtrl(Re).setExploreStartPage(ie)}}]);
//# sourceMappingURL=influxdbPlugin.7bf174750e07ac7111d5.js.map