{"version":3,"sources":["webpack:///./public/app/plugins/datasource/postgres/response_parser.ts","webpack:///./public/app/plugins/datasource/postgres/postgres_query.ts","webpack:///./public/app/plugins/datasource/postgres/datasource.ts","webpack:///./public/app/plugins/datasource/postgres/meta_query.ts","webpack:///./public/app/plugins/datasource/postgres/sql_part.ts","webpack:///./public/app/plugins/datasource/postgres/query_ctrl.ts","webpack:///./public/app/plugins/datasource/postgres/config_ctrl.ts","webpack:///./public/app/plugins/datasource/postgres/module.ts","webpack:///./public/app/features/datasources/utils/passwordHandlers.ts","webpack:///./public/app/core/components/sql_part/sql_part.ts"],"names":["ResponseParser","$q","this","prototype","processQueryResult","res","data","results","key","queryRes","series","_c","e_1","Object","tslib_es6","_d","next","done","value","push","target","name","datapoints","points","refId","meta","tables","_e","e_2","_f","table","type","parseMetricFindQueryResult","length","rowCount","columns","rows","textColIndex","findColIndex","valueColIndex","transformToKeyValueList","transformToSimpleList","i","containsKey","text","j","indexOf","lodash_default","a","map","colName","transformAnnotationResponse","options","annotation","timeColumnIndex","textColumnIndex","tagsColumnIndex","reject","message","list","row","time","Math","floor","title","tags","trim","split","PostgresQuery","templateSrv","scopedVars","format","timeColumn","metricColumn","group","where","params","select","rawQuery","interpolateQueryStr","bind","$inject","unquoteIdentifier","substring","replace","quoteIdentifier","String","quoteLiteral","escapeLiteral","hasTimeGroup","find","g","hasMetricColumn","variable","defaultFormatFn","multi","includeAll","join","render","interpolate","rawSql","buildQuery","hasUnixEpochTimecolumn","timeColumnType","buildTimeColumn","alias","query","timeGroup","macro","args","buildMetricColumn","_a","_b","column","buildValueColumn","aggregate","windows","func","overParts","over","curr","prev","buildWhereClause","_this","conditions","tag","index","buildGroupClause","groupSection","part","buildValueColumns","datasource_PostgresDatasource","PostgresDatasource","instanceSettings","backendSrv","timeSrv","queryModel","v","id","jsonData","responseParser","response_parser","postgres_query","interval","timeInterval","interpolateVariablesInQueries","queries","expandedQueries","datasource","interpolateVariable","filter","targets","hide","intervalMs","maxDataPoints","datasourceId","when","datasourceRequest","url","from","range","valueOf","toString","to","then","annotationQuery","metricFindQuery","optionalOptions","templating_variable","wildcardChar","interpolatedQuery","timeRange","method","getVersion","getTimescaleDBVersion","testDatasource","status","catch","err","log","targetContainsTemplate","variableExists","PostgresMetaQuery","getOperators","datatype","quoteIdentAsLiteral","findMetricTable","buildSchemaConstraint","buildTableConstraint","includes","parts","buildTableQuery","buildColumnQuery","buildValueQuery","buildDatatypeQuery","buildAggregateQuery","sql_part_index","register","sql_part","style","dynamicLookup","defaultParams","label","quote","postgres_sql_part","def","defaultQuery","query_ctrl_PostgresQueryCtrl","_super","PostgresQueryCtrl","$scope","$injector","uiSegmentSrv","call","panel","metaBuilder","updateProjection","formats","panelCtrl","result","segment","newSegment","tableSegment","html","timeColumnSegment","updateRawSqlAndRefresh","fake","metricColumnSegment","buildSelectMenu","whereAdd","newPlusButton","events","on","src","dataReceived","onDataReceived","dataError","onDataError","refresh","selectParts","create","n","whereParts","groupParts","updatePersistedParts","selectMenu","aggregates","timescaledb","submenu","postgresVersion","toggleEditorMode","emit","types","showConfirmModal","text2","yesText","onConfirm","resetPlusButton","button","plusButton","getTableSegments","transformToSegments","handleQueryError","tableChanged","r","segment_1","timeColumnChanged","all","task1","task2","getTimeColumnSegments","partModel","splice","getMetricColumnSegments","addNone","metricColumnChanged","dataList","lastQueryMeta","lastQueryError","anySeriesFromQuery","error","expandable","variables","config","templateQuoter","unshift","segments","findAggregateIndex","findIndex","p","findWindowIndex","addSelectPart","item","subItem","partType","clone","addGroup","aggIndex","addAlias","windowIndex","aggIndex_1","removeSelectPart","modelsIndex","partIndex","handleSelectPartEvent","evt","handleGroupPartEvent","removeGroup","some","s","handleWherePartEvent","addTemplateVars","newOperators","d","getWhereOptions","addWhereAction","getGroupOptions","e_3","tags_1","tags_1_1","addGroupAction","groupAdd","templateUrl","passwordHandlers","__webpack_require__","PostgresConfigCtrl","datasourceSrv","postgresVersions","current","sslmode","showTimescaleDBHelp","autoDetectFeatures","onPasswordReset","Password","onPasswordChange","loadDatasource","ds","version","Number","major","trunc","minor","toggleTimescaleDBHelp","__webpack_exports__","PostgresAnnotationsQueryCtrl","config_ctrl_PostgresConfigCtrl","module_defaultQuery","QjE0","module","PasswordFieldEnum","createChangeHandler","createResetHandler","ctrl","field","event","preventDefault","secureJsonFields","secureJsonData","XXK+","SqlPartDef","SqlPart","lodash__WEBPACK_IMPORTED_MODULE_0__","lodash__WEBPACK_IMPORTED_MODULE_0___default","toUpperCase","wrapOpen","wrapClose","separator","updateParam","strValue","optional"],"mappings":"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","file":"postgresPlugin.fabf58cbd84a6ac3523b.js","sourcesContent":["import _ from 'lodash';\nimport { IQService } from 'angular';\n\nexport default class ResponseParser {\n  constructor(private $q: IQService) {}\n\n  processQueryResult(res: any) {\n    const data: any[] = [];\n\n    if (!res.data.results) {\n      return { data: data };\n    }\n\n    for (const key in res.data.results) {\n      const queryRes = res.data.results[key];\n\n      if (queryRes.series) {\n        for (const series of queryRes.series) {\n          data.push({\n            target: series.name,\n            datapoints: series.points,\n            refId: queryRes.refId,\n            meta: queryRes.meta,\n          });\n        }\n      }\n\n      if (queryRes.tables) {\n        for (const table of queryRes.tables) {\n          table.type = 'table';\n          table.refId = queryRes.refId;\n          table.meta = queryRes.meta;\n          data.push(table);\n        }\n      }\n    }\n\n    return { data: data };\n  }\n\n  parseMetricFindQueryResult(refId: string, results: any) {\n    if (!results || results.data.length === 0 || results.data.results[refId].meta.rowCount === 0) {\n      return [];\n    }\n\n    const columns = results.data.results[refId].tables[0].columns;\n    const rows = results.data.results[refId].tables[0].rows;\n    const textColIndex = this.findColIndex(columns, '__text');\n    const valueColIndex = this.findColIndex(columns, '__value');\n\n    if (columns.length === 2 && textColIndex !== -1 && valueColIndex !== -1) {\n      return this.transformToKeyValueList(rows, textColIndex, valueColIndex);\n    }\n\n    return this.transformToSimpleList(rows);\n  }\n\n  transformToKeyValueList(rows: any, textColIndex: number, valueColIndex: number) {\n    const res = [];\n\n    for (let i = 0; i < rows.length; i++) {\n      if (!this.containsKey(res, rows[i][textColIndex])) {\n        res.push({\n          text: rows[i][textColIndex],\n          value: rows[i][valueColIndex],\n        });\n      }\n    }\n\n    return res;\n  }\n\n  transformToSimpleList(rows: any[][]) {\n    const res = [];\n\n    for (let i = 0; i < rows.length; i++) {\n      for (let j = 0; j < rows[i].length; j++) {\n        const value = rows[i][j];\n        if (res.indexOf(value) === -1) {\n          res.push(value);\n        }\n      }\n    }\n\n    return _.map(res, value => {\n      return { text: value };\n    });\n  }\n\n  findColIndex(columns: any[], colName: string) {\n    for (let i = 0; i < columns.length; i++) {\n      if (columns[i].text === colName) {\n        return i;\n      }\n    }\n\n    return -1;\n  }\n\n  containsKey(res: any, key: any) {\n    for (let i = 0; i < res.length; i++) {\n      if (res[i].text === key) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  transformAnnotationResponse(options: any, data: any) {\n    const table = data.data.results[options.annotation.name].tables[0];\n\n    let timeColumnIndex = -1;\n    const titleColumnIndex = -1;\n    let textColumnIndex = -1;\n    let tagsColumnIndex = -1;\n\n    for (let i = 0; i < table.columns.length; i++) {\n      if (table.columns[i].text === 'time') {\n        timeColumnIndex = i;\n      } else if (table.columns[i].text === 'text') {\n        textColumnIndex = i;\n      } else if (table.columns[i].text === 'tags') {\n        tagsColumnIndex = i;\n      }\n    }\n\n    if (timeColumnIndex === -1) {\n      return this.$q.reject({\n        message: 'Missing mandatory time column in annotation query.',\n      });\n    }\n\n    const list = [];\n    for (let i = 0; i < table.rows.length; i++) {\n      const row = table.rows[i];\n      list.push({\n        annotation: options.annotation,\n        time: Math.floor(row[timeColumnIndex]),\n        title: row[titleColumnIndex],\n        text: row[textColumnIndex],\n        tags: row[tagsColumnIndex] ? row[tagsColumnIndex].trim().split(/\\s*,\\s*/) : [],\n      });\n    }\n\n    return list;\n  }\n}\n","import _ from 'lodash';\nimport { TemplateSrv } from 'app/features/templating/template_srv';\nimport { ScopedVars } from '@grafana/data';\n\nexport default class PostgresQuery {\n  target: any;\n  templateSrv: any;\n  scopedVars: any;\n\n  /** @ngInject */\n  constructor(target: any, templateSrv?: TemplateSrv, scopedVars?: ScopedVars) {\n    this.target = target;\n    this.templateSrv = templateSrv;\n    this.scopedVars = scopedVars;\n\n    target.format = target.format || 'time_series';\n    target.timeColumn = target.timeColumn || 'time';\n    target.metricColumn = target.metricColumn || 'none';\n\n    target.group = target.group || [];\n    target.where = target.where || [{ type: 'macro', name: '$__timeFilter', params: [] }];\n    target.select = target.select || [[{ type: 'column', params: ['value'] }]];\n\n    // handle pre query gui panels gracefully\n    if (!('rawQuery' in this.target)) {\n      if ('rawSql' in target) {\n        // pre query gui panel\n        target.rawQuery = true;\n      } else {\n        // new panel\n        target.rawQuery = false;\n      }\n    }\n\n    // give interpolateQueryStr access to this\n    this.interpolateQueryStr = this.interpolateQueryStr.bind(this);\n  }\n\n  // remove identifier quoting from identifier to use in metadata queries\n  unquoteIdentifier(value: string) {\n    if (value[0] === '\"' && value[value.length - 1] === '\"') {\n      return value.substring(1, value.length - 1).replace(/\"\"/g, '\"');\n    } else {\n      return value;\n    }\n  }\n\n  quoteIdentifier(value: any) {\n    return '\"' + String(value).replace(/\"/g, '\"\"') + '\"';\n  }\n\n  quoteLiteral(value: any) {\n    return \"'\" + String(value).replace(/'/g, \"''\") + \"'\";\n  }\n\n  escapeLiteral(value: any) {\n    return String(value).replace(/'/g, \"''\");\n  }\n\n  hasTimeGroup() {\n    return _.find(this.target.group, (g: any) => g.type === 'time');\n  }\n\n  hasMetricColumn() {\n    return this.target.metricColumn !== 'none';\n  }\n\n  interpolateQueryStr(value: any, variable: { multi: any; includeAll: any }, defaultFormatFn: any) {\n    // if no multi or include all do not regexEscape\n    if (!variable.multi && !variable.includeAll) {\n      return this.escapeLiteral(value);\n    }\n\n    if (typeof value === 'string') {\n      return this.quoteLiteral(value);\n    }\n\n    const escapedValues = _.map(value, this.quoteLiteral);\n    return escapedValues.join(',');\n  }\n\n  render(interpolate?: any) {\n    const target = this.target;\n\n    // new query with no table set yet\n    if (!this.target.rawQuery && !('table' in this.target)) {\n      return '';\n    }\n\n    if (!target.rawQuery) {\n      target.rawSql = this.buildQuery();\n    }\n\n    if (interpolate) {\n      return this.templateSrv.replace(target.rawSql, this.scopedVars, this.interpolateQueryStr);\n    } else {\n      return target.rawSql;\n    }\n  }\n\n  hasUnixEpochTimecolumn() {\n    return ['int4', 'int8', 'float4', 'float8', 'numeric'].indexOf(this.target.timeColumnType) > -1;\n  }\n\n  buildTimeColumn(alias = true) {\n    const timeGroup = this.hasTimeGroup();\n    let query;\n    let macro = '$__timeGroup';\n\n    if (timeGroup) {\n      let args;\n      if (timeGroup.params.length > 1 && timeGroup.params[1] !== 'none') {\n        args = timeGroup.params.join(',');\n      } else {\n        args = timeGroup.params[0];\n      }\n      if (this.hasUnixEpochTimecolumn()) {\n        macro = '$__unixEpochGroup';\n      }\n      if (alias) {\n        macro += 'Alias';\n      }\n      query = macro + '(' + this.target.timeColumn + ',' + args + ')';\n    } else {\n      query = this.target.timeColumn;\n      if (alias) {\n        query += ' AS \"time\"';\n      }\n    }\n\n    return query;\n  }\n\n  buildMetricColumn() {\n    if (this.hasMetricColumn()) {\n      return this.target.metricColumn + ' AS metric';\n    }\n\n    return '';\n  }\n\n  buildValueColumns() {\n    let query = '';\n    for (const column of this.target.select) {\n      query += ',\\n  ' + this.buildValueColumn(column);\n    }\n\n    return query;\n  }\n\n  buildValueColumn(column: any) {\n    let query = '';\n\n    const columnName: any = _.find(column, (g: any) => g.type === 'column');\n    query = columnName.params[0];\n\n    const aggregate: any = _.find(column, (g: any) => g.type === 'aggregate' || g.type === 'percentile');\n    const windows: any = _.find(column, (g: any) => g.type === 'window' || g.type === 'moving_window');\n\n    if (aggregate) {\n      const func = aggregate.params[0];\n      switch (aggregate.type) {\n        case 'aggregate':\n          if (func === 'first' || func === 'last') {\n            query = func + '(' + query + ',' + this.target.timeColumn + ')';\n          } else {\n            query = func + '(' + query + ')';\n          }\n          break;\n        case 'percentile':\n          query = func + '(' + aggregate.params[1] + ') WITHIN GROUP (ORDER BY ' + query + ')';\n          break;\n      }\n    }\n\n    if (windows) {\n      const overParts = [];\n      if (this.hasMetricColumn()) {\n        overParts.push('PARTITION BY ' + this.target.metricColumn);\n      }\n      overParts.push('ORDER BY ' + this.buildTimeColumn(false));\n\n      const over = overParts.join(' ');\n      let curr: string;\n      let prev: string;\n      switch (windows.type) {\n        case 'window':\n          switch (windows.params[0]) {\n            case 'delta':\n              curr = query;\n              prev = 'lag(' + curr + ') OVER (' + over + ')';\n              query = curr + ' - ' + prev;\n              break;\n            case 'increase':\n              curr = query;\n              prev = 'lag(' + curr + ') OVER (' + over + ')';\n              query = '(CASE WHEN ' + curr + ' >= ' + prev + ' THEN ' + curr + ' - ' + prev;\n              query += ' WHEN ' + prev + ' IS NULL THEN NULL ELSE ' + curr + ' END)';\n              break;\n            case 'rate':\n              let timeColumn = this.target.timeColumn;\n              if (aggregate) {\n                timeColumn = 'min(' + timeColumn + ')';\n              }\n\n              curr = query;\n              prev = 'lag(' + curr + ') OVER (' + over + ')';\n              query = '(CASE WHEN ' + curr + ' >= ' + prev + ' THEN ' + curr + ' - ' + prev;\n              query += ' WHEN ' + prev + ' IS NULL THEN NULL ELSE ' + curr + ' END)';\n              query += '/extract(epoch from ' + timeColumn + ' - lag(' + timeColumn + ') OVER (' + over + '))';\n              break;\n            default:\n              query = windows.params[0] + '(' + query + ') OVER (' + over + ')';\n              break;\n          }\n          break;\n        case 'moving_window':\n          query = windows.params[0] + '(' + query + ') OVER (' + over + ' ROWS ' + windows.params[1] + ' PRECEDING)';\n          break;\n      }\n    }\n\n    const alias: any = _.find(column, (g: any) => g.type === 'alias');\n    if (alias) {\n      query += ' AS ' + this.quoteIdentifier(alias.params[0]);\n    }\n\n    return query;\n  }\n\n  buildWhereClause() {\n    let query = '';\n    const conditions = _.map(this.target.where, (tag, index) => {\n      switch (tag.type) {\n        case 'macro':\n          return tag.name + '(' + this.target.timeColumn + ')';\n          break;\n        case 'expression':\n          return tag.params.join(' ');\n          break;\n      }\n    });\n\n    if (conditions.length > 0) {\n      query = '\\nWHERE\\n  ' + conditions.join(' AND\\n  ');\n    }\n\n    return query;\n  }\n\n  buildGroupClause() {\n    let query = '';\n    let groupSection = '';\n\n    for (let i = 0; i < this.target.group.length; i++) {\n      const part = this.target.group[i];\n      if (i > 0) {\n        groupSection += ', ';\n      }\n      if (part.type === 'time') {\n        groupSection += '1';\n      } else {\n        groupSection += part.params[0];\n      }\n    }\n\n    if (groupSection.length) {\n      query = '\\nGROUP BY ' + groupSection;\n      if (this.hasMetricColumn()) {\n        query += ',2';\n      }\n    }\n    return query;\n  }\n\n  buildQuery() {\n    let query = 'SELECT';\n\n    query += '\\n  ' + this.buildTimeColumn();\n    if (this.hasMetricColumn()) {\n      query += ',\\n  ' + this.buildMetricColumn();\n    }\n    query += this.buildValueColumns();\n\n    query += '\\nFROM ' + this.target.table;\n\n    query += this.buildWhereClause();\n    query += this.buildGroupClause();\n\n    query += '\\nORDER BY 1';\n    if (this.hasMetricColumn()) {\n      query += ',2';\n    }\n\n    return query;\n  }\n}\n","import _ from 'lodash';\nimport ResponseParser from './response_parser';\nimport PostgresQuery from 'app/plugins/datasource/postgres/postgres_query';\nimport { IQService } from 'angular';\nimport { BackendSrv } from 'app/core/services/backend_srv';\nimport { TemplateSrv } from 'app/features/templating/template_srv';\nimport { TimeSrv } from 'app/features/dashboard/services/TimeSrv';\n//Types\nimport { PostgresQueryForInterpolation } from './types';\nimport { getSearchFilterScopedVar } from '../../../features/templating/variable';\n\nexport class PostgresDatasource {\n  id: any;\n  name: any;\n  jsonData: any;\n  responseParser: ResponseParser;\n  queryModel: PostgresQuery;\n  interval: string;\n\n  /** @ngInject */\n  constructor(\n    instanceSettings: { name: any; id?: any; jsonData?: any },\n    private backendSrv: BackendSrv,\n    private $q: IQService,\n    private templateSrv: TemplateSrv,\n    private timeSrv: TimeSrv\n  ) {\n    this.name = instanceSettings.name;\n    this.id = instanceSettings.id;\n    this.jsonData = instanceSettings.jsonData;\n    this.responseParser = new ResponseParser(this.$q);\n    this.queryModel = new PostgresQuery({});\n    this.interval = (instanceSettings.jsonData || {}).timeInterval || '1m';\n  }\n\n  interpolateVariable = (value: string, variable: { multi: any; includeAll: any }) => {\n    if (typeof value === 'string') {\n      if (variable.multi || variable.includeAll) {\n        return this.queryModel.quoteLiteral(value);\n      } else {\n        return value;\n      }\n    }\n\n    if (typeof value === 'number') {\n      return value;\n    }\n\n    const quotedValues = _.map(value, v => {\n      return this.queryModel.quoteLiteral(v);\n    });\n    return quotedValues.join(',');\n  };\n\n  interpolateVariablesInQueries(queries: PostgresQueryForInterpolation[]): PostgresQueryForInterpolation[] {\n    let expandedQueries = queries;\n    if (queries && queries.length > 0) {\n      expandedQueries = queries.map(query => {\n        const expandedQuery = {\n          ...query,\n          datasource: this.name,\n          rawSql: this.templateSrv.replace(query.rawSql, {}, this.interpolateVariable),\n        };\n        return expandedQuery;\n      });\n    }\n    return expandedQueries;\n  }\n\n  query(options: any) {\n    const queries = _.filter(options.targets, target => {\n      return target.hide !== true;\n    }).map(target => {\n      const queryModel = new PostgresQuery(target, this.templateSrv, options.scopedVars);\n\n      return {\n        refId: target.refId,\n        intervalMs: options.intervalMs,\n        maxDataPoints: options.maxDataPoints,\n        datasourceId: this.id,\n        rawSql: queryModel.render(this.interpolateVariable),\n        format: target.format,\n      };\n    });\n\n    if (queries.length === 0) {\n      return this.$q.when({ data: [] });\n    }\n\n    return this.backendSrv\n      .datasourceRequest({\n        url: '/api/tsdb/query',\n        method: 'POST',\n        data: {\n          from: options.range.from.valueOf().toString(),\n          to: options.range.to.valueOf().toString(),\n          queries: queries,\n        },\n      })\n      .then(this.responseParser.processQueryResult);\n  }\n\n  annotationQuery(options: any) {\n    if (!options.annotation.rawQuery) {\n      return this.$q.reject({\n        message: 'Query missing in annotation definition',\n      });\n    }\n\n    const query = {\n      refId: options.annotation.name,\n      datasourceId: this.id,\n      rawSql: this.templateSrv.replace(options.annotation.rawQuery, options.scopedVars, this.interpolateVariable),\n      format: 'table',\n    };\n\n    return this.backendSrv\n      .datasourceRequest({\n        url: '/api/tsdb/query',\n        method: 'POST',\n        data: {\n          from: options.range.from.valueOf().toString(),\n          to: options.range.to.valueOf().toString(),\n          queries: [query],\n        },\n      })\n      .then((data: any) => this.responseParser.transformAnnotationResponse(options, data));\n  }\n\n  metricFindQuery(query: string, optionalOptions: { variable?: any; searchFilter?: string }) {\n    let refId = 'tempvar';\n    if (optionalOptions && optionalOptions.variable && optionalOptions.variable.name) {\n      refId = optionalOptions.variable.name;\n    }\n\n    const rawSql = this.templateSrv.replace(\n      query,\n      getSearchFilterScopedVar({ query, wildcardChar: '%', options: optionalOptions }),\n      this.interpolateVariable\n    );\n\n    const interpolatedQuery = {\n      refId: refId,\n      datasourceId: this.id,\n      rawSql,\n      format: 'table',\n    };\n\n    const range = this.timeSrv.timeRange();\n    const data = {\n      queries: [interpolatedQuery],\n      from: range.from.valueOf().toString(),\n      to: range.to.valueOf().toString(),\n    };\n\n    return this.backendSrv\n      .datasourceRequest({\n        url: '/api/tsdb/query',\n        method: 'POST',\n        data: data,\n      })\n      .then((data: any) => this.responseParser.parseMetricFindQueryResult(refId, data));\n  }\n\n  getVersion() {\n    return this.metricFindQuery(\"SELECT current_setting('server_version_num')::int/100\", {});\n  }\n\n  getTimescaleDBVersion() {\n    return this.metricFindQuery(\"SELECT extversion FROM pg_extension WHERE extname = 'timescaledb'\", {});\n  }\n\n  testDatasource() {\n    return this.metricFindQuery('SELECT 1', {})\n      .then((res: any) => {\n        return { status: 'success', message: 'Database Connection OK' };\n      })\n      .catch((err: any) => {\n        console.log(err);\n        if (err.data && err.data.message) {\n          return { status: 'error', message: err.data.message };\n        } else {\n          return { status: 'error', message: err.status };\n        }\n      });\n  }\n\n  targetContainsTemplate(target: any) {\n    let rawSql = '';\n\n    if (target.rawQuery) {\n      rawSql = target.rawSql;\n    } else {\n      const query = new PostgresQuery(target);\n      rawSql = query.buildQuery();\n    }\n\n    rawSql = rawSql.replace('$__', '');\n\n    return this.templateSrv.variableExists(rawSql);\n  }\n}\n","import QueryModel from './postgres_query';\n\nexport class PostgresMetaQuery {\n  constructor(private target: { table: string; timeColumn: string }, private queryModel: QueryModel) {}\n\n  getOperators(datatype: string) {\n    switch (datatype) {\n      case 'float4':\n      case 'float8': {\n        return ['=', '!=', '<', '<=', '>', '>='];\n      }\n      case 'text':\n      case 'varchar':\n      case 'char': {\n        return ['=', '!=', '<', '<=', '>', '>=', 'IN', 'NOT IN', 'LIKE', 'NOT LIKE', '~', '~*', '!~', '!~*'];\n      }\n      default: {\n        return ['=', '!=', '<', '<=', '>', '>=', 'IN', 'NOT IN'];\n      }\n    }\n  }\n\n  // quote identifier as literal to use in metadata queries\n  quoteIdentAsLiteral(value: string) {\n    return this.queryModel.quoteLiteral(this.queryModel.unquoteIdentifier(value));\n  }\n\n  findMetricTable() {\n    // query that returns first table found that has a timestamp(tz) column and a float column\n    let query = `\nSELECT\n\tquote_ident(table_name) as table_name,\n\t( SELECT\n\t    quote_ident(column_name) as column_name\n\t  FROM information_schema.columns c\n    WHERE\n      c.table_schema = t.table_schema AND\n      c.table_name = t.table_name AND\n      udt_name IN ('timestamptz','timestamp')\n    ORDER BY ordinal_position LIMIT 1\n  ) AS time_column,\n  ( SELECT\n      quote_ident(column_name) AS column_name\n    FROM information_schema.columns c\n    WHERE\n      c.table_schema = t.table_schema AND\n      c.table_name = t.table_name AND\n      udt_name='float8'\n    ORDER BY ordinal_position LIMIT 1\n  ) AS value_column\nFROM information_schema.tables t\nWHERE `;\n    query += this.buildSchemaConstraint();\n    query += ` AND\n  EXISTS\n  ( SELECT 1\n    FROM information_schema.columns c\n    WHERE\n      c.table_schema = t.table_schema AND\n      c.table_name = t.table_name AND\n      udt_name IN ('timestamptz','timestamp')\n  ) AND\n  EXISTS\n  ( SELECT 1\n    FROM information_schema.columns c\n    WHERE\n      c.table_schema = t.table_schema AND\n      c.table_name = t.table_name AND\n      udt_name='float8'\n  )\nLIMIT 1\n;`;\n    return query;\n  }\n\n  buildSchemaConstraint() {\n    const query = `\ntable_schema IN (\n  SELECT\n    CASE WHEN trim(s[i]) = '\"$user\"' THEN user ELSE trim(s[i]) END\n  FROM\n    generate_series(\n      array_lower(string_to_array(current_setting('search_path'),','),1),\n      array_upper(string_to_array(current_setting('search_path'),','),1)\n    ) as i,\n    string_to_array(current_setting('search_path'),',') s\n)`;\n    return query;\n  }\n\n  buildTableConstraint(table: string) {\n    let query = '';\n\n    // check for schema qualified table\n    if (table.includes('.')) {\n      const parts = table.split('.');\n      query = 'table_schema = ' + this.quoteIdentAsLiteral(parts[0]);\n      query += ' AND table_name = ' + this.quoteIdentAsLiteral(parts[1]);\n      return query;\n    } else {\n      query = this.buildSchemaConstraint();\n      query += ' AND table_name = ' + this.quoteIdentAsLiteral(table);\n\n      return query;\n    }\n  }\n\n  buildTableQuery() {\n    let query = 'SELECT quote_ident(table_name) FROM information_schema.tables WHERE ';\n    query += this.buildSchemaConstraint();\n    query += ' ORDER BY table_name';\n    return query;\n  }\n\n  buildColumnQuery(type?: string) {\n    let query = 'SELECT quote_ident(column_name) FROM information_schema.columns WHERE ';\n    query += this.buildTableConstraint(this.target.table);\n\n    switch (type) {\n      case 'time': {\n        query +=\n          \" AND data_type IN ('timestamp without time zone','timestamp with time zone','bigint','integer','double precision','real')\";\n        break;\n      }\n      case 'metric': {\n        query += \" AND data_type IN ('text','character','character varying')\";\n        break;\n      }\n      case 'value': {\n        query += \" AND data_type IN ('bigint','integer','double precision','real')\";\n        query += ' AND column_name <> ' + this.quoteIdentAsLiteral(this.target.timeColumn);\n        break;\n      }\n      case 'group': {\n        query += \" AND data_type IN ('text','character','character varying')\";\n        break;\n      }\n    }\n\n    query += ' ORDER BY column_name';\n\n    return query;\n  }\n\n  buildValueQuery(column: string) {\n    let query = 'SELECT DISTINCT quote_literal(' + column + ')';\n    query += ' FROM ' + this.target.table;\n    query += ' WHERE $__timeFilter(' + this.target.timeColumn + ')';\n    query += ' AND ' + column + ' IS NOT NULL';\n    query += ' ORDER BY 1 LIMIT 100';\n    return query;\n  }\n\n  buildDatatypeQuery(column: string) {\n    let query = 'SELECT udt_name FROM information_schema.columns WHERE ';\n    query += this.buildTableConstraint(this.target.table);\n    query += ' AND column_name = ' + this.quoteIdentAsLiteral(column);\n    return query;\n  }\n\n  buildAggregateQuery() {\n    let query = 'SELECT DISTINCT proname FROM pg_aggregate ';\n    query += 'INNER JOIN pg_proc ON pg_aggregate.aggfnoid = pg_proc.oid ';\n    query += 'INNER JOIN pg_type ON pg_type.oid=pg_proc.prorettype ';\n    query += \"WHERE pronargs=1 AND typname IN ('float8') AND aggkind='n' ORDER BY 1\";\n    return query;\n  }\n}\n","import { SqlPartDef, SqlPart } from 'app/core/components/sql_part/sql_part';\n\nconst index: any[] = [];\n\nfunction createPart(part: any): any {\n  const def = index[part.type];\n  if (!def) {\n    return null;\n  }\n\n  return new SqlPart(part, def);\n}\n\nfunction register(options: any) {\n  index[options.type] = new SqlPartDef(options);\n}\n\nregister({\n  type: 'column',\n  style: 'label',\n  params: [{ type: 'column', dynamicLookup: true }],\n  defaultParams: ['value'],\n});\n\nregister({\n  type: 'expression',\n  style: 'expression',\n  label: 'Expr:',\n  params: [\n    { name: 'left', type: 'string', dynamicLookup: true },\n    { name: 'op', type: 'string', dynamicLookup: true },\n    { name: 'right', type: 'string', dynamicLookup: true },\n  ],\n  defaultParams: ['value', '=', 'value'],\n});\n\nregister({\n  type: 'macro',\n  style: 'label',\n  label: 'Macro:',\n  params: [],\n  defaultParams: [],\n});\n\nregister({\n  type: 'aggregate',\n  style: 'label',\n  params: [\n    {\n      name: 'name',\n      type: 'string',\n      options: ['avg', 'count', 'min', 'max', 'sum', 'stddev', 'variance'],\n    },\n  ],\n  defaultParams: ['avg'],\n});\n\nregister({\n  type: 'percentile',\n  label: 'Aggregate:',\n  style: 'label',\n  params: [\n    {\n      name: 'name',\n      type: 'string',\n      options: ['percentile_cont', 'percentile_disc'],\n    },\n    {\n      name: 'fraction',\n      type: 'number',\n      options: ['0.5', '0.75', '0.9', '0.95', '0.99'],\n    },\n  ],\n  defaultParams: ['percentile_cont', '0.95'],\n});\n\nregister({\n  type: 'alias',\n  style: 'label',\n  params: [{ name: 'name', type: 'string', quote: 'double' }],\n  defaultParams: ['alias'],\n});\n\nregister({\n  type: 'time',\n  style: 'function',\n  label: 'time',\n  params: [\n    {\n      name: 'interval',\n      type: 'interval',\n      options: ['$__interval', '1s', '10s', '1m', '5m', '10m', '15m', '1h'],\n    },\n    {\n      name: 'fill',\n      type: 'string',\n      options: ['none', 'NULL', 'previous', '0'],\n    },\n  ],\n  defaultParams: ['$__interval', 'none'],\n});\n\nregister({\n  type: 'window',\n  style: 'label',\n  params: [\n    {\n      name: 'function',\n      type: 'string',\n      options: ['delta', 'increase', 'rate', 'sum'],\n    },\n  ],\n  defaultParams: ['increase'],\n});\n\nregister({\n  type: 'moving_window',\n  style: 'label',\n  label: 'Moving Window:',\n  params: [\n    {\n      name: 'function',\n      type: 'string',\n      options: ['avg'],\n    },\n    {\n      name: 'window_size',\n      type: 'number',\n      options: ['3', '5', '7', '10', '20'],\n    },\n  ],\n  defaultParams: ['avg', '5'],\n});\n\nexport default {\n  create: createPart,\n};\n","import _ from 'lodash';\nimport appEvents from 'app/core/app_events';\nimport { PostgresMetaQuery } from './meta_query';\nimport { QueryCtrl } from 'app/plugins/sdk';\nimport { SqlPart } from 'app/core/components/sql_part/sql_part';\nimport PostgresQuery from './postgres_query';\nimport sqlPart from './sql_part';\nimport { auto, IQService } from 'angular';\nimport { TemplateSrv } from 'app/features/templating/template_srv';\nimport { CoreEvents } from 'app/types';\nimport { PanelEvents } from '@grafana/data';\n\nexport interface QueryMeta {\n  sql: string;\n}\n\nconst defaultQuery = `SELECT\n  $__time(time_column),\n  value1\nFROM\n  metric_table\nWHERE\n  $__timeFilter(time_column)\n`;\n\nexport class PostgresQueryCtrl extends QueryCtrl {\n  static templateUrl = 'partials/query.editor.html';\n\n  showLastQuerySQL: boolean;\n  formats: any[];\n  queryModel: PostgresQuery;\n  metaBuilder: PostgresMetaQuery;\n  lastQueryMeta: QueryMeta;\n  lastQueryError: string;\n  showHelp: boolean;\n  tableSegment: any;\n  whereAdd: any;\n  timeColumnSegment: any;\n  metricColumnSegment: any;\n  selectMenu: any[];\n  selectParts: SqlPart[][];\n  groupParts: SqlPart[];\n  whereParts: SqlPart[];\n  groupAdd: any;\n\n  /** @ngInject */\n  constructor(\n    $scope: any,\n    $injector: auto.IInjectorService,\n    private templateSrv: TemplateSrv,\n    private $q: IQService,\n    private uiSegmentSrv: any\n  ) {\n    super($scope, $injector);\n    this.target = this.target;\n    this.queryModel = new PostgresQuery(this.target, templateSrv, this.panel.scopedVars);\n    this.metaBuilder = new PostgresMetaQuery(this.target, this.queryModel);\n    this.updateProjection();\n\n    this.formats = [{ text: 'Time series', value: 'time_series' }, { text: 'Table', value: 'table' }];\n\n    if (!this.target.rawSql) {\n      // special handling when in table panel\n      if (this.panelCtrl.panel.type === 'table') {\n        this.target.format = 'table';\n        this.target.rawSql = 'SELECT 1';\n        this.target.rawQuery = true;\n      } else {\n        this.target.rawSql = defaultQuery;\n        this.datasource.metricFindQuery(this.metaBuilder.findMetricTable()).then((result: any) => {\n          if (result.length > 0) {\n            this.target.table = result[0].text;\n            let segment = this.uiSegmentSrv.newSegment(this.target.table);\n            this.tableSegment.html = segment.html;\n            this.tableSegment.value = segment.value;\n\n            this.target.timeColumn = result[1].text;\n            segment = this.uiSegmentSrv.newSegment(this.target.timeColumn);\n            this.timeColumnSegment.html = segment.html;\n            this.timeColumnSegment.value = segment.value;\n\n            this.target.timeColumnType = 'timestamp';\n            this.target.select = [[{ type: 'column', params: [result[2].text] }]];\n            this.updateProjection();\n            this.updateRawSqlAndRefresh();\n          }\n        });\n      }\n    }\n\n    if (!this.target.table) {\n      this.tableSegment = uiSegmentSrv.newSegment({ value: 'select table', fake: true });\n    } else {\n      this.tableSegment = uiSegmentSrv.newSegment(this.target.table);\n    }\n\n    this.timeColumnSegment = uiSegmentSrv.newSegment(this.target.timeColumn);\n    this.metricColumnSegment = uiSegmentSrv.newSegment(this.target.metricColumn);\n\n    this.buildSelectMenu();\n    this.whereAdd = this.uiSegmentSrv.newPlusButton();\n    this.groupAdd = this.uiSegmentSrv.newPlusButton();\n\n    this.panelCtrl.events.on(PanelEvents.dataReceived, this.onDataReceived.bind(this), $scope);\n    this.panelCtrl.events.on(PanelEvents.dataError, this.onDataError.bind(this), $scope);\n  }\n\n  updateRawSqlAndRefresh() {\n    if (!this.target.rawQuery) {\n      this.target.rawSql = this.queryModel.buildQuery();\n    }\n\n    this.panelCtrl.refresh();\n  }\n\n  updateProjection() {\n    this.selectParts = _.map(this.target.select, (parts: any) => {\n      return _.map(parts, sqlPart.create).filter(n => n);\n    });\n    this.whereParts = _.map(this.target.where, sqlPart.create).filter(n => n);\n    this.groupParts = _.map(this.target.group, sqlPart.create).filter(n => n);\n  }\n\n  updatePersistedParts() {\n    this.target.select = _.map(this.selectParts, selectParts => {\n      return _.map(selectParts, (part: any) => {\n        return { type: part.def.type, datatype: part.datatype, params: part.params };\n      });\n    });\n    this.target.where = _.map(this.whereParts, (part: any) => {\n      return { type: part.def.type, datatype: part.datatype, name: part.name, params: part.params };\n    });\n    this.target.group = _.map(this.groupParts, (part: any) => {\n      return { type: part.def.type, datatype: part.datatype, params: part.params };\n    });\n  }\n\n  buildSelectMenu() {\n    this.selectMenu = [];\n    const aggregates = {\n      text: 'Aggregate Functions',\n      value: 'aggregate',\n      submenu: [\n        { text: 'Average', value: 'avg' },\n        { text: 'Count', value: 'count' },\n        { text: 'Maximum', value: 'max' },\n        { text: 'Minimum', value: 'min' },\n        { text: 'Sum', value: 'sum' },\n        { text: 'Standard deviation', value: 'stddev' },\n        { text: 'Variance', value: 'variance' },\n      ],\n    };\n\n    // first and last aggregate are timescaledb specific\n    if (this.datasource.jsonData.timescaledb === true) {\n      aggregates.submenu.push({ text: 'First', value: 'first' });\n      aggregates.submenu.push({ text: 'Last', value: 'last' });\n    }\n\n    this.selectMenu.push(aggregates);\n\n    // ordered set aggregates require postgres 9.4+\n    if (this.datasource.jsonData.postgresVersion >= 904) {\n      const aggregates2 = {\n        text: 'Ordered-Set Aggregate Functions',\n        value: 'percentile',\n        submenu: [\n          { text: 'Percentile (continuous)', value: 'percentile_cont' },\n          { text: 'Percentile (discrete)', value: 'percentile_disc' },\n        ],\n      };\n      this.selectMenu.push(aggregates2);\n    }\n\n    const windows = {\n      text: 'Window Functions',\n      value: 'window',\n      submenu: [\n        { text: 'Delta', value: 'delta' },\n        { text: 'Increase', value: 'increase' },\n        { text: 'Rate', value: 'rate' },\n        { text: 'Sum', value: 'sum' },\n        { text: 'Moving Average', value: 'avg', type: 'moving_window' },\n      ],\n    };\n    this.selectMenu.push(windows);\n\n    this.selectMenu.push({ text: 'Alias', value: 'alias' });\n    this.selectMenu.push({ text: 'Column', value: 'column' });\n  }\n\n  toggleEditorMode() {\n    if (this.target.rawQuery) {\n      appEvents.emit(CoreEvents.showConfirmModal, {\n        title: 'Warning',\n        text2: 'Switching to query builder may overwrite your raw SQL.',\n        icon: 'fa-exclamation',\n        yesText: 'Switch',\n        onConfirm: () => {\n          this.target.rawQuery = !this.target.rawQuery;\n        },\n      });\n    } else {\n      this.target.rawQuery = !this.target.rawQuery;\n    }\n  }\n\n  resetPlusButton(button: { html: any; value: any }) {\n    const plusButton = this.uiSegmentSrv.newPlusButton();\n    button.html = plusButton.html;\n    button.value = plusButton.value;\n  }\n\n  getTableSegments() {\n    return this.datasource\n      .metricFindQuery(this.metaBuilder.buildTableQuery())\n      .then(this.transformToSegments({}))\n      .catch(this.handleQueryError.bind(this));\n  }\n\n  tableChanged() {\n    this.target.table = this.tableSegment.value;\n    this.target.where = [];\n    this.target.group = [];\n    this.updateProjection();\n\n    const segment = this.uiSegmentSrv.newSegment('none');\n    this.metricColumnSegment.html = segment.html;\n    this.metricColumnSegment.value = segment.value;\n    this.target.metricColumn = 'none';\n\n    const task1 = this.datasource.metricFindQuery(this.metaBuilder.buildColumnQuery('time')).then((result: any) => {\n      // check if time column is still valid\n      if (result.length > 0 && !_.find(result, (r: any) => r.text === this.target.timeColumn)) {\n        const segment = this.uiSegmentSrv.newSegment(result[0].text);\n        this.timeColumnSegment.html = segment.html;\n        this.timeColumnSegment.value = segment.value;\n      }\n      return this.timeColumnChanged(false);\n    });\n    const task2 = this.datasource.metricFindQuery(this.metaBuilder.buildColumnQuery('value')).then((result: any) => {\n      if (result.length > 0) {\n        this.target.select = [[{ type: 'column', params: [result[0].text] }]];\n        this.updateProjection();\n      }\n    });\n\n    this.$q.all([task1, task2]).then(() => {\n      this.updateRawSqlAndRefresh();\n    });\n  }\n\n  getTimeColumnSegments() {\n    return this.datasource\n      .metricFindQuery(this.metaBuilder.buildColumnQuery('time'))\n      .then(this.transformToSegments({}))\n      .catch(this.handleQueryError.bind(this));\n  }\n\n  timeColumnChanged(refresh?: boolean) {\n    this.target.timeColumn = this.timeColumnSegment.value;\n    return this.datasource\n      .metricFindQuery(this.metaBuilder.buildDatatypeQuery(this.target.timeColumn))\n      .then((result: any) => {\n        if (result.length === 1) {\n          if (this.target.timeColumnType !== result[0].text) {\n            this.target.timeColumnType = result[0].text;\n          }\n          let partModel;\n          if (this.queryModel.hasUnixEpochTimecolumn()) {\n            partModel = sqlPart.create({ type: 'macro', name: '$__unixEpochFilter', params: [] });\n          } else {\n            partModel = sqlPart.create({ type: 'macro', name: '$__timeFilter', params: [] });\n          }\n\n          if (this.whereParts.length >= 1 && this.whereParts[0].def.type === 'macro') {\n            // replace current macro\n            this.whereParts[0] = partModel;\n          } else {\n            this.whereParts.splice(0, 0, partModel);\n          }\n        }\n\n        this.updatePersistedParts();\n        if (refresh !== false) {\n          this.updateRawSqlAndRefresh();\n        }\n      });\n  }\n\n  getMetricColumnSegments() {\n    return this.datasource\n      .metricFindQuery(this.metaBuilder.buildColumnQuery('metric'))\n      .then(this.transformToSegments({ addNone: true }))\n      .catch(this.handleQueryError.bind(this));\n  }\n\n  metricColumnChanged() {\n    this.target.metricColumn = this.metricColumnSegment.value;\n    this.updateRawSqlAndRefresh();\n  }\n\n  onDataReceived(dataList: any) {\n    this.lastQueryMeta = null;\n    this.lastQueryError = null;\n    console.log('postgres query data received', dataList);\n\n    const anySeriesFromQuery: any = _.find(dataList, { refId: this.target.refId });\n    if (anySeriesFromQuery) {\n      this.lastQueryMeta = anySeriesFromQuery.meta;\n    }\n  }\n\n  onDataError(err: any) {\n    if (err.data && err.data.results) {\n      const queryRes = err.data.results[this.target.refId];\n      if (queryRes) {\n        this.lastQueryMeta = queryRes.meta;\n        this.lastQueryError = queryRes.error;\n      }\n    }\n  }\n\n  transformToSegments(config: { addNone?: any; addTemplateVars?: any; templateQuoter?: any }) {\n    return (results: any) => {\n      const segments = _.map(results, segment => {\n        return this.uiSegmentSrv.newSegment({\n          value: segment.text,\n          expandable: segment.expandable,\n        });\n      });\n\n      if (config.addTemplateVars) {\n        for (const variable of this.templateSrv.variables) {\n          let value;\n          value = '$' + variable.name;\n          if (config.templateQuoter && variable.multi === false) {\n            value = config.templateQuoter(value);\n          }\n\n          segments.unshift(\n            this.uiSegmentSrv.newSegment({\n              type: 'template',\n              value: value,\n              expandable: true,\n            })\n          );\n        }\n      }\n\n      if (config.addNone) {\n        segments.unshift(this.uiSegmentSrv.newSegment({ type: 'template', value: 'none', expandable: true }));\n      }\n\n      return segments;\n    };\n  }\n\n  findAggregateIndex(selectParts: any) {\n    return _.findIndex(selectParts, (p: any) => p.def.type === 'aggregate' || p.def.type === 'percentile');\n  }\n\n  findWindowIndex(selectParts: any) {\n    return _.findIndex(selectParts, (p: any) => p.def.type === 'window' || p.def.type === 'moving_window');\n  }\n\n  addSelectPart(selectParts: any[], item: { value: any }, subItem: { type: any; value: any }) {\n    let partType = item.value;\n    if (subItem && subItem.type) {\n      partType = subItem.type;\n    }\n    let partModel = sqlPart.create({ type: partType });\n    if (subItem) {\n      partModel.params[0] = subItem.value;\n    }\n    let addAlias = false;\n\n    switch (partType) {\n      case 'column':\n        const parts = _.map(selectParts, (part: any) => {\n          return sqlPart.create({ type: part.def.type, params: _.clone(part.params) });\n        });\n        this.selectParts.push(parts);\n        break;\n      case 'percentile':\n      case 'aggregate':\n        // add group by if no group by yet\n        if (this.target.group.length === 0) {\n          this.addGroup('time', '$__interval');\n        }\n        const aggIndex = this.findAggregateIndex(selectParts);\n        if (aggIndex !== -1) {\n          // replace current aggregation\n          selectParts[aggIndex] = partModel;\n        } else {\n          selectParts.splice(1, 0, partModel);\n        }\n        if (!_.find(selectParts, (p: any) => p.def.type === 'alias')) {\n          addAlias = true;\n        }\n        break;\n      case 'moving_window':\n      case 'window':\n        const windowIndex = this.findWindowIndex(selectParts);\n        if (windowIndex !== -1) {\n          // replace current window function\n          selectParts[windowIndex] = partModel;\n        } else {\n          const aggIndex = this.findAggregateIndex(selectParts);\n          if (aggIndex !== -1) {\n            selectParts.splice(aggIndex + 1, 0, partModel);\n          } else {\n            selectParts.splice(1, 0, partModel);\n          }\n        }\n        if (!_.find(selectParts, (p: any) => p.def.type === 'alias')) {\n          addAlias = true;\n        }\n        break;\n      case 'alias':\n        addAlias = true;\n        break;\n    }\n\n    if (addAlias) {\n      // set initial alias name to column name\n      partModel = sqlPart.create({ type: 'alias', params: [selectParts[0].params[0].replace(/\"/g, '')] });\n      if (selectParts[selectParts.length - 1].def.type === 'alias') {\n        selectParts[selectParts.length - 1] = partModel;\n      } else {\n        selectParts.push(partModel);\n      }\n    }\n\n    this.updatePersistedParts();\n    this.updateRawSqlAndRefresh();\n  }\n\n  removeSelectPart(selectParts: any, part: { def: { type: string } }) {\n    if (part.def.type === 'column') {\n      // remove all parts of column unless its last column\n      if (this.selectParts.length > 1) {\n        const modelsIndex = _.indexOf(this.selectParts, selectParts);\n        this.selectParts.splice(modelsIndex, 1);\n      }\n    } else {\n      const partIndex = _.indexOf(selectParts, part);\n      selectParts.splice(partIndex, 1);\n    }\n\n    this.updatePersistedParts();\n  }\n\n  handleSelectPartEvent(selectParts: any, part: { def: any }, evt: { name: any }) {\n    switch (evt.name) {\n      case 'get-param-options': {\n        switch (part.def.type) {\n          case 'aggregate':\n            return this.datasource\n              .metricFindQuery(this.metaBuilder.buildAggregateQuery())\n              .then(this.transformToSegments({}))\n              .catch(this.handleQueryError.bind(this));\n          case 'column':\n            return this.datasource\n              .metricFindQuery(this.metaBuilder.buildColumnQuery('value'))\n              .then(this.transformToSegments({}))\n              .catch(this.handleQueryError.bind(this));\n        }\n      }\n      case 'part-param-changed': {\n        this.updatePersistedParts();\n        this.updateRawSqlAndRefresh();\n        break;\n      }\n      case 'action': {\n        this.removeSelectPart(selectParts, part);\n        this.updateRawSqlAndRefresh();\n        break;\n      }\n      case 'get-part-actions': {\n        return this.$q.when([{ text: 'Remove', value: 'remove-part' }]);\n      }\n    }\n  }\n\n  handleGroupPartEvent(part: any, index: any, evt: { name: any }) {\n    switch (evt.name) {\n      case 'get-param-options': {\n        return this.datasource\n          .metricFindQuery(this.metaBuilder.buildColumnQuery())\n          .then(this.transformToSegments({}))\n          .catch(this.handleQueryError.bind(this));\n      }\n      case 'part-param-changed': {\n        this.updatePersistedParts();\n        this.updateRawSqlAndRefresh();\n        break;\n      }\n      case 'action': {\n        this.removeGroup(part, index);\n        this.updateRawSqlAndRefresh();\n        break;\n      }\n      case 'get-part-actions': {\n        return this.$q.when([{ text: 'Remove', value: 'remove-part' }]);\n      }\n    }\n  }\n\n  addGroup(partType: string, value: string) {\n    let params = [value];\n    if (partType === 'time') {\n      params = ['$__interval', 'none'];\n    }\n    const partModel = sqlPart.create({ type: partType, params: params });\n\n    if (partType === 'time') {\n      // put timeGroup at start\n      this.groupParts.splice(0, 0, partModel);\n    } else {\n      this.groupParts.push(partModel);\n    }\n\n    // add aggregates when adding group by\n    for (const selectParts of this.selectParts) {\n      if (!selectParts.some(part => part.def.type === 'aggregate')) {\n        const aggregate = sqlPart.create({ type: 'aggregate', params: ['avg'] });\n        selectParts.splice(1, 0, aggregate);\n        if (!selectParts.some(part => part.def.type === 'alias')) {\n          const alias = sqlPart.create({ type: 'alias', params: [selectParts[0].part.params[0]] });\n          selectParts.push(alias);\n        }\n      }\n    }\n\n    this.updatePersistedParts();\n  }\n\n  removeGroup(part: { def: { type: string } }, index: number) {\n    if (part.def.type === 'time') {\n      // remove aggregations\n      this.selectParts = _.map(this.selectParts, (s: any) => {\n        return _.filter(s, (part: any) => {\n          if (part.def.type === 'aggregate' || part.def.type === 'percentile') {\n            return false;\n          }\n          return true;\n        });\n      });\n    }\n\n    this.groupParts.splice(index, 1);\n    this.updatePersistedParts();\n  }\n\n  handleWherePartEvent(whereParts: any, part: any, evt: any, index: any) {\n    switch (evt.name) {\n      case 'get-param-options': {\n        switch (evt.param.name) {\n          case 'left':\n            return this.datasource\n              .metricFindQuery(this.metaBuilder.buildColumnQuery())\n              .then(this.transformToSegments({}))\n              .catch(this.handleQueryError.bind(this));\n          case 'right':\n            if (['int4', 'int8', 'float4', 'float8', 'timestamp', 'timestamptz'].indexOf(part.datatype) > -1) {\n              // don't do value lookups for numerical fields\n              return this.$q.when([]);\n            } else {\n              return this.datasource\n                .metricFindQuery(this.metaBuilder.buildValueQuery(part.params[0]))\n                .then(\n                  this.transformToSegments({\n                    addTemplateVars: true,\n                    templateQuoter: (v: string) => {\n                      return this.queryModel.quoteLiteral(v);\n                    },\n                  })\n                )\n                .catch(this.handleQueryError.bind(this));\n            }\n          case 'op':\n            return this.$q.when(this.uiSegmentSrv.newOperators(this.metaBuilder.getOperators(part.datatype)));\n          default:\n            return this.$q.when([]);\n        }\n      }\n      case 'part-param-changed': {\n        this.updatePersistedParts();\n        this.datasource.metricFindQuery(this.metaBuilder.buildDatatypeQuery(part.params[0])).then((d: any) => {\n          if (d.length === 1) {\n            part.datatype = d[0].text;\n          }\n        });\n        this.updateRawSqlAndRefresh();\n        break;\n      }\n      case 'action': {\n        // remove element\n        whereParts.splice(index, 1);\n        this.updatePersistedParts();\n        this.updateRawSqlAndRefresh();\n        break;\n      }\n      case 'get-part-actions': {\n        return this.$q.when([{ text: 'Remove', value: 'remove-part' }]);\n      }\n    }\n  }\n\n  getWhereOptions() {\n    const options = [];\n    if (this.queryModel.hasUnixEpochTimecolumn()) {\n      options.push(this.uiSegmentSrv.newSegment({ type: 'macro', value: '$__unixEpochFilter' }));\n    } else {\n      options.push(this.uiSegmentSrv.newSegment({ type: 'macro', value: '$__timeFilter' }));\n    }\n    options.push(this.uiSegmentSrv.newSegment({ type: 'expression', value: 'Expression' }));\n    return this.$q.when(options);\n  }\n\n  addWhereAction(part: any, index: any) {\n    switch (this.whereAdd.type) {\n      case 'macro': {\n        const partModel = sqlPart.create({ type: 'macro', name: this.whereAdd.value, params: [] });\n        if (this.whereParts.length >= 1 && this.whereParts[0].def.type === 'macro') {\n          // replace current macro\n          this.whereParts[0] = partModel;\n        } else {\n          this.whereParts.splice(0, 0, partModel);\n        }\n        break;\n      }\n      default: {\n        this.whereParts.push(sqlPart.create({ type: 'expression', params: ['value', '=', 'value'] }));\n      }\n    }\n\n    this.updatePersistedParts();\n    this.resetPlusButton(this.whereAdd);\n    this.updateRawSqlAndRefresh();\n  }\n\n  getGroupOptions() {\n    return this.datasource\n      .metricFindQuery(this.metaBuilder.buildColumnQuery('group'))\n      .then((tags: any) => {\n        const options = [];\n        if (!this.queryModel.hasTimeGroup()) {\n          options.push(this.uiSegmentSrv.newSegment({ type: 'time', value: 'time($__interval,none)' }));\n        }\n        for (const tag of tags) {\n          options.push(this.uiSegmentSrv.newSegment({ type: 'column', value: tag.text }));\n        }\n        return options;\n      })\n      .catch(this.handleQueryError.bind(this));\n  }\n\n  addGroupAction() {\n    switch (this.groupAdd.value) {\n      default: {\n        this.addGroup(this.groupAdd.type, this.groupAdd.value);\n      }\n    }\n\n    this.resetPlusButton(this.groupAdd);\n    this.updateRawSqlAndRefresh();\n  }\n\n  handleQueryError(err: any): any[] {\n    this.error = err.message || 'Failed to issue metric query';\n    return [];\n  }\n}\n","import _ from 'lodash';\nimport {\n  createChangeHandler,\n  createResetHandler,\n  PasswordFieldEnum,\n} from '../../../features/datasources/utils/passwordHandlers';\nimport DatasourceSrv from 'app/features/plugins/datasource_srv';\n\nexport class PostgresConfigCtrl {\n  static templateUrl = 'partials/config.html';\n\n  current: any;\n  datasourceSrv: any;\n  showTimescaleDBHelp: boolean;\n  onPasswordReset: ReturnType<typeof createResetHandler>;\n  onPasswordChange: ReturnType<typeof createChangeHandler>;\n\n  /** @ngInject */\n  constructor($scope: any, datasourceSrv: DatasourceSrv) {\n    this.datasourceSrv = datasourceSrv;\n    this.current.jsonData.sslmode = this.current.jsonData.sslmode || 'verify-full';\n    this.current.jsonData.postgresVersion = this.current.jsonData.postgresVersion || 903;\n    this.showTimescaleDBHelp = false;\n    this.autoDetectFeatures();\n    this.onPasswordReset = createResetHandler(this, PasswordFieldEnum.Password);\n    this.onPasswordChange = createChangeHandler(this, PasswordFieldEnum.Password);\n  }\n\n  autoDetectFeatures() {\n    if (!this.current.id) {\n      return;\n    }\n\n    this.datasourceSrv.loadDatasource(this.current.name).then((ds: any) => {\n      return ds.getVersion().then((version: any) => {\n        version = Number(version[0].text);\n\n        // timescaledb is only available for 9.6+\n        if (version >= 906) {\n          ds.getTimescaleDBVersion().then((version: any) => {\n            if (version.length === 1) {\n              this.current.jsonData.timescaledb = true;\n            }\n          });\n        }\n\n        const major = Math.trunc(version / 100);\n        const minor = version % 100;\n        let name = String(major);\n        if (version < 1000) {\n          name = String(major) + '.' + String(minor);\n        }\n        if (!_.find(this.postgresVersions, (p: any) => p.value === version)) {\n          this.postgresVersions.push({ name: name, value: version });\n        }\n        this.current.jsonData.postgresVersion = version;\n      });\n    });\n  }\n\n  toggleTimescaleDBHelp() {\n    this.showTimescaleDBHelp = !this.showTimescaleDBHelp;\n  }\n\n  // the value portion is derived from postgres server_version_num/100\n  postgresVersions = [\n    { name: '9.3', value: 903 },\n    { name: '9.4', value: 904 },\n    { name: '9.5', value: 905 },\n    { name: '9.6', value: 906 },\n    { name: '10', value: 1000 },\n  ];\n}\n","import { PostgresDatasource } from './datasource';\nimport { PostgresQueryCtrl } from './query_ctrl';\nimport { PostgresConfigCtrl } from './config_ctrl';\n\nconst defaultQuery = `SELECT\n  extract(epoch from time_column) AS time,\n  text_column as text,\n  tags_column as tags\nFROM\n  metric_table\nWHERE\n  $__timeFilter(time_column)\n`;\n\nclass PostgresAnnotationsQueryCtrl {\n  static templateUrl = 'partials/annotations.editor.html';\n\n  annotation: any;\n\n  /** @ngInject */\n  constructor() {\n    this.annotation.rawQuery = this.annotation.rawQuery || defaultQuery;\n  }\n}\n\nexport {\n  PostgresDatasource,\n  PostgresDatasource as Datasource,\n  PostgresQueryCtrl as QueryCtrl,\n  PostgresConfigCtrl as ConfigCtrl,\n  PostgresAnnotationsQueryCtrl as AnnotationsQueryCtrl,\n};\n","/**\n * Set of handlers for secure password field in Angular components. They handle backward compatibility with\n * passwords stored in plain text fields.\n */\n\nimport { SyntheticEvent } from 'react';\n\nexport enum PasswordFieldEnum {\n  Password = 'password',\n  BasicAuthPassword = 'basicAuthPassword',\n}\n\n/**\n * Basic shape for settings controllers in at the moment mostly angular datasource plugins.\n */\nexport type Ctrl = {\n  current: {\n    secureJsonFields: {\n      [key: string]: boolean;\n    };\n    secureJsonData?: {\n      [key: string]: string;\n    };\n    password?: string;\n    basicAuthPassword?: string;\n  };\n};\n\nexport const createResetHandler = (ctrl: Ctrl, field: PasswordFieldEnum) => (\n  event: SyntheticEvent<HTMLInputElement>\n) => {\n  event.preventDefault();\n  // Reset also normal plain text password to remove it and only save it in secureJsonData.\n  ctrl.current[field] = null;\n  ctrl.current.secureJsonFields[field] = false;\n  ctrl.current.secureJsonData = ctrl.current.secureJsonData || {};\n  ctrl.current.secureJsonData[field] = '';\n};\n\nexport const createChangeHandler = (ctrl: any, field: PasswordFieldEnum) => (\n  event: SyntheticEvent<HTMLInputElement>\n) => {\n  ctrl.current.secureJsonData = ctrl.current.secureJsonData || {};\n  ctrl.current.secureJsonData[field] = event.currentTarget.value;\n};\n","import _ from 'lodash';\n\nexport class SqlPartDef {\n  type: string;\n  style: string;\n  label: string;\n  params: any[];\n  defaultParams: any[];\n  wrapOpen: string;\n  wrapClose: string;\n  separator: string;\n\n  constructor(options: any) {\n    this.type = options.type;\n    if (options.label) {\n      this.label = options.label;\n    } else {\n      this.label = this.type[0].toUpperCase() + this.type.substring(1) + ':';\n    }\n    this.style = options.style;\n    if (this.style === 'function') {\n      this.wrapOpen = '(';\n      this.wrapClose = ')';\n      this.separator = ', ';\n    } else {\n      this.wrapOpen = ' ';\n      this.wrapClose = ' ';\n      this.separator = ' ';\n    }\n    this.params = options.params;\n    this.defaultParams = options.defaultParams;\n  }\n}\n\nexport class SqlPart {\n  part: any;\n  def: SqlPartDef;\n  params: any[];\n  label: string;\n  name: string;\n  datatype: string;\n\n  constructor(part: any, def: any) {\n    this.part = part;\n    this.def = def;\n    if (!this.def) {\n      throw { message: 'Could not find sql part ' + part.type };\n    }\n\n    this.datatype = part.datatype;\n\n    if (part.name) {\n      this.name = part.name;\n      this.label = def.label + ' ' + part.name;\n    } else {\n      this.name = '';\n      this.label = def.label;\n    }\n\n    part.params = part.params || _.clone(this.def.defaultParams);\n    this.params = part.params;\n  }\n\n  updateParam(strValue: string, index: number) {\n    // handle optional parameters\n    if (strValue === '' && this.def.params[index].optional) {\n      this.params.splice(index, 1);\n    } else {\n      this.params[index] = strValue;\n    }\n\n    this.part.params = this.params;\n  }\n}\n"],"sourceRoot":""}