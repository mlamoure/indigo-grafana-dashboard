(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{sl8e:function(e,t,r){"use strict";r.r(t);var a=r("LvDl"),n=r.n(a),o=r("Obii"),i=r("iZOS");function s(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.series=t.series,this.alias=t.alias,this.annotation=t.annotation}var t,r,a;return t=e,(r=[{key:"getTimeSeries",value:function(){var e,t,r=this,a=[];return 0===this.series.length?a:(n.a.each(this.series,(function(o){var i=o.columns.length,s=n.a.map(o.tags,(function(e,t){return t+": "+e}));for(t=1;t<i;t++){var u=o.name,l=o.columns[t];"value"!==l&&(u=u+"."+l),r.alias?u=r._getSeriesName(o,t):o.tags&&(u=u+" {"+s.join(", ")+"}");var c=[];if(o.values)for(e=0;e<o.values.length;e++)c[e]=[o.values[e][t],o.values[e][0]];a.push({target:u,datapoints:c})}})),a)}},{key:"_getSeriesName",value:function(e,t){var r=e.name.split(".");return this.alias.replace(/\$(\w+)|\[\[([\s\S]+?)\]\]/g,(function(a,n,o){var i=n||o,s=parseInt(i,10);if("m"===i||"measurement"===i)return e.name;if("col"===i)return e.columns[t];if(!isNaN(s))return r[s];if(0!==i.indexOf("tag_"))return a;var u=i.replace("tag_","");return e.tags?e.tags[u]:a}))}},{key:"getAnnotations",value:function(){var e=this,t=[];return n.a.each(this.series,(function(r){var a=null,o=null,i=[],s=null;n.a.each(r.columns,(function(t,r){"time"!==t?"sequence_number"!==t&&(t!==e.annotation.titleColumn?n.a.includes((e.annotation.tagsColumn||"").replace(" ","").split(","),t)?i.push(r):t!==e.annotation.textColumn?a||s===r||(a=r):s=r:a=r):o=r})),n.a.each(r.values,(function(r){var u={annotation:e.annotation,time:+new Date(r[o]),title:r[a],tags:n.a.flatten(i.filter((function(e){return r[e]})).map((function(e){return r[e].split(",")}))),text:r[s]};t.push(u)}))})),t}},{key:"getTable",value:function(){var e,t,r=new i.a;return 0===this.series.length?r:(n.a.each(this.series,(function(a,i){if(0===i)for(t=0,"time"===a.columns[0]&&(r.columns.push({text:"Time",type:o.FieldType.time}),t++),n.a.each(n.a.keys(a.tags),(function(e){r.columns.push({text:e})}));t<a.columns.length;t++)r.columns.push({text:a.columns[t]});if(a.values)for(e=0;e<a.values.length;e++){var s=a.values[e],u=[s[0]];if(a.tags)for(var l in a.tags)a.tags.hasOwnProperty(l)&&u.push(a.tags[l]);for(t=1;t<s.length;t++)u.push(s[t]);r.rows.push(u)}})),r)}}])&&s(t.prototype,r),a&&s(t,a),e}(),l=r("QNPh"),c=[],p={Aggregations:[],Selectors:[],Transformations:[],Predictors:[],Math:[],Aliasing:[],Fields:[]};function f(e){var t=c[e.type];if(!t)throw{message:"Could not find query part "+e.type};return new l.a(e,t)}function m(e){c[e.type]=new l.b(e),e.category.push(c[e.type])}var y=[];function g(e,t){return"*"===e.params[0]?"*":'"'+e.params[0]+'"'}function h(e,t){for(var r=0;r<e.length;r++){var a=e[r];if(a.def.category===p.Aggregations){if(a.def.type===t.def.type)return;if("count"===a.def.type&&"distinct"===t.def.type)break;if("distinct"===a.def.type){var n=e.length>=r+2;if("count"!==t.def.type&&n)e[r+1].def.category===p.Aggregations&&e.splice(r+1,1);else if("count"===t.def.type)return void(n&&"count"===e[r+1].def.type||e.splice(r+1,0,t))}return void(e[r]=t)}if(a.def.category===p.Selectors)return void(e[r]=t)}e.splice(1,0,t)}function d(e,t){var r;for(r=0;r<e.length;r++){var a=e[r];if(a.def.category===p.Math||a.def.category===p.Aliasing)break}e.splice(r,0,t)}m({type:"field",addStrategy:function(e,t,r){var a=n.a.map(e,(function(e){return f({type:e.def.type,params:n.a.clone(e.params)})}));r.selectModels.push(a)},category:p.Fields,params:[{type:"field",dynamicLookup:!0}],defaultParams:["value"],renderer:g}),m({type:"count",addStrategy:h,category:p.Aggregations,params:[],defaultParams:[],renderer:l.c}),m({type:"distinct",addStrategy:h,category:p.Aggregations,params:[],defaultParams:[],renderer:l.c}),m({type:"integral",addStrategy:h,category:p.Aggregations,params:[],defaultParams:[],renderer:l.c}),m({type:"mean",addStrategy:h,category:p.Aggregations,params:[],defaultParams:[],renderer:l.c}),m({type:"median",addStrategy:h,category:p.Aggregations,params:[],defaultParams:[],renderer:l.c}),m({type:"mode",addStrategy:h,category:p.Aggregations,params:[],defaultParams:[],renderer:l.c}),m({type:"sum",addStrategy:h,category:p.Aggregations,params:[],defaultParams:[],renderer:l.c}),m({type:"derivative",addStrategy:d,category:p.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:l.c}),m({type:"spread",addStrategy:d,category:p.Transformations,params:[],defaultParams:[],renderer:l.c}),m({type:"non_negative_derivative",addStrategy:d,category:p.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:l.c}),m({type:"difference",addStrategy:d,category:p.Transformations,params:[],defaultParams:[],renderer:l.c}),m({type:"non_negative_difference",addStrategy:d,category:p.Transformations,params:[],defaultParams:[],renderer:l.c}),m({type:"moving_average",addStrategy:d,category:p.Transformations,params:[{name:"window",type:"int",options:[5,10,20,30,40]}],defaultParams:[10],renderer:l.c}),m({type:"cumulative_sum",addStrategy:d,category:p.Transformations,params:[],defaultParams:[],renderer:l.c}),m({type:"stddev",addStrategy:d,category:p.Transformations,params:[],defaultParams:[],renderer:l.c}),m({type:"time",category:y,params:[{name:"interval",type:"time",options:["$__interval","1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["$__interval"],renderer:l.c}),m({type:"fill",category:y,params:[{name:"fill",type:"string",options:["none","null","0","previous","linear"]}],defaultParams:["null"],renderer:l.c}),m({type:"elapsed",addStrategy:d,category:p.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:l.c}),m({type:"holt_winters",addStrategy:d,category:p.Predictors,params:[{name:"number",type:"int",options:[5,10,20,30,40]},{name:"season",type:"int",options:[0,1,2,5,10]}],defaultParams:[10,2],renderer:l.c}),m({type:"holt_winters_with_fit",addStrategy:d,category:p.Predictors,params:[{name:"number",type:"int",options:[5,10,20,30,40]},{name:"season",type:"int",options:[0,1,2,5,10]}],defaultParams:[10,2],renderer:l.c}),m({type:"bottom",addStrategy:h,category:p.Selectors,params:[{name:"count",type:"int"}],defaultParams:[3],renderer:l.c}),m({type:"first",addStrategy:h,category:p.Selectors,params:[],defaultParams:[],renderer:l.c}),m({type:"last",addStrategy:h,category:p.Selectors,params:[],defaultParams:[],renderer:l.c}),m({type:"max",addStrategy:h,category:p.Selectors,params:[],defaultParams:[],renderer:l.c}),m({type:"min",addStrategy:h,category:p.Selectors,params:[],defaultParams:[],renderer:l.c}),m({type:"percentile",addStrategy:h,category:p.Selectors,params:[{name:"nth",type:"int"}],defaultParams:[95],renderer:l.c}),m({type:"top",addStrategy:h,category:p.Selectors,params:[{name:"count",type:"int"}],defaultParams:[3],renderer:l.c}),m({type:"tag",category:y,params:[{name:"tag",type:"string",dynamicLookup:!0}],defaultParams:["tag"],renderer:g}),m({type:"math",addStrategy:function(e,t){var r=e.length;if(r>0){if("math"===e[r-1].def.type)return void(e[r-1]=t);if(r>1&&"math"===e[r-2].def.type)return void(e[r-2]=t);if("alias"===e[r-1].def.type)return void e.splice(r-1,0,t)}e.push(t)},category:p.Math,params:[{name:"expr",type:"string"}],defaultParams:[" / 100"],renderer:l.d}),m({type:"alias",addStrategy:function(e,t){var r=e.length;r>0&&"alias"===e[r-1].def.type?e[r-1]=t:e.push(t)},category:p.Aliasing,params:[{name:"name",type:"string",quote:"double"}],defaultParams:["alias"],renderMode:"suffix",renderer:function(e,t){return t+' AS "'+e.params[0]+'"'}});var v={create:f,getCategories:function(){return p},replaceAggregationAdd:h},b=r("PbtU");function S(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var w=function(){function e(t,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=t,this.templateSrv=r,this.scopedVars=a,t.policy=t.policy||"default",t.resultFormat=t.resultFormat||"time_series",t.orderByTime=t.orderByTime||"ASC",t.tags=t.tags||[],t.groupBy=t.groupBy||[{type:"time",params:["$__interval"]},{type:"fill",params:["null"]}],t.select=t.select||[[{type:"field",params:["value"]},{type:"mean",params:[]}]],this.updateProjection()}var t,r,a;return e.$inject=["target","templateSrv","scopedVars"],t=e,(r=[{key:"updateProjection",value:function(){this.selectModels=n.a.map(this.target.select,(function(e){return n.a.map(e,v.create)})),this.groupByParts=n.a.map(this.target.groupBy,v.create)}},{key:"updatePersistedParts",value:function(){this.target.select=n.a.map(this.selectModels,(function(e){return n.a.map(e,(function(e){return{type:e.def.type,params:e.params}}))}))}},{key:"hasGroupByTime",value:function(){return n.a.find(this.target.groupBy,(function(e){return"time"===e.type}))}},{key:"hasFill",value:function(){return n.a.find(this.target.groupBy,(function(e){return"fill"===e.type}))}},{key:"addGroupBy",value:function(e){var t=e.match(/^(\w+)\((.*)\)$/);if(t&&this.target.groupBy){var r=t[1],a=t[2],n=v.create({type:r,params:[a]}),o=this.target.groupBy.length;0===o?this.target.groupBy.push(n.part):"time"===r?this.target.groupBy.splice(0,0,n.part):"tag"===r&&"fill"===this.target.groupBy[o-1].type?this.target.groupBy.splice(o-1,0,n.part):this.target.groupBy.push(n.part),this.updateProjection()}}},{key:"removeGroupByPart",value:function(e,t){var r=v.getCategories();"time"===e.def.type&&(this.target.groupBy=n.a.filter(this.target.groupBy,(function(e){return"fill"!==e.type})),this.target.select=n.a.map(this.target.select,(function(e){return n.a.filter(e,(function(e){var t=v.create(e);return t.def.category!==r.Aggregations&&t.def.category!==r.Selectors}))}))),this.target.groupBy.splice(t,1),this.updateProjection()}},{key:"removeSelect",value:function(e){this.target.select.splice(e,1),this.updateProjection()}},{key:"removeSelectPart",value:function(e,t){if("field"===t.def.type){if(this.selectModels.length>1){var r=n.a.indexOf(this.selectModels,e);this.selectModels.splice(r,1)}}else{var a=n.a.indexOf(e,t);e.splice(a,1)}this.updatePersistedParts()}},{key:"addSelectPart",value:function(e,t){var r=v.create({type:t});r.def.addStrategy(e,r,this),this.updatePersistedParts()}},{key:"renderTagCondition",value:function(e,t,r){var a="",n=e.operator,o=e.value;return t>0&&(a=(e.condition||"AND")+" "),n||(n=/^\/.*\/$/.test(o)?"=~":"="),"=~"!==n&&"!~"!==n?(r&&(o=this.templateSrv.replace(o,this.scopedVars)),">"!==n&&"<"!==n&&(o="'"+o.replace(/\\/g,"\\\\").replace(/\'/g,"\\'")+"'")):r&&(o=this.templateSrv.replace(o,this.scopedVars,"regex")),a+'"'+e.key+'" '+n+" "+o}},{key:"getMeasurementAndPolicy",value:function(e){var t=this.target.policy,r=this.target.measurement||"measurement";return r.match("^/.*/$")?e&&(r=this.templateSrv.replace(r,this.scopedVars,"regex")):r='"'+r+'"',(t="default"!==t?'"'+this.target.policy+'".':"")+r}},{key:"interpolateQueryStr",value:function(e,t,r){return t.multi||t.includeAll?"string"==typeof e?b.a.regexEscape(e):"("+n.a.map(e,b.a.regexEscape).join("|")+")":e}},{key:"render",value:function(e){var t=this,r=this.target;if(r.rawQuery)return e?this.templateSrv.replace(r.query,this.scopedVars,this.interpolateQueryStr):r.query;var a,o,i="SELECT ";for(a=0;a<this.selectModels.length;a++){var s=this.selectModels[a],u="";for(o=0;o<s.length;o++)u=s[o].render(u);a>0&&(i+=", "),i+=u}i+=" FROM "+this.getMeasurementAndPolicy(e)+" WHERE ";var l=n.a.map(r.tags,(function(r,a){return t.renderTagCondition(r,a,e)}));l.length>0&&(i+="("+l.join(" ")+") AND "),i+="$timeFilter";var c="";for(a=0;a<this.groupByParts.length;a++){var p=this.groupByParts[a];a>0&&(c+="fill"===p.def.type?" ":", "),c+=p.render("")}return c.length&&(i+=" GROUP BY "+c),r.fill&&(i+=" fill("+r.fill+")"),"DESC"===r.orderByTime&&(i+=" ORDER BY time DESC"),r.limit&&(i+=" LIMIT "+r.limit),r.slimit&&(i+=" SLIMIT "+r.slimit),r.tz&&(i+=" tz('"+r.tz+"')"),i}},{key:"renderAdhocFilters",value:function(e){var t=this;return n.a.map(e,(function(e,r){return t.renderTagCondition(e,r,!0)})).join(" ")}}])&&S(t.prototype,r),a&&S(t,a),e}();function O(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var E=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,a;return t=e,(r=[{key:"parse",value:function(e,t){if(!t||0===t.results.length)return[];var r=t.results[0];if(!r.series)return[];var a=e.toLowerCase(),o=a.indexOf("show field keys")>=0||a.indexOf("show retention policies")>=0,i={};return n.a.each(r.series,(function(e){n.a.each(e.values,(function(e){n.a.isArray(e)?o?P(i,e[0]):void 0!==e[1]?P(i,e[1]):P(i,e[0]):P(i,e)}))})),n.a.map(i,(function(e){return{text:e.toString()}}))}}])&&O(t.prototype,r),a&&O(t,a),e}();function P(e,t){e[t]=t}function k(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var T=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=t,this.database=r}var t,r,a;return t=e,(r=[{key:"buildExploreQuery",value:function(e,t,r){var a,o,i;if("TAG_KEYS"===e)a="SHOW TAG KEYS",o=this.target.measurement,i=this.target.policy;else if("TAG_VALUES"===e)a="SHOW TAG VALUES",o=this.target.measurement,i=this.target.policy;else if("MEASUREMENTS"===e)a="SHOW MEASUREMENTS",r&&(a+=" WITH MEASUREMENT =~ /"+b.a.regexEscape(r)+"/");else{if("FIELDS"===e)return o=this.target.measurement,i=this.target.policy,o.match("^/.*/")||(o='"'+o+'"',i&&"default"!==i&&(o=(i='"'+i+'"')+"."+o)),"SHOW FIELD KEYS FROM "+o;if("RETENTION POLICIES"===e)return a='SHOW RETENTION POLICIES on "'+this.database+'"'}if(o&&(o.match("^/.*/")||o.match(/^merge\(.*\)/)||(o='"'+o+'"'),i&&"default"!==i&&(o=(i='"'+i+'"')+"."+o),a+=" FROM "+o),t&&(a+=' WITH KEY = "'+t+'"'),this.target.tags&&this.target.tags.length>0){var s=n.a.reduce(this.target.tags,(function(e,r){return r.key===t?e:(e.push(function(e,t){var r="",a=e.operator,n=e.value;return t>0&&(r=(e.condition||"AND")+" "),a||(a=/^\/.*\/$/.test(e.value)?"=~":"="),"=~"!==a&&"!~"!==a&&isNaN(+n)&&(n="'"+n+"'"),r+'"'+e.key+'" '+a+" "+n}(r,e.length)),e)}),[]);s.length>0&&(a+=" WHERE "+s.join(" "))}return"MEASUREMENTS"===e&&(a+=" LIMIT 100"),a}}])&&k(t.prototype,r),a&&k(t,a),e}(),x=r("t8hP");function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach((function(t){A(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function A(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function D(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function M(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var F=function(e){function t(e,r){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=M(this,B(t).call(this,e))).templateSrv=r,a.type="influxdb",a.urls=n.a.map(e.url.split(","),(function(e){return e.trim()})),a.username=e.username,a.password=e.password,a.name=e.name,a.database=e.database,a.basicAuth=e.basicAuth,a.withCredentials=e.withCredentials;var o=e.jsonData||{};return a.interval=o.timeInterval,a.httpMode=o.httpMode||"GET",a.responseParser=new E,a}var r,a,i;return t.$inject=["instanceSettings","templateSrv"],function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(t,e),r=t,(a=[{key:"query",value:function(e){var t,r,a,o=this,i=this.getTimeFilter(e),s=e.scopedVars,l=n.a.cloneDeep(e.targets),c=[],p=n.a.map(l,(function(e){return e.hide?"":(c.push(e),s.interval=s.__interval,(t=new w(e,o.templateSrv,s)).render(!0))})).reduce((function(e,t){return""!==t&&(e+=";"+t),e}));if(""===p)return Promise.resolve({data:[]});var f=this.templateSrv.getAdhocFilters(this.name);return f.length>0&&(i+=" AND "+t.renderAdhocFilters(f)),s.timeFilter={value:i},p=this.templateSrv.replace(p,s),this._seriesQuery(p,e).then((function(t){if(!t||!t.results)return[];var n=[];for(r=0;r<t.results.length;r++){var i=t.results[r];if(i&&i.series){var s=c[r],l=s.alias;l&&(l=o.templateSrv.replace(s.alias,e.scopedVars));var p=new u({series:t.results[r].series,alias:l});switch(s.resultFormat){case"table":n.push(p.getTable());break;default:var f=p.getTimeSeries();for(a=0;a<f.length;a++)n.push(f[a])}}}return{data:n}}))}},{key:"annotationQuery",value:function(e){if(!e.annotation.query)return Promise.reject({message:"Query missing in annotation definition"});var t=this.getTimeFilter({rangeRaw:e.rangeRaw,timezone:e.timezone}),r=e.annotation.query.replace("$timeFilter",t);return r=this.templateSrv.replace(r,null,"regex"),this._seriesQuery(r,e).then((function(t){if(!t||!t.results||!t.results[0])throw{message:"No results in response from InfluxDB"};return new u({series:t.results[0].series,annotation:e.annotation}).getAnnotations()}))}},{key:"targetContainsTemplate",value:function(e){var t=!0,r=!1,a=void 0;try{for(var n,o=e.groupBy[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var i=n.value,s=!0,u=!1,l=void 0;try{for(var c,p=i.params[Symbol.iterator]();!(s=(c=p.next()).done);s=!0){var f=c.value;if(this.templateSrv.variableExists(f))return!0}}catch(e){u=!0,l=e}finally{try{s||null==p.return||p.return()}finally{if(u)throw l}}}}catch(e){r=!0,a=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw a}}for(var m in e.tags)if(this.templateSrv.variableExists(e.tags[m].value))return!0;return!1}},{key:"interpolateVariablesInQueries",value:function(e,t){var r=this;if(!e||0===e.length)return[];var a=e;return e&&e.length>0&&(a=e.map((function(e){var a=_({},e,{datasource:r.name,measurement:r.templateSrv.replace(e.measurement,t,"regex")});if(e.rawQuery&&(a.query=r.templateSrv.replace(e.query,t,"regex")),e.tags){var n=e.tags.map((function(e){return _({},e,{value:r.templateSrv.replace(e.value,null,"regex")})}));a.tags=n}return a}))),a}},{key:"metricFindQuery",value:function(e,t){var r=this,a=this.templateSrv.replace(e,null,"regex");return this._seriesQuery(a,t).then((function(t){return r.responseParser.parse(e,t)}))}},{key:"getTagKeys",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new T({measurement:e.measurement||"",tags:[]},this.database),r=t.buildExploreQuery("TAG_KEYS");return this.metricFindQuery(r,e)}},{key:"getTagValues",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new T({measurement:e.measurement||"",tags:[]},this.database),r=t.buildExploreQuery("TAG_VALUES",e.key);return this.metricFindQuery(r,e)}},{key:"_seriesQuery",value:function(e,t){if(!e)return Promise.resolve({results:[]});if(t&&t.range){var r=this.getTimeFilter({rangeRaw:t.range,timezone:t.timezone});e=e.replace("$timeFilter",r)}return this._influxRequest(this.httpMode,"/query",{q:e,epoch:"ms"},t)}},{key:"serializeParams",value:function(e){return e?n.a.reduce(e,(function(e,t,r){return null==t?e:(e.push(encodeURIComponent(r)+"="+encodeURIComponent(t)),e)}),[]).join("&"):""}},{key:"testDatasource",value:function(){var e=new T({measurement:"",tags:[]},this.database).buildExploreQuery("RETENTION POLICIES");return this._seriesQuery(e).then((function(e){var t=n.a.get(e,"results[0].error");return t?{status:"error",message:t}:{status:"success",message:"Data source is working"}})).catch((function(e){return{status:"error",message:e.message}}))}},{key:"_influxRequest",value:function(e,t,r,a){var o=this.urls.shift();this.urls.push(o);var i={};this.username&&(i.u=this.username,i.p=this.password),a&&a.database?i.db=a.database:this.database&&(i.db=this.database),"POST"===e&&n.a.has(r,"q")?(n.a.extend(i,n.a.omit(r,["q"])),r=this.serializeParams(n.a.pick(r,["q"]))):"GET"!==e&&"POST"!==e||(n.a.extend(i,r),r=null);var s={method:e,url:o+t,params:i,data:r,precision:"ms",inspect:{type:"influxdb"},paramSerializer:this.serializeParams};return s.headers=s.headers||{},(this.basicAuth||this.withCredentials)&&(s.withCredentials=!0),this.basicAuth&&(s.headers.Authorization=this.basicAuth),"POST"===e&&(s.headers["Content-type"]="application/x-www-form-urlencoded"),Object(x.getBackendSrv)().datasourceRequest(s).then((function(e){if(e.data&&e.data.results){var t=e.data.results.filter((function(e){return e.error}));if(t.length>0)throw{message:"InfluxDB Error: "+t[0].error,data:e.data}}return e.data}),(function(e){throw Number.isInteger(e.status)&&0!==e.status||e.status>=300?e.data&&e.data.error?{message:"InfluxDB Error: "+e.data.error,data:e.data,config:e.config}:{message:"Network Error: "+e.statusText+"("+e.status+")",data:e.data,config:e.config}:e}))}},{key:"getTimeFilter",value:function(e){var t=this.getInfluxTime(e.rangeRaw.from,!1,e.timezone),r=this.getInfluxTime(e.rangeRaw.to,!0,e.timezone),a="ms"===t[t.length-1];return"now()"!==r||a?"time >= "+t+" and time <= "+r:"time >= "+t}},{key:"getInfluxTime",value:function(e,t,r){if(n.a.isString(e)){if("now"===e)return"now()";var a=/^now-(\d+)([dhms])$/.exec(e);if(a)return"now() - "+parseInt(a[1],10)+a[2];e=o.dateMath.parse(e,t,r)}return e.valueOf()+"ms"}}])&&D(r.prototype,a),i&&D(r,i),t}(o.DataSourceApi),R=r("KHwQ"),I=r.n(R);function q(e){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Q(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function L(e,t){return!t||"object"!==q(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function V(e){return(V=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var G=function(e){function t(e,r,a,n){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=L(this,V(t).call(this,e,r))).templateSrv=a,o.uiSegmentSrv=n,o.target=o.target,o.queryModel=new w(o.target,a,o.panel.scopedVars),o.queryBuilder=new T(o.target,o.datasource.database),o.groupBySegment=o.uiSegmentSrv.newPlusButton(),o.resultFormats=[{text:"Time series",value:"time_series"},{text:"Table",value:"table"}],o.policySegment=n.newSegment(o.target.policy),o.target.measurement?o.measurementSegment=n.newSegment(o.target.measurement):o.measurementSegment=n.newSelectMeasurement(),o.tagSegments=[];var i=!0,s=!1,u=void 0;try{for(var l,c=o.target.tags[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var p=l.value;p.operator||(/^\/.*\/$/.test(p.value)?p.operator="=~":p.operator="="),p.condition&&o.tagSegments.push(n.newCondition(p.condition)),o.tagSegments.push(n.newKey(p.key)),o.tagSegments.push(n.newOperator(p.operator)),o.tagSegments.push(n.newKeyValue(p.value))}}catch(e){s=!0,u=e}finally{try{i||null==c.return||c.return()}finally{if(s)throw u}}return o.fixTagSegments(),o.buildSelectMenu(),o.removeTagFilterSegment=n.newSegment({fake:!0,value:"-- remove tag filter --"}),o}var r,a,o;return t.$inject=["$scope","$injector","templateSrv","uiSegmentSrv"],function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&U(e,t)}(t,e),r=t,(a=[{key:"removeOrderByTime",value:function(){this.target.orderByTime="ASC"}},{key:"buildSelectMenu",value:function(){var e=v.getCategories();this.selectMenu=n.a.reduce(e,(function(e,t,r){var a={text:r,submenu:t.map((function(e){return{text:e.type,value:e.type}}))};return e.push(a),e}),[])}},{key:"getGroupByOptions",value:function(){var e=this,t=this.queryBuilder.buildExploreQuery("TAG_KEYS");return this.datasource.metricFindQuery(t).then((function(t){var r=[];e.queryModel.hasFill()||r.push(e.uiSegmentSrv.newSegment({value:"fill(null)"})),e.target.limit||r.push(e.uiSegmentSrv.newSegment({value:"LIMIT"})),e.target.slimit||r.push(e.uiSegmentSrv.newSegment({value:"SLIMIT"})),e.target.tz||r.push(e.uiSegmentSrv.newSegment({value:"tz"})),"ASC"===e.target.orderByTime&&r.push(e.uiSegmentSrv.newSegment({value:"ORDER BY time DESC"})),e.queryModel.hasGroupByTime()||r.push(e.uiSegmentSrv.newSegment({value:"time($interval)"}));var a=!0,n=!1,o=void 0;try{for(var i,s=t[Symbol.iterator]();!(a=(i=s.next()).done);a=!0){var u=i.value;r.push(e.uiSegmentSrv.newSegment({value:"tag("+u.text+")"}))}}catch(e){n=!0,o=e}finally{try{a||null==s.return||s.return()}finally{if(n)throw o}}return r})).catch(this.handleQueryError.bind(this))}},{key:"groupByAction",value:function(){switch(this.groupBySegment.value){case"LIMIT":this.target.limit=10;break;case"SLIMIT":this.target.slimit=10;break;case"tz":this.target.tz="UTC";break;case"ORDER BY time DESC":this.target.orderByTime="DESC";break;default:this.queryModel.addGroupBy(this.groupBySegment.value)}var e=this.uiSegmentSrv.newPlusButton();this.groupBySegment.value=e.value,this.groupBySegment.html=e.html,this.panelCtrl.refresh()}},{key:"addSelectPart",value:function(e,t,r){this.queryModel.addSelectPart(e,r.value),this.panelCtrl.refresh()}},{key:"handleSelectPartEvent",value:function(e,t,r){switch(r.name){case"get-param-options":var a=this.queryBuilder.buildExploreQuery("FIELDS");return this.datasource.metricFindQuery(a).then(this.transformToSegments(!0)).catch(this.handleQueryError.bind(this));case"part-param-changed":this.panelCtrl.refresh();break;case"action":this.queryModel.removeSelectPart(e,t),this.panelCtrl.refresh();break;case"get-part-actions":return Promise.resolve([{text:"Remove",value:"remove-part"}])}}},{key:"handleGroupByPartEvent",value:function(e,t,r){switch(r.name){case"get-param-options":var a=this.queryBuilder.buildExploreQuery("TAG_KEYS");return this.datasource.metricFindQuery(a).then(this.transformToSegments(!0)).catch(this.handleQueryError.bind(this));case"part-param-changed":this.panelCtrl.refresh();break;case"action":this.queryModel.removeGroupByPart(e,t),this.panelCtrl.refresh();break;case"get-part-actions":return Promise.resolve([{text:"Remove",value:"remove-part"}])}}},{key:"fixTagSegments",value:function(){var e=this.tagSegments.length,t=this.tagSegments[Math.max(e-1,0)];t&&"plus-button"===t.type||this.tagSegments.push(this.uiSegmentSrv.newPlusButton())}},{key:"measurementChanged",value:function(){this.target.measurement=this.measurementSegment.value,this.panelCtrl.refresh()}},{key:"getPolicySegments",value:function(){var e=this.queryBuilder.buildExploreQuery("RETENTION POLICIES");return this.datasource.metricFindQuery(e).then(this.transformToSegments(!1)).catch(this.handleQueryError.bind(this))}},{key:"policyChanged",value:function(){this.target.policy=this.policySegment.value,this.panelCtrl.refresh()}},{key:"toggleEditorMode",value:function(){try{this.target.query=this.queryModel.render(!1)}catch(e){console.log("query render error")}this.target.rawQuery=!this.target.rawQuery}},{key:"getMeasurements",value:function(e){var t=this.queryBuilder.buildExploreQuery("MEASUREMENTS",void 0,e);return this.datasource.metricFindQuery(t).then(this.transformToSegments(!0)).catch(this.handleQueryError.bind(this))}},{key:"handleQueryError",value:function(e){return this.error=e.message||"Failed to issue metric query",[]}},{key:"transformToSegments",value:function(e){var t=this;return function(r){var a=n.a.map(r,(function(e){return t.uiSegmentSrv.newSegment({value:e.text,expandable:e.expandable})}));if(e){var o=!0,i=!1,s=void 0;try{for(var u,l=t.templateSrv.getVariables()[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;a.unshift(t.uiSegmentSrv.newSegment({type:"value",value:"/^$"+c.name+"$/",expandable:!0}))}}catch(e){i=!0,s=e}finally{try{o||null==l.return||l.return()}finally{if(i)throw s}}}return a}}},{key:"getTagsOrValues",value:function(e,t){var r,a,n=this;if("condition"===e.type)return Promise.resolve([this.uiSegmentSrv.newSegment("AND"),this.uiSegmentSrv.newSegment("OR")]);if("operator"===e.type){var o=this.tagSegments[t+1].value;return/^\/.*\/$/.test(o)?Promise.resolve(this.uiSegmentSrv.newOperators(["=~","!~"])):Promise.resolve(this.uiSegmentSrv.newOperators(["=","!=","<>","<",">"]))}return"key"===e.type||"plus-button"===e.type?(r=this.queryBuilder.buildExploreQuery("TAG_KEYS"),a=!1):"value"===e.type&&(r=this.queryBuilder.buildExploreQuery("TAG_VALUES",this.tagSegments[t-2].value),a=!0),this.datasource.metricFindQuery(r).then(this.transformToSegments(a)).then((function(t){return"key"===e.type&&t.splice(0,0,I.a.copy(n.removeTagFilterSegment)),t})).catch(this.handleQueryError.bind(this))}},{key:"getFieldSegments",value:function(){var e=this.queryBuilder.buildExploreQuery("FIELDS");return this.datasource.metricFindQuery(e).then(this.transformToSegments(!1)).catch(this.handleQueryError)}},{key:"tagSegmentUpdated",value:function(e,t){this.tagSegments[t]=e,e.value===this.removeTagFilterSegment.value?(this.tagSegments.splice(t,3),0===this.tagSegments.length?this.tagSegments.push(this.uiSegmentSrv.newPlusButton()):this.tagSegments.length>2&&(this.tagSegments.splice(Math.max(t-1,0),1),"plus-button"!==this.tagSegments[this.tagSegments.length-1].type&&this.tagSegments.push(this.uiSegmentSrv.newPlusButton()))):("plus-button"===e.type&&(t>2&&this.tagSegments.splice(t,0,this.uiSegmentSrv.newCondition("AND")),this.tagSegments.push(this.uiSegmentSrv.newOperator("=")),this.tagSegments.push(this.uiSegmentSrv.newFake("select tag value","value","query-segment-value")),e.type="key",e.cssClass="query-segment-key"),t+1===this.tagSegments.length&&this.tagSegments.push(this.uiSegmentSrv.newPlusButton())),this.rebuildTargetTagConditions()}},{key:"rebuildTargetTagConditions",value:function(){var e=this,t=[],r=0,a="";n.a.each(this.tagSegments,(function(n,o){"key"===n.type?(0===t.length&&t.push({}),t[r].key=n.value):"value"===n.type?((a=e.getTagValueOperator(n.value,t[r].operator))&&(e.tagSegments[o-1]=e.uiSegmentSrv.newOperator(a),t[r].operator=a),t[r].value=n.value):"condition"===n.type?(t.push({condition:n.value}),r+=1):"operator"===n.type&&(t[r].operator=n.value)})),this.target.tags=t,this.panelCtrl.refresh()}},{key:"getTagValueOperator",value:function(e,t){return"=~"!==t&&"!~"!==t&&/^\/.*\/$/.test(e)?"=~":"=~"!==t&&"!~"!==t||!/^(?!\/.*\/$)/.test(e)?null:"="}},{key:"getCollapsedText",value:function(){return this.queryModel.render(!1)}}])&&Q(r.prototype,a),o&&Q(r,o),t}(r("LzXI").QueryCtrl);G.templateUrl="partials/query.editor.html";var K=r("q1tI"),$=r.n(K),z=r("kDLi"),H=r("kDDq");function Y(){var e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n    label: key-value-container;\n    display: flex;\n    flex-flow: row nowrap;\n  "]);return Y=function(){return e},e}var W,J=z.LegacyForms.Select;!function(e){e.Key="key",e.Value="value",e.Operator="operator"}(W||(W={}));var X=function(e){Object(K.useContext)(z.ThemeContext);var t={keyValueContainer:Object(H.css)(Y())},r=function(t){return function(r){var a=e.onKeyChanged,n=e.onValueChanged,o=e.onOperatorChanged;if(r.value)switch(t){case W.Key:a(r.value);break;case W.Operator:o(r.value);break;case W.Value:n(r.value)}}},a=function(e){return{label:e,value:e}},n=e.keys,o=e.initialKey,i=e.keysPlaceHolder,s=e.initialOperator,u=e.values,l=e.initialValue,c=e.valuesPlaceHolder,p=n?n.map(a):[],f=o?p.filter((function(e){return e.value===o})):void 0,m=u?u.map(a):[],y=l?m.filter((function(e){return e.value===l})):void 0,g=["=","!="].map(a),h=s?g.filter((function(e){return e.value===s})):void 0;return $.a.createElement("div",{className:Object(H.cx)([t.keyValueContainer])},$.a.createElement(J,{options:p,isSearchable:!0,value:f,onChange:r(W.Key),placeholder:i}),$.a.createElement(J,{options:g,value:h,onChange:r(W.Operator)}),$.a.createElement(J,{options:m,isSearchable:!0,value:y,onChange:r(W.Value),placeholder:c}))};function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function te(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(r),!0).forEach((function(t){re(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function re(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ae(e,t,r,a,n,o,i){try{var s=e[o](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(a,n)}function ne(e){return function(){var t=this,r=arguments;return new Promise((function(a,n){var o=e.apply(t,r);function i(e){ae(o,a,n,i,s,"next",e)}function s(e){ae(o,a,n,i,s,"throw",e)}i(void 0)}))}}function oe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ie(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function se(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ue(e){return(ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function le(e,t){return(le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ce="-- remove filter --",pe=function(e){return $.a.createElement("button",{className:"gf-form-label gf-form-label--btn query-part",onClick:e},$.a.createElement(z.Icon,{name:"plus"}))},fe=function(e){function t(){var e,r;oe(this,t);for(var a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return(r=se(this,(e=ue(t)).call.apply(e,[this].concat(n)))).state={pairs:[]},r.loadTagKeys=ne(regeneratorRuntime.mark((function e(){var t,a,n,o,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.props,a=t.datasource,n=t.extendedOptions,o=n||{},!a.getTagKeys){e.next=8;break}return e.next=5,a.getTagKeys(o);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=[];case 9:return i=e.t0,s=i.map((function(e){return e.text})),e.abrupt("return",s);case 12:case"end":return e.stop()}}),e)}))),r.loadTagValues=function(){var e=ne(regeneratorRuntime.mark((function e(t){var a,n,o,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.props,n=a.datasource,o=a.extendedOptions,i=o||{},!n.getTagValues){e.next=8;break}return e.next=5,n.getTagValues(te({},i,{key:t}));case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=[];case 9:return s=e.t0,u=s.map((function(e){return e.text})),e.abrupt("return",u);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.onKeyChanged=function(e){return function(){var t=ne(regeneratorRuntime.mark((function t(a){var n,o,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a===ce){t.next=9;break}return n=r.props.onPairsChanged,t.next=4,r.loadTagValues(a);case 4:o=t.sent,i=r.updatePairs(r.state.pairs,e,{key:a,values:o}),r.setState({pairs:i},(function(){return n(i)})),t.next=10;break;case 9:r.onRemoveFilter(e);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},r.onValueChanged=function(e){return function(t){var a=r.updatePairs(r.state.pairs,e,{value:t});r.setState({pairs:a},(function(){return r.props.onPairsChanged(a)}))}},r.onOperatorChanged=function(e){return function(t){var a=r.updatePairs(r.state.pairs,e,{operator:t});r.setState({pairs:a},(function(){return r.props.onPairsChanged(a)}))}},r.onAddFilter=ne(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.loadTagKeys();case 2:t=e.sent,a=r.state.pairs.concat(r.updatePairs([],0,{keys:t})),r.setState({pairs:a},(function(){return r.props.onPairsChanged(a)}));case 5:case"end":return e.stop()}}),e)}))),r.onRemoveFilter=function(){var e=ne(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=r.state.pairs.reduce((function(e,r,a){return a===t?e:e.concat(r)}),[]),r.setState({pairs:a});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r}var r,a,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&le(e,t)}(t,e),r=t,(a=[{key:"componentDidUpdate",value:function(e){var t=this;if(!1===n.a.isEqual(e.extendedOptions,this.props.extendedOptions)){var r=[];this.setState({pairs:r},(function(){return t.props.onPairsChanged(r)}))}}},{key:"updatePairs",value:function(e,t,r){if(0===e.length)return[{key:r.key||"",keys:r.keys||[],operator:r.operator||"",value:r.value||"",values:r.values||[]}];for(var a=[],n=0;n<e.length;n++){var o=e[n];t!==n?a.push(o):a.push(te({},o,{key:r.key||o.key,value:r.value||o.value,operator:r.operator||o.operator,keys:r.keys||o.keys,values:r.values||o.values}))}return a}},{key:"render",value:function(){var e=this,t=this.state.pairs;return $.a.createElement($.a.Fragment,null,t.length<1&&pe(this.onAddFilter),t.map((function(r,a){var n="adhoc-filter-".concat(a,"-").concat(r.key,"-").concat(r.value);return $.a.createElement("div",{className:"align-items-center flex-grow-1",key:n},$.a.createElement(X,{keys:[ce].concat(r.keys),values:r.values,initialKey:r.key,initialOperator:r.operator,initialValue:r.value,onKeyChanged:e.onKeyChanged(a),onOperatorChanged:e.onOperatorChanged(a),onValueChanged:e.onValueChanged(a)}),a<t.length-1&&$.a.createElement("span",null," AND "),a===t.length-1&&pe(e.onAddFilter))})))}}])&&ie(r.prototype,a),o&&ie(r,o),t}($.a.PureComponent),me=r("5kRJ");function ye(e){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ge(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function he(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(r),!0).forEach((function(t){de(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ge(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function de(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ve(e,t,r,a,n,o,i){try{var s=e[o](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(a,n)}function be(e){return function(){var t=this,r=arguments;return new Promise((function(a,n){var o=e.apply(t,r);function i(e){ve(o,a,n,i,s,"next",e)}function s(e){ve(o,a,n,i,s,"throw",e)}i(void 0)}))}}function Se(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function we(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Oe(e,t){return!t||"object"!==ye(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ee(e){return(Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pe(e,t){return(Pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ke(e){return!e||e.every((function(e){var t=!!(e.key&&e.operator&&e.value),r=void 0===e.key&&void 0===e.operator&&void 0===e.value;return t||r}))}var Te=function(e){function t(){var e,r;Se(this,t);for(var a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return(r=Oe(this,(e=Ee(t)).call.apply(e,[this].concat(n)))).templateSrv=new me.a,r.state={measurements:[],measurement:null,field:null,error:null},r.onMeasurementsChange=function(){var e=be(regeneratorRuntime.mark((function e(t){var a,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=r.props.query,n=t[0],o=t[1],r.setState({measurement:n,field:o},(function(){r.onPairsChanged(a.tags)}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.onPairsChanged=function(e){var t=r.props.query,a=r.state,n=a.measurement,o=a.field,i=new w(he({},t,{resultFormat:"table",groupBy:[],select:[[{type:"field",params:[o]}]],tags:e,limit:"1000",measurement:n}),r.templateSrv);r.props.onChange(i.target),n&&o&&ke(e)&&r.props.onRunQuery()},r}var r,a,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pe(e,t)}(t,e),r=t,(a=[{key:"componentDidMount",value:(o=be(regeneratorRuntime.mark((function e(){var t,r,a,n,o,i,s,u,l,c,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.datasource,e.prev=1,r=new T({measurement:"",tags:[]},t.database),a=r.buildExploreQuery("MEASUREMENTS"),e.next=6,t.metricFindQuery(a);case 6:n=e.sent,o=[],i=0;case 9:if(!(i<n.length)){e.next=21;break}return s=n[i],u=new T({measurement:s.text,tags:[]},t.database),l=u.buildExploreQuery("FIELDS"),e.next=15,t.metricFindQuery(l);case 15:c=e.sent,p=c.map((function(e){return{label:e.text,value:e.text,children:[]}})),o.push({label:s.text,value:s.text,children:p});case 18:i++,e.next=9;break;case 21:this.setState({measurements:o}),e.next=29;break;case 24:e.prev=24,e.t0=e.catch(1),f=e.t0&&e.t0.message?e.t0.message:e.t0,console.error(e.t0),this.setState({error:f});case 29:case"end":return e.stop()}}),e,this,[[1,24]])}))),function(){return o.apply(this,arguments)})},{key:"componentDidUpdate",value:function(e){e.query.measurement&&!this.props.query.measurement&&this.setState({measurement:null,field:null})}},{key:"render",value:function(){var e=this.props.datasource,t=this.state,r=t.measurements,a=t.measurement,n=t.field,o=t.error,i=function(e){var t=e.measurement,r=e.field;return e.error?"(No measurement found)":t?"Measurements (".concat(t,"/").concat(r,")"):"Measurements"}({measurement:a,field:n,error:o}),s=r&&r.length>0;return $.a.createElement("div",{className:"gf-form-inline gf-form-inline--nowrap"},$.a.createElement("div",{className:"gf-form flex-shrink-0"},$.a.createElement(z.ButtonCascader,{options:r,disabled:!s,value:[a,n],onChange:this.onMeasurementsChange},i)),$.a.createElement("div",{className:"flex-shrink-1 flex-flow-column-nowrap"},a&&$.a.createElement(fe,{onPairsChanged:this.onPairsChanged,datasource:e,extendedOptions:{measurement:a}}),o?$.a.createElement("span",{className:"gf-form-label gf-form-label--transparent gf-form-label--error m-l-2"},o):null))}}])&&we(r.prototype,a),n&&we(r,n),t}($.a.PureComponent),xe=[{title:"Getting started",label:"Start by selecting a measurement and field from the dropdown above. You can then use the tag selector to further narrow your search."}],Ce=function(e){return $.a.createElement("div",null,$.a.createElement("h2",null,"InfluxDB Cheat Sheet"),xe.map((function(e){return $.a.createElement("div",{className:"cheat-sheet-item",key:e.title},$.a.createElement("div",{className:"cheat-sheet-item__title"},e.title),$.a.createElement("div",{className:"cheat-sheet-item__label"},e.label))})))};function je(e){return(je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ae(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function De(e,t){return!t||"object"!==je(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Me(e){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Be(e,t){return(Be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ne=function(e){function t(){return _e(this,t),De(this,Me(t).apply(this,arguments))}var r,a,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Be(e,t)}(t,e),r=t,(a=[{key:"render",value:function(){return $.a.createElement(Ce,{onClickExample:this.props.onClickExample})}}])&&Ae(r.prototype,a),n&&Ae(r,n),t}(K.PureComponent);function Fe(e){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Re(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ie(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function qe(e,t){return!t||"object"!==Fe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Qe(e){return(Qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Le(e,t){return(Le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ve=z.LegacyForms.Select,Ue=z.LegacyForms.Input,Ge=z.LegacyForms.SecretFormField,Ke=[{label:"GET",value:"GET"},{label:"POST",value:"POST"}],$e=function(e){function t(){var e,r;Re(this,t);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(r=qe(this,(e=Qe(t)).call.apply(e,[this].concat(n)))).onResetPassword=function(){Object(o.updateDatasourcePluginResetOption)(r.props,"password")},r}var r,a,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Le(e,t)}(t,e),r=t,(a=[{key:"render",value:function(){var e=this.props,t=e.options,r=e.onOptionsChange,a=t.secureJsonFields,n=t.secureJsonData||{};return $.a.createElement($.a.Fragment,null,$.a.createElement(z.DataSourceHttpSettings,{showAccessOptions:!0,dataSourceConfig:t,defaultUrl:"http://localhost:8086",onChange:r}),$.a.createElement("h3",{className:"page-heading"},"InfluxDB Details"),$.a.createElement("div",{className:"gf-form-group"},$.a.createElement("div",{className:"gf-form-inline"},$.a.createElement("div",{className:"gf-form"},$.a.createElement(z.InlineFormLabel,{className:"width-10"},"Database"),$.a.createElement("div",{className:"width-20"},$.a.createElement(Ue,{className:"width-20",value:t.database||"",onChange:Object(o.onUpdateDatasourceOption)(this.props,"database")})))),$.a.createElement("div",{className:"gf-form-inline"},$.a.createElement("div",{className:"gf-form"},$.a.createElement(z.InlineFormLabel,{className:"width-10"},"User"),$.a.createElement("div",{className:"width-10"},$.a.createElement(Ue,{className:"width-20",value:t.user||"",onChange:Object(o.onUpdateDatasourceOption)(this.props,"user")})))),$.a.createElement("div",{className:"gf-form-inline"},$.a.createElement("div",{className:"gf-form"},$.a.createElement(Ge,{isConfigured:a&&a.password,value:n.password||"",label:"Password",labelWidth:10,inputWidth:20,onReset:this.onResetPassword,onChange:Object(o.onUpdateDatasourceSecureJsonDataOption)(this.props,"password")}))),$.a.createElement("div",{className:"gf-form-inline"},$.a.createElement("div",{className:"gf-form"},$.a.createElement(z.InlineFormLabel,{className:"width-10",tooltip:"You can use either GET or POST HTTP method to query your InfluxDB database. The POST method allows you to perform heavy requests (with a lots of WHERE clause) while the GET method will restrict you and return an error if the query is too large."},"HTTP Method"),$.a.createElement(Ve,{className:"width-10",value:Ke.find((function(e){return e.value===t.jsonData.httpMode})),options:Ke,defaultValue:t.jsonData.httpMode,onChange:Object(o.onUpdateDatasourceJsonDataOptionSelect)(this.props,"httpMode")})))),$.a.createElement("div",{className:"gf-form-group"},$.a.createElement("div",{className:"grafana-info-box"},$.a.createElement("h5",null,"Database Access"),$.a.createElement("p",null,"Setting the database for this datasource does not deny access to other databases. The InfluxDB query syntax allows switching the database in the query. For example:",$.a.createElement("code",null,"SHOW MEASUREMENTS ON _internal")," or ",$.a.createElement("code",null,'SELECT * FROM "_internal".."database" LIMIT 10'),$.a.createElement("br",null),$.a.createElement("br",null),"To support data isolation and security, make sure appropriate permissions are configured in InfluxDB."))),$.a.createElement("div",{className:"gf-form-group"},$.a.createElement("div",{className:"gf-form-inline"},$.a.createElement("div",{className:"gf-form"},$.a.createElement(z.InlineFormLabel,{className:"width-10",tooltip:"A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example 1m if your data is written every minute."},"Min time interval"),$.a.createElement("div",{className:"width-10"},$.a.createElement(Ue,{className:"width-10",placeholder:"10s",value:t.jsonData.timeInterval||"",onChange:Object(o.onUpdateDatasourceJsonDataOption)(this.props,"timeInterval")}))))))}}])&&Ie(r.prototype,a),n&&Ie(r,n),t}(K.PureComponent);r.d(t,"plugin",(function(){return He}));var ze=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)};ze.templateUrl="partials/annotations.editor.html";var He=new o.DataSourcePlugin(F).setConfigEditor($e).setQueryCtrl(G).setAnnotationQueryCtrl(ze).setExploreLogsQueryField(Te).setExploreStartPage(Ne)}}]);
//# sourceMappingURL=influxdbPlugin.017a0d1a58b1119d038d.js.map