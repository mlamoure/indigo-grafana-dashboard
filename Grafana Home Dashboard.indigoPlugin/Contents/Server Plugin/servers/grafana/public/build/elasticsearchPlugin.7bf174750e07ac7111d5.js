(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{EnIS:function(e,t,r){"use strict";r.r(t);var n=r("Obii"),a=r("KHwQ"),i=r.n(a),o=r("LvDl"),s=r.n(o),l=r("wEtz"),u=[{text:"Count",value:"count",requiresField:!1},{text:"Average",value:"avg",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0},{text:"Sum",value:"sum",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0},{text:"Max",value:"max",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0},{text:"Min",value:"min",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0},{text:"Extended Stats",value:"extended_stats",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0},{text:"Percentiles",value:"percentiles",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0},{text:"Unique Count",value:"cardinality",requiresField:!0,supportsMissing:!0},{text:"Moving Average",value:"moving_avg",requiresField:!1,isPipelineAgg:!0,minVersion:2},{text:"Derivative",value:"derivative",requiresField:!1,isPipelineAgg:!0,minVersion:2},{text:"Cumulative Sum",value:"cumulative_sum",requiresField:!1,isPipelineAgg:!0,minVersion:2},{text:"Bucket Script",value:"bucket_script",requiresField:!1,isPipelineAgg:!0,supportsMultipleBucketPaths:!0,minVersion:2},{text:"Raw Document (legacy)",value:"raw_document",requiresField:!1},{text:"Raw Data",value:"raw_data",requiresField:!1},{text:"Logs",value:"logs",requiresField:!1}],c=[{text:"Terms",value:"terms",requiresField:!0},{text:"Filters",value:"filters"},{text:"Geo Hash Grid",value:"geohash_grid",requiresField:!0},{text:"Date Histogram",value:"date_histogram",requiresField:!0},{text:"Histogram",value:"histogram",requiresField:!0}],g=[{text:"Doc Count",value:"_count"},{text:"Term value",value:"_term"}],f=[{text:"Top",value:"desc"},{text:"Bottom",value:"asc"}],d=[{text:"No limit",value:"0"},{text:"1",value:"1"},{text:"2",value:"2"},{text:"3",value:"3"},{text:"5",value:"5"},{text:"10",value:"10"},{text:"15",value:"15"},{text:"20",value:"20"}],p=[{text:"Avg",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Sum",value:"sum"},{text:"Count",value:"count"},{text:"Std Dev",value:"std_deviation"},{text:"Std Dev Upper",value:"std_deviation_bounds_upper"},{text:"Std Dev Lower",value:"std_deviation_bounds_lower"}],m=[{text:"auto",value:"auto"},{text:"10s",value:"10s"},{text:"1m",value:"1m"},{text:"5m",value:"5m"},{text:"10m",value:"10m"},{text:"20m",value:"20m"},{text:"1h",value:"1h"},{text:"1d",value:"1d"}],v=[{text:"Simple",value:"simple"},{text:"Linear",value:"linear"},{text:"Exponentially Weighted",value:"ewma"},{text:"Holt Linear",value:"holt"},{text:"Holt Winters",value:"holt_winters"}],h={moving_avg:[{text:"window",default:5},{text:"model",default:"simple"},{text:"predict",default:void 0},{text:"minimize",default:!1}],derivative:[{text:"unit",default:void 0}],cumulative_sum:[{text:"format",default:void 0}],bucket_script:[]},y={simple:[],linear:[],ewma:[{text:"Alpha",value:"alpha",default:void 0}],holt:[{text:"Alpha",value:"alpha",default:void 0},{text:"Beta",value:"beta",default:void 0}],holt_winters:[{text:"Alpha",value:"alpha",default:void 0},{text:"Beta",value:"beta",default:void 0},{text:"Gamma",value:"gamma",default:void 0},{text:"Period",value:"period",default:void 0},{text:"Pad",value:"pad",default:void 0,isCheckbox:!0}]};function b(e){return s.a.filter(u,(function(t){return!t.minVersion||t.minVersion<=e}))}function O(e){if(e){var t=h[e];return null!=t}return!1}function _(e){return!!e&&void 0!==u.find((function(t){return t.value===e&&t.supportsMultipleBucketPaths}))}function x(e,t){var r=[];return t?(s.a.each(y[e],(function(e){e.isCheckbox||r.push(e)})),r):y[e]}function w(e){var t=s.a.find(u,{value:e.type});return t.requiresField||O(e.type)?t.text+" "+e.field:t.text}var k=function(e,t){return s.a.find(e,{id:t})};function j(e,t){return e&&e.metrics&&e.metrics.some((function(e){return e.type===t}))}var S=r("iZOS");function F(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?F(Object(r),!0).forEach((function(t){P(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function q(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var C=function(){function e(t,r){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.targets=t,this.response=r,this.processResponseToSeries=function(){for(var e=[],t=0;t<n.response.responses.length;t++){var r=n.response.responses[t];if(r.error)throw n.getErrorFromElasticResponse(n.response,r.error);if(r.hits&&r.hits.hits.length>0&&n.processHits(r.hits,e),r.aggregations){var a=r.aggregations,i=n.targets[t],o=[],s=new S.a;n.processBuckets(a,i,o,s,{},0),n.trimDatapoints(o,i),n.nameSeries(o,i);for(var l=0;l<o.length;l++)e.push(o[l]);s.rows.length>0&&e.push(s)}}return{data:e}},this.targets=t,this.response=r}var t,r,a;return t=e,(r=[{key:"processMetrics",value:function(e,t,r,n){var a,i,o,s,l,u;for(i=0;i<t.metrics.length;i++)if(!(a=t.metrics[i]).hide)switch(a.type){case"count":for(s={datapoints:[],metric:"count",props:n},o=0;o<e.buckets.length;o++)u=(l=e.buckets[o]).doc_count,s.datapoints.push([u,l.key]);r.push(s);break;case"percentiles":if(0===e.buckets.length)break;var c=e.buckets[0][a.id].values;for(var g in c){for(s={datapoints:[],metric:"p"+g,props:n,field:a.field},o=0;o<e.buckets.length;o++){var f=(l=e.buckets[o])[a.id].values;s.datapoints.push([f[g],l.key])}r.push(s)}break;case"extended_stats":for(var d in a.meta)if(a.meta[d]){for(s={datapoints:[],metric:d,props:n,field:a.field},o=0;o<e.buckets.length;o++){var p=(l=e.buckets[o])[a.id];p.std_deviation_bounds_upper=p.std_deviation_bounds.upper,p.std_deviation_bounds_lower=p.std_deviation_bounds.lower,s.datapoints.push([p[d],l.key])}r.push(s)}break;default:for(s={datapoints:[],metric:a.type,field:a.field,metricId:a.id,props:n},o=0;o<e.buckets.length;o++)void 0!==(u=(l=e.buckets[o])[a.id])&&(u.normalized_value?s.datapoints.push([u.normalized_value,l.key]):s.datapoints.push([u.value,l.key]));r.push(s)}}},{key:"processAggregationDocs",value:function(e,t,r,n,a){if(0===n.columns.length){var i=!0,o=!1,l=void 0;try{for(var u,c=s.a.keys(a)[Symbol.iterator]();!(i=(u=c.next()).done);i=!0){var g=u.value;n.addColumn({text:g,filterable:!0})}}catch(e){o=!0,l=e}finally{try{i||null==c.return||c.return()}finally{if(o)throw l}}n.addColumn({text:t.field,filterable:!0})}var f=function(e,t,r){n.addColumn({text:t}),e.push(r)},d=s.a.isArray(e.buckets)?e.buckets:[e.buckets],p=!0,m=!1,v=void 0;try{for(var h,y=d[Symbol.iterator]();!(p=(h=y.next()).done);p=!0){var b=h.value,O=[],_=!0,x=!1,w=void 0;try{for(var k,j=s.a.values(a)[Symbol.iterator]();!(_=(k=j.next()).done);_=!0){var S=k.value;O.push(S)}}catch(e){x=!0,w=e}finally{try{_||null==j.return||j.return()}finally{if(x)throw w}}O.push(b.key);var F=!0,E=!1,P=void 0;try{for(var q,C=r.metrics[Symbol.iterator]();!(F=(q=C.next()).done);F=!0){var A=q.value;switch(A.type){case"count":f(O,this.getMetricName(A.type),b.doc_count);break;case"extended_stats":for(var D in A.meta)if(A.meta[D]){var T=b[A.id];T.std_deviation_bounds_upper=T.std_deviation_bounds.upper,T.std_deviation_bounds_lower=T.std_deviation_bounds.lower,f(O,this.getMetricName(D),T[D])}break;case"percentiles":var M=b[A.id].values;for(var L in M)f(O,"p".concat(L," ").concat(A.field),M[L]);break;default:var V=this.getMetricName(A.type);s.a.filter(r.metrics,{type:A.type}).length>1&&(V+=" "+A.field),f(O,V,b[A.id].value)}}}catch(e){E=!0,P=e}finally{try{F||null==C.return||C.return()}finally{if(E)throw P}}n.rows.push(O)}}catch(e){m=!0,v=e}finally{try{p||null==y.return||y.return()}finally{if(m)throw v}}}},{key:"processBuckets",value:function(e,t,r,n,a,i){var o,l,u,c,g=t.bucketAggs.length-1;for(c in e)if(l=s.a.find(t.bucketAggs,{id:c}),u=e[c],l)if(i===g)"date_histogram"===l.type?this.processMetrics(u,t,r,a):this.processAggregationDocs(u,l,t,n,a);else for(var f in u.buckets)o=u.buckets[f],a=s.a.clone(a),void 0!==o.key?a[l.field]=o.key:a.filter=f,o.key_as_string&&(a[l.field]=o.key_as_string),this.processBuckets(o,t,r,n,a,i+1)}},{key:"getMetricName",value:function(e){var t=s.a.find(u,{value:e});return t||(t=s.a.find(p,{value:e})),t?t.text:e}},{key:"getSeriesName",value:function(e,t,r){var n=this.getMetricName(e.metric);if(t.alias)return t.alias.replace(/\{\{([\s\S]+?)\}\}/g,(function(t,r,a){var i=r||a;return 0===i.indexOf("term ")?e.props[i.substring(5)]:void 0!==e.props[i]?e.props[i]:"metric"===i?n:"field"===i?e.field||"":t}));if(e.field&&O(e.metric))if(e.metric&&_(e.metric)){var a=s.a.find(t.metrics,{id:e.metricId});if(a&&a.settings.script){n=a.settings.script;var i=!0,o=!1,l=void 0;try{for(var u,c=a.pipelineVariables[Symbol.iterator]();!(i=(u=c.next()).done);i=!0){var g=u.value,f=s.a.find(t.metrics,{id:g.pipelineAgg});f&&(n=n.replace("params."+g.name,w(f)))}}catch(e){o=!0,l=e}finally{try{i||null==c.return||c.return()}finally{if(o)throw l}}}else n="Unset"}else{var d=s.a.find(t.metrics,{id:e.field});d?n+=" "+w(d):n="Unset"}else e.field&&(n+=" "+e.field);if(0===s.a.keys(e.props).length)return n;var p="";for(var m in e.props)p+=e.props[m]+" ";return 1===r?p.trim():p.trim()+" "+n}},{key:"nameSeries",value:function(e,t){for(var r=s.a.uniq(s.a.map(e,"metric")).length,n=0;n<e.length;n++){var a=e[n];a.target=this.getSeriesName(a,t,r)}}},{key:"processHits",value:function(e,t){var r,n,a,i,o={target:"docs",type:"docs",datapoints:[],total:"number"==typeof e.total?e.total:e.total.value,filterable:!0};for(i=0;i<e.hits.length;i++){if(a={_id:(n=e.hits[i])._id,_type:n._type,_index:n._index},n._source)for(r in n._source)a[r]=n._source[r];for(r in n.fields)a[r]=n.fields[r];o.datapoints.push(a)}t.push(o)}},{key:"trimDatapoints",value:function(e,t){var r=s.a.find(t.bucketAggs,{type:"date_histogram"});if(r&&r.settings&&r.settings.trimEdges){var n=r.settings.trimEdges;for(var a in e){var i=e[a];i.datapoints.length>2*n&&(i.datapoints=i.datapoints.slice(n,i.datapoints.length-n))}}}},{key:"getErrorFromElasticResponse",value:function(e,t){var r={};return r.data=JSON.stringify(t,null,4),t.root_cause&&t.root_cause.length>0&&t.root_cause[0].reason?r.message=t.root_cause[0].reason:r.message=t.reason||"Unknown elastic error response",e.$$config&&(r.config=e.$$config),r}},{key:"getTimeSeries",value:function(){return this.targets.some((function(e){return e.metrics.some((function(e){return"raw_data"===e.type}))}))?this.processResponseToDataFrames(!1):this.processResponseToSeries()}},{key:"getLogs",value:function(e,t){return this.processResponseToDataFrames(!0,e,t)}},{key:"processResponseToDataFrames",value:function(e,t,r){for(var a=[],i=0;i<this.response.responses.length;i++){var o=this.response.responses[i];if(o.error)throw this.getErrorFromElasticResponse(this.response,o.error);if(o.hits&&o.hits.hits.length>0){var s=A(o.hits.hits),l=s.propNames,u=s.docs;if(u.length>0){var c=D(l,this.targets[0].timeField,e,t,r),g=!0,f=!1,d=void 0;try{for(var p,m=u[Symbol.iterator]();!(g=(p=m.next()).done);g=!0){var v=p.value;r&&(v.level=v[r]),c.add(v)}}catch(e){f=!0,d=e}finally{try{g||null==m.return||m.return()}finally{if(f)throw d}}e&&(c=T(c,"logs")),a.push(c)}}if(o.aggregations){var h=o.aggregations,y=this.targets[i],b=[],O=new S.a;this.processBuckets(h,y,b,O,{},0),this.trimDatapoints(b,y),this.nameSeries(b,y),O.rows.length>0&&a.push(Object(n.toDataFrame)(O));for(var _=0;_<b.length;_++){var x=Object(n.toDataFrame)(b[_]);e&&(x=T(x,"graph")),a.push(x)}}}return{data:a}}}])&&q(t.prototype,r),a&&q(t,a),e}(),A=function(e){var t=[],r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){for(var u=o.value,c=u._source?Object(l.default)(u._source,null):{},g=E({_id:u._id,_type:u._type,_index:u._index,_source:E({},c)},c),f=0,d=Object.keys(g);f<d.length;f++){var p=d[f];-1===r.indexOf(p)&&r.push(p)}t.push(g)}}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r.sort(),{docs:t,propNames:r}},D=function(e,t,r,a,i){var o=new n.MutableDataFrame({fields:[]});o.addField({name:t,type:n.FieldType.time}),a&&(o.addField({name:a,type:n.FieldType.string}).parse=function(e){return e||""}),i&&(o.addField({name:"level",type:n.FieldType.string}).parse=function(e){return e||""});var s=o.fields.map((function(e){return e.name})),l=!0,u=!1,c=void 0;try{for(var g,f=e[Symbol.iterator]();!(l=(g=f.next()).done);l=!0){var d=g.value;s.includes(d)||(r||"_source"!==d)&&(o.addField({name:d,type:n.FieldType.string}).parse=function(e){return e||""})}}catch(e){u=!0,c=e}finally{try{l||null==f.return||f.return()}finally{if(u)throw c}}return o},T=function(e,t){var r=e;return r.meta?r.meta.preferredVisualisationType=t:r.meta={preferredVisualisationType:t},r};function M(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var L={Hourly:{startOf:"hour",amount:"hours"},Daily:{startOf:"day",amount:"days"},Weekly:{startOf:"isoWeek",amount:"weeks"},Monthly:{startOf:"month",amount:"months"},Yearly:{startOf:"year",amount:"years"}},V=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pattern=t,this.interval=r}var t,r,a;return t=e,(r=[{key:"getIndexForToday",value:function(){return this.interval?Object(n.toUtc)().format(this.pattern):this.pattern}},{key:"getIndexList",value:function(e,t){if(!this.interval)return this.pattern;for(var r=L[this.interval],a=Object(n.dateTime)(e).utc().startOf(r.startOf),i=Object(n.dateTime)(t).utc().startOf(r.startOf).valueOf(),o=[];a.valueOf()<=i;)o.push(a.format(this.pattern)),a.add(1,r.amount);return o}}])&&M(t.prototype,r),a&&M(t,a),e}();function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function $(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function N(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var R=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.timeField=t.timeField,this.esVersion=t.esVersion}var t,r,n;return t=e,(r=[{key:"getRangeFilter",value:function(){var e={};return e[this.timeField]={gte:"$timeFrom",lte:"$timeTo",format:"epoch_millis"},e}},{key:"buildTermsAgg",value:function(e,t,r){var n,a,i;if(t.terms={field:e.field},!e.settings)return t;if(t.terms.size=0===parseInt(e.settings.size,10)?500:parseInt(e.settings.size,10),void 0!==e.settings.orderBy&&(t.terms.order={},"_term"===e.settings.orderBy&&this.esVersion>=60?t.terms.order._key=e.settings.order:t.terms.order[e.settings.orderBy]=e.settings.order,n=parseInt(e.settings.orderBy,10),!isNaN(n)))for(i=0;i<r.metrics.length;i++)if((a=r.metrics[i]).id===e.settings.orderBy){t.aggs={},t.aggs[a.id]={},t.aggs[a.id][a.type]={field:a.field};break}return void 0!==e.settings.min_doc_count&&(t.terms.min_doc_count=parseInt(e.settings.min_doc_count,10),isNaN(t.terms.min_doc_count)&&(t.terms.min_doc_count=e.settings.min_doc_count)),e.settings.missing&&(t.terms.missing=e.settings.missing),t}},{key:"getDateHistogramAgg",value:function(e){var t={},r=e.settings||{};return t.interval=r.interval,t.field=this.timeField,t.min_doc_count=r.min_doc_count||0,t.extended_bounds={min:"$timeFrom",max:"$timeTo"},t.format="epoch_millis",""!==r.offset&&(t.offset=r.offset),"auto"===t.interval&&(t.interval="$__interval"),r.missing&&(t.missing=r.missing),t}},{key:"getHistogramAgg",value:function(e){var t={},r=e.settings||{};return t.interval=r.interval,t.field=e.field,t.min_doc_count=r.min_doc_count||0,r.missing&&(t.missing=r.missing),t}},{key:"getFiltersAgg",value:function(e){for(var t={},r=0;r<e.settings.filters.length;r++){var n=e.settings.filters[r].query,a=e.settings.filters[r].label;t[a=""===a||void 0===a?n:a]={query_string:{query:n,analyze_wildcard:!0}}}return t}},{key:"documentQuery",value:function(e,t){return e.size=t,e.sort={},e.sort[this.timeField]={order:"desc",unmapped_type:"boolean"},this.esVersion<5&&(e.fields=["*","_source"]),e.script_fields={},e}},{key:"addAdhocFilters",value:function(e,t){var r,n,a,i;if(t)for(r=0;r<t.length;r++)switch((a={})[(n=t[r]).key]=n.value,(i={})[n.key]={query:n.value},n.operator){case"=":e.query.bool.must||(e.query.bool.must=[]),e.query.bool.must.push({match_phrase:i});break;case"!=":e.query.bool.must_not||(e.query.bool.must_not=[]),e.query.bool.must_not.push({match_phrase:i});break;case"<":a[n.key]={lt:n.value},e.query.bool.filter.push({range:a});break;case">":a[n.key]={gt:n.value},e.query.bool.filter.push({range:a});break;case"=~":e.query.bool.filter.push({regexp:a});break;case"!~":e.query.bool.filter.push({bool:{must_not:{regexp:a}}})}}},{key:"build",value:function(e,t,r){var n,a,i,o,s,l,u,c,g;e.metrics=e.metrics||[{type:"count",id:"1"}],e.bucketAggs=e.bucketAggs||[{type:"date_histogram",id:"2",settings:{interval:"auto"}}],e.timeField=this.timeField;var f={size:0,query:{bool:{filter:[{range:this.getRangeFilter()},{query_string:{analyze_wildcard:!0,query:r}}]}}};if(this.addAdhocFilters(f,t),0===e.bucketAggs.length&&(!(g=e.metrics[0])||"raw_document"!==g.type&&"raw_data"!==g.type))throw{message:"Invalid query"};if("raw_document"===(null===(n=e.metrics)||void 0===n?void 0:null===(a=n[0])||void 0===a?void 0:a.type)||"raw_data"===(null===(i=e.metrics)||void 0===i?void 0:null===(o=i[0])||void 0===o?void 0:o.type)){var d=(g=e.metrics[0]).settings&&0!==g.settings.size&&g.settings.size||500;return this.documentQuery(f,d)}for(c=f,s=0;s<e.bucketAggs.length;s++){var p=e.bucketAggs[s],m={};switch(p.type){case"date_histogram":m.date_histogram=this.getDateHistogramAgg(p);break;case"histogram":m.histogram=this.getHistogramAgg(p);break;case"filters":m.filters={filters:this.getFiltersAgg(p)};break;case"terms":this.buildTermsAgg(p,m,e);break;case"geohash_grid":m.geohash_grid={field:p.field,precision:p.settings.precision}}c.aggs=c.aggs||{},c.aggs[p.id]=m,c=m}for(c.aggs={},s=0;s<e.metrics.length;s++)if("count"!==(g=e.metrics[s]).type){var v={},h=null;if(O(g.type))if(_(g.type)){if(!g.pipelineVariables)continue;for(h={buckets_path:{}},l=0;l<g.pipelineVariables.length;l++)if((u=g.pipelineVariables[l]).name&&u.pipelineAgg&&/^\d*$/.test(u.pipelineAgg)){var y=k(e.metrics,u.pipelineAgg);y&&("count"===y.type?h.buckets_path[u.name]="_count":h.buckets_path[u.name]=u.pipelineAgg)}}else{if(!g.pipelineAgg||!/^\d*$/.test(g.pipelineAgg))continue;var b=k(e.metrics,g.pipelineAgg);b&&(h="count"===b.type?{buckets_path:"_count"}:{buckets_path:g.pipelineAgg})}else h={field:g.field};for(var x in g.settings)g.settings.hasOwnProperty(x)&&null!==g.settings[x]&&(h[x]=g.settings[x]);v[g.type]=h,c.aggs[g.id]=v}return f}},{key:"getTermsQuery",value:function(e){var t={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};e.query&&t.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:e.query}});var r=500;e.size&&(r=e.size),t.aggs={1:{terms:{field:e.field,size:r,order:{}}}};var n=e.orderBy,a=void 0===n?"key":n,i=e.order,o=void 0===i?"doc_count"===a?"desc":"asc":i;if(["asc","desc"].indexOf(o)<0)throw{message:"Invalid query sort order ".concat(o)};switch(a){case"key":case"term":var s=this.esVersion>=60?"_key":"_term";t.aggs[1].terms.order[s]=o;break;case"doc_count":t.aggs[1].terms.order._count=o;break;default:throw{message:"Invalid query sort type ".concat(a)}}return t}},{key:"getLogsQuery",value:function(e,t,r){var n={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};return this.addAdhocFilters(n,t),e.query&&n.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:r}}),function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach((function(t){$(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},n=this.documentQuery(n,500),{aggs:this.build(e,null,r).aggs})}}])&&N(t.prototype,r),n&&N(t,n),e}(),z=r("t8hP");function B(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Q(e){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function W(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function H(e,t,r,n,a,i,o){try{var s=e[i](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function Y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function J(e,t){return!t||"object"!==Q(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function K(e,t){return(K=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var X=function(e){function t(e,r,n){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=J(this,G(t).call(this,e))).templateSrv=r,a.timeSrv=n,a.basicAuth=e.basicAuth,a.withCredentials=e.withCredentials,a.url=e.url,a.name=e.name,a.index=e.database;var i=e.jsonData||{};return a.timeField=i.timeField,a.esVersion=i.esVersion,a.indexPattern=new V(a.index,i.interval),a.interval=i.timeInterval,a.maxConcurrentShardRequests=i.maxConcurrentShardRequests,a.queryBuilder=new R({timeField:a.timeField,esVersion:a.esVersion}),a.logMessageField=i.logMessageField||"",a.logLevelField=i.logLevelField||"",a.dataLinks=i.dataLinks||[],""===a.logMessageField&&(a.logMessageField=null),""===a.logLevelField&&(a.logLevelField=null),a}var r,a,o,l,u;return t.$inject=["instanceSettings","templateSrv","timeSrv"],function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&K(e,t)}(t,e),r=t,(a=[{key:"request",value:function(e,t,r){var n={url:this.url+"/"+t,method:e,data:r};return(this.basicAuth||this.withCredentials)&&(n.withCredentials=!0),this.basicAuth&&(n.headers={Authorization:this.basicAuth}),Object(z.getBackendSrv)().datasourceRequest(n).catch((function(e){if(e.data&&e.data.error)throw{message:"Elasticsearch error: "+e.data.error.reason,error:e.data.error};throw e}))}},{key:"get",value:function(e){var t=this.timeSrv.timeRange(),r=this.indexPattern.getIndexList(t.from.valueOf(),t.to.valueOf());return s.a.isArray(r)&&r.length?this.requestAllIndices(r,e).then((function(e){return e.data.$$config=e.config,e.data})):this.request("GET",this.indexPattern.getIndexForToday()+e).then((function(e){return e.data.$$config=e.config,e.data}))}},{key:"requestAllIndices",value:(l=regeneratorRuntime.mark((function e(t,r){var n,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=7,a=t.length,i=0;case 3:if(!(i<Math.min(a,n))){e.next=17;break}return e.prev=4,e.next=7,this.request("GET",t[a-i-1]+r);case 7:return e.abrupt("return",e.sent);case 10:if(e.prev=10,e.t0=e.catch(4),404===e.t0.status&&i!==n-1){e.next=14;break}throw e.t0;case 14:i++,e.next=3;break;case 17:case"end":return e.stop()}}),e,this,[[4,10]])})),u=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=l.apply(e,t);function i(e){H(a,r,n,i,o,"next",e)}function o(e){H(a,r,n,i,o,"throw",e)}i(void 0)}))},function(e,t){return u.apply(this,arguments)})},{key:"post",value:function(e,t){return this.request("POST",e,t).then((function(e){return e.data.$$config=e.config,e.data}))}},{key:"annotationQuery",value:function(e){var t=e.annotation,r=t.timeField||"@timestamp",a=t.timeEndField||null,o=t.query||"*",l=t.tagsField||"tags",u=t.textField||null,c=[],g={};if(g[r]={from:e.range.from.valueOf(),to:e.range.to.valueOf(),format:"epoch_millis"},c.push({range:g}),a){var f={};f[a]={from:e.range.from.valueOf(),to:e.range.to.valueOf(),format:"epoch_millis"},c.push({range:f})}var d={query:{bool:{filter:[{bool:{should:c,minimum_should_match:1}},{query_string:{query:this.templateSrv.replace(o,{},"lucene")}}]}},size:1e4};this.esVersion<5&&(d.fields=[r,"_source"]);var p={search_type:"query_then_fetch",ignore_unavailable:!0};t.index?p.index=t.index:p.index=this.indexPattern.getIndexList(e.range.from,e.range.to);var m=i.a.toJson(p)+"\n"+i.a.toJson(d)+"\n";return this.post("_msearch",m).then((function(e){for(var i=[],o=e.responses[0].hits.hits,c=function(e,t){if(t){for(var r=t.split("."),n=e,a=0;a<r.length;a++)if(!(n=n[r[a]]))return console.log("could not find field in annotation: ",t),"";return n}},g=0;g<o.length;g++){var f=o[g]._source,d=c(f,r);if(void 0!==o[g].fields){var p=o[g].fields;(s.a.isString(p[r])||s.a.isNumber(p[r]))&&(d=p[r])}var m={annotation:t,time:Object(n.toUtc)(d).valueOf(),text:c(f,u),tags:c(f,l)};if(a){var v=c(f,a);v&&(m.timeEnd=Object(n.toUtc)(v).valueOf())}if(t.titleField){var h=c(f,t.titleField);h&&(m.text=h+"\n"+m.text)}"string"==typeof m.tags&&(m.tags=m.tags.split(",")),i.push(m)}return i}))}},{key:"interpolateVariablesInQueries",value:function(e,t){var r=this,n=e;return e&&e.length>0&&(n=e.map((function(e){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?U(Object(r),!0).forEach((function(t){W(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e,{datasource:r.name,query:r.templateSrv.replace(e.query,t,"lucene")})}))),n}},{key:"testDatasource",value:function(){var e=this;return this.getFields({type:"date"}).then((function(t){return s.a.find(t,{text:e.timeField})?{status:"success",message:"Index OK. Time field name OK."}:{status:"error",message:"No date field named "+e.timeField+" found"}}),(function(e){if(console.log(e),e.data&&e.data.error){var t=i.a.toJson(e.data.error);return e.data.error.reason&&(t=e.data.error.reason),{status:"error",message:t}}return{status:"error",message:e.status}}))}},{key:"getQueryHeader",value:function(e,t,r){var n={search_type:e,ignore_unavailable:!0,index:this.indexPattern.getIndexList(t,r)};return this.esVersion>=56&&this.esVersion<70&&(n.max_concurrent_shard_requests=this.maxConcurrentShardRequests),i.a.toJson(n)}},{key:"query",value:function(e){var t=this,r="",n=s.a.cloneDeep(e.targets),a=[],o=this.templateSrv.getAdhocFilters(this.name),l=!0,u=!1,c=void 0;try{for(var g,f=n[Symbol.iterator]();!(l=(g=f.next()).done);l=!0){var d=g.value;if(!d.hide){var p=this.templateSrv.replace(d.query,e.scopedVars,"lucene");p&&""!==p||(p="*");var m=void 0;d.isLogsQuery||j(d,"logs")?(d.bucketAggs=[{type:"date_histogram",id:"2",settings:{interval:"auto"}}],d.metrics=[],d.isLogsQuery=!0,m=this.queryBuilder.getLogsQuery(d,o,p)):(d.alias&&(d.alias=this.templateSrv.replace(d.alias,e.scopedVars,"lucene")),m=this.queryBuilder.build(d,o,p));var v=i.a.toJson(m),h=0===m.size&&this.esVersion<5?"count":"query_then_fetch";r+=this.getQueryHeader(h,e.range.from,e.range.to)+"\n",r+=v+"\n",a.push(d)}}}catch(e){u=!0,c=e}finally{try{l||null==f.return||f.return()}finally{if(u)throw c}}if(0===a.length)return Promise.resolve({data:[]});r=(r=r.replace(/"\$timeFrom"/g,e.range.from.valueOf().toString())).replace(/"\$timeTo"/g,e.range.to.valueOf().toString()),r=this.templateSrv.replace(r,e.scopedVars);var y=this.getMultiSearchUrl();return this.post(y,r).then((function(e){var r=new C(a,e);if(a.some((function(e){return e.isLogsQuery}))){var n=r.getLogs(t.logMessageField,t.logLevelField),i=!0,o=!1,s=void 0;try{for(var l,u=n.data[Symbol.iterator]();!(i=(l=u.next()).done);i=!0)Z(l.value,t.dataLinks)}catch(e){o=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw s}}return n}return r.getTimeSeries()}))}},{key:"getFields",value:function(e){var t=this.esVersion;return this.get("/_mapping").then((function(r){var n={float:"number",double:"number",integer:"number",long:"number",date:"date",string:"string",text:"string",scaled_float:"number",nested:"nested"};function a(e,t,r){return"_"!==t[0]&&(!r.type||r.type===e.type||r.type===n[e.type])}var i=[],o={};function l(t){for(var r in t){var n=t[r];if(s.a.isObject(n.properties)&&(i.push(r),l(n.properties)),s.a.isObject(n.fields)&&(i.push(r),l(n.fields)),s.a.isString(n.type)){var u=i.concat(r).join(".");a(n,r,e)&&(o[u]={text:u,type:n.type})}}i.pop()}for(var u in r){var c=r[u];if(c&&c.mappings){var g=c.mappings;if(t<70)for(var f in g)l(g[f].properties);else l(g.properties)}}return s.a.map(o,(function(e){return e}))}))}},{key:"getTerms",value:function(e){var t=this.timeSrv.timeRange(),r=this.esVersion>=5?"query_then_fetch":"count",n=this.getQueryHeader(r,t.from,t.to),a=i.a.toJson(this.queryBuilder.getTermsQuery(e));a=n+"\n"+(a=(a=a.replace(/\$timeFrom/g,t.from.valueOf().toString())).replace(/\$timeTo/g,t.to.valueOf().toString()))+"\n";var o=this.getMultiSearchUrl();return this.post(o,a).then((function(e){if(!e.responses[0].aggregations)return[];var t=e.responses[0].aggregations[1].buckets;return s.a.map(t,(function(e){return{text:e.key_as_string||e.key,value:e.key}}))}))}},{key:"getMultiSearchUrl",value:function(){return this.esVersion>=70&&this.maxConcurrentShardRequests?"_msearch?max_concurrent_shard_requests=".concat(this.maxConcurrentShardRequests):"_msearch"}},{key:"metricFindQuery",value:function(e){if(e=i.a.fromJson(e)){if("fields"===e.find)return e.field=this.templateSrv.replace(e.field,{},"lucene"),this.getFields(e);if("terms"===e.find)return e.field=this.templateSrv.replace(e.field,{},"lucene"),e.query=this.templateSrv.replace(e.query||"*",{},"lucene"),this.getTerms(e)}return Promise.resolve([])}},{key:"getTagKeys",value:function(){return this.getFields({})}},{key:"getTagValues",value:function(e){return this.getTerms({field:e.key,query:"*"})}},{key:"targetContainsTemplate",value:function(e){if(this.templateSrv.variableExists(e.query)||this.templateSrv.variableExists(e.alias))return!0;var t=!0,r=!1,n=void 0;try{for(var a,i=e.bucketAggs[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;if(this.templateSrv.variableExists(o.field)||this.objectContainsTemplate(o.settings))return!0}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}var s=!0,l=!1,u=void 0;try{for(var c,g=e.metrics[Symbol.iterator]();!(s=(c=g.next()).done);s=!0){var f=c.value;if(this.templateSrv.variableExists(f.field)||this.objectContainsTemplate(f.settings)||this.objectContainsTemplate(f.meta))return!0}}catch(e){l=!0,u=e}finally{try{s||null==g.return||g.return()}finally{if(l)throw u}}return!1}},{key:"isPrimitive",value:function(e){return null==e||!!["string","number","boolean"].some((function(e){return e===Q(!0)}))}},{key:"objectContainsTemplate",value:function(e){if(!e)return!1;for(var t=0,r=Object.keys(e);t<r.length;t++){var n=r[t];if(this.isPrimitive(e[n])){if(this.templateSrv.variableExists(e[n]))return!0}else if(Array.isArray(e[n])){var a=!0,i=!1,o=void 0;try{for(var s,l=e[n][Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var u=s.value;if(this.objectContainsTemplate(u))return!0}}catch(e){i=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}}else if(this.objectContainsTemplate(e[n]))return!0}return!1}}])&&Y(r.prototype,a),o&&Y(r,o),t}(n.DataSourceApi);function Z(e,t){if(t.length){var r=!0,n=!1,a=void 0;try{for(var i,o=function(){var e,r=i.value,n=t.find((function(e){return r.name&&r.name.match(e.field)}));n&&(e=n.datasourceUid?{title:"",url:"",internal:{query:{query:n.url},datasourceUid:n.datasourceUid}}:{title:"",url:n.url},r.config=r.config||{},r.config.links=[].concat(B(r.config.links||[]),[e]))},s=e.fields[Symbol.iterator]();!(r=(i=s.next()).done);r=!0)o()}catch(e){n=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw a}}}}var ee=r("txxJ"),te=r("GQ3c");var re=function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var a=t.target.bucketAggs;t.orderByOptions=[],t.getBucketAggTypes=function(){return c},t.getOrderOptions=function(){return f},t.getSizeOptions=function(){return d},n.onAppEvent(te.CoreEvents.elasticQueryUpdated,(function(){t.validateModel()}),t),t.init=function(){t.agg=a[t.index],t.validateModel()},t.onChangeInternal=function(){t.onChange()},t.onTypeChanged=function(){switch(t.agg.settings={},t.showOptions=!1,t.agg.type){case"date_histogram":case"histogram":case"terms":delete t.agg.query,t.agg.field="select field";break;case"filters":delete t.agg.field,t.agg.query="*";break;case"geohash_grid":t.agg.settings.precision=3}t.validateModel(),t.onChange()},t.validateModel=function(){t.index=s.a.indexOf(a,t.agg),t.isFirst=0===t.index,t.bucketAggCount=a.length;var e,r="",n=t.agg.settings||{};switch(t.agg.type){case"terms":n.order=n.order||"desc",n.size=n.size||"10",n.min_doc_count=n.min_doc_count||0,n.orderBy=n.orderBy||"_term","0"!==n.size&&(e=n.order,r=s.a.find(f,{value:e}).text+" "+n.size+", "),n.min_doc_count>0&&(r+="Min Doc Count: "+n.min_doc_count+", "),r+="Order by: "+function(e,t){var r=s.a.find(g,{value:e});if(r)return r.text;var n=s.a.find(t.metrics,{id:e});return n?w(n):"metric not found"}(n.orderBy,t.target),"0"===n.size&&(r+=" ("+n.order+")");break;case"filters":n.filters=n.filters||[{query:"*"}],(r=s.a.reduce(n.filters,(function(e,t,r){return e+="Q"+(r+1)+"  = "+t.query+" "}),"")).length>50&&(r=r.substr(0,50)+"..."),r="Filter Queries ("+n.filters.length+")";break;case"date_histogram":n.interval=n.interval||"auto",n.min_doc_count=n.min_doc_count||0,t.agg.field=t.target.timeField,r="Interval: "+n.interval,n.min_doc_count>0&&(r+=", Min Doc Count: "+n.min_doc_count),(void 0===n.trimEdges||n.trimEdges<0)&&(n.trimEdges=0),n.trimEdges&&n.trimEdges>0&&(r+=", Trim edges: "+n.trimEdges);break;case"histogram":n.interval=n.interval||1e3,n.min_doc_count=s.a.defaultTo(n.min_doc_count,1),r="Interval: "+n.interval,n.min_doc_count>0&&(r+=", Min Doc Count: "+n.min_doc_count);break;case"geohash_grid":n.precision=Math.max(Math.min(n.precision,7),1),r="Precision: "+n.precision}return t.settingsLinkText=r,t.agg.settings=n,!0},t.addFiltersQuery=function(){t.agg.settings.filters.push({query:"*"})},t.removeFiltersQuery=function(e){t.agg.settings.filters=s.a.without(t.agg.settings.filters,e)},t.toggleOptions=function(){t.showOptions=!t.showOptions},t.getOrderByOptions=function(){return e=t.target,r=[],s.a.each(e.metrics,(function(e){"count"!==e.type&&r.push({text:w(e),value:e.id})})),g.concat(r);var e,r},t.getFieldsInternal=function(){return"date_histogram"===t.agg.type?t.getFields({$fieldType:"date"}):t.getFields()},t.getIntervalOptions=function(){return Promise.resolve(r.transformToSegments(!0,"interval")(m))},t.addBucketAgg=function(){var e=a[a.length-1],r=a.length-1;e&&"date_histogram"===e.type&&(r-=1);var n=s.a.reduce(t.target.bucketAggs.concat(t.target.metrics),(function(e,t){return parseInt(t.id,10)>e?parseInt(t.id,10):e}),0);a.splice(r,0,{type:"terms",field:"select field",id:(n+1).toString(),fake:!0}),t.onChange()},t.removeBucketAgg=function(){a.splice(t.index,1),t.onChange()},t.init()};re.$inject=["$scope","uiSegmentSrv","$rootScope"],re.$inject=["$scope","uiSegmentSrv","$rootScope"],ee.c.directive("elasticBucketAgg",(function(){return{templateUrl:"public/app/plugins/datasource/elasticsearch/partials/bucket_agg.html",controller:re,restrict:"E",scope:{target:"=",index:"=",onChange:"&",getFields:"&"}}}));var ne=function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var a=t.target.metrics;t.metricAggTypes=b(t.esVersion),t.extendedStats=p,t.pipelineAggOptions=[],t.modelSettingsValues={},t.init=function(){t.agg=a[t.index],t.validateModel(),t.updatePipelineAggOptions()},t.updatePipelineAggOptions=function(){var e,r;t.pipelineAggOptions=(e=t.target,r=[],s.a.each(e.metrics,(function(e){O(e.type)||r.push({text:w(e),value:e.id})})),r)},n.onAppEvent(te.CoreEvents.elasticQueryUpdated,(function(){t.index=s.a.indexOf(a,t.agg),t.updatePipelineAggOptions(),t.validateModel()}),t),t.validateModel=function(){if(t.isFirst=0===t.index,t.isSingle=1===a.length,t.settingsLinkText="",t.variablesLinkText="",t.aggDef=s.a.find(t.metricAggTypes,{value:t.agg.type}),O(t.agg.type)){_(t.agg.type)?(t.variablesLinkText="Options",t.agg.settings.script&&(t.variablesLinkText="Script: "+t.agg.settings.script.replace(new RegExp("params.","g"),""))):(t.agg.pipelineAgg=t.agg.pipelineAgg||"select metric",t.agg.field=t.agg.pipelineAgg);var e=O((r=t.agg).type)?h[r.type]:[];e.length>0&&(s.a.each(e,(function(e){t.agg.settings[e.text]=t.agg.settings[e.text]||e.default})),t.settingsLinkText="Options")}else t.agg.field||(t.agg.field="select field");var r;switch(t.agg.type){case"cardinality":var n=t.agg.settings.precision_threshold||"";t.settingsLinkText="Precision threshold: "+n;break;case"percentiles":t.agg.settings.percents=t.agg.settings.percents||[25,50,75,95,99],t.settingsLinkText="Values: "+t.agg.settings.percents.join(",");break;case"extended_stats":0===s.a.keys(t.agg.meta).length&&(t.agg.meta.std_deviation_bounds_lower=!0,t.agg.meta.std_deviation_bounds_upper=!0);var i=s.a.reduce(t.agg.meta,(function(e,r,n){if(r){var a=s.a.find(t.extendedStats,{value:n});e.push(a.text)}return e}),[]);t.settingsLinkText="Stats: "+i.join(", ");break;case"moving_avg":t.movingAvgModelTypes=v,t.modelSettings=x(t.agg.settings.model,!0),t.updateMovingAvgModelSettings();break;case"raw_document":case"raw_data":t.agg.settings.size=t.agg.settings.size||500,t.settingsLinkText="Size: "+t.agg.settings.size,t.target.metrics.splice(0,t.target.metrics.length,t.agg),t.target.bucketAggs=[]}if(t.aggDef.supportsInlineScript){var o=t.agg.inlineScript;o?t.agg.settings.script={inline:o}:delete t.agg.settings.script,""===t.settingsLinkText&&(t.settingsLinkText="Options")}},t.toggleOptions=function(){t.showOptions=!t.showOptions,t.updatePipelineAggOptions()},t.toggleVariables=function(){t.showVariables=!t.showVariables},t.onChangeInternal=function(){t.onChange()},t.updateMovingAvgModelSettings=function(){for(var e=[],r=x(t.agg.settings.model,!1),n=0;n<r.length;n++)e.push(r[n].value);for(var a in t.agg.settings.settings)null!==t.agg.settings.settings[a]&&-1!==e.indexOf(a)||delete t.agg.settings.settings[a]},t.onChangeClearInternal=function(){delete t.agg.settings.minimize,t.onChange()},t.onTypeChange=function(){t.agg.settings={},t.agg.meta={},t.showOptions=!1,0!==t.target.bucketAggs.length||"raw_document"===t.agg.type&&"raw_data"===t.agg.type||(t.target.bucketAggs=[{type:"date_histogram",id:"2",settings:{interval:"auto"}}]),t.showVariables=_(t.agg.type),t.updatePipelineAggOptions(),t.onChange()},t.getFieldsInternal=function(){return"cardinality"===t.agg.type?t.getFields():t.getFields({$fieldType:"number"})},t.addMetricAgg=function(){var e=a.length,r=s.a.reduce(t.target.bucketAggs.concat(t.target.metrics),(function(e,t){return parseInt(t.id,10)>e?parseInt(t.id,10):e}),0);a.splice(e,0,{type:"count",field:"select field",id:(r+1).toString()}),t.onChange()},t.removeMetricAgg=function(){a.splice(t.index,1),t.onChange()},t.toggleShowMetric=function(){t.agg.hide=!t.agg.hide,t.agg.hide||delete t.agg.hide,t.onChange()},t.init()};ne.$inject=["$scope","uiSegmentSrv","$rootScope"],ne.$inject=["$scope","uiSegmentSrv","$rootScope"],ee.c.directive("elasticMetricAgg",(function(){return{templateUrl:"public/app/plugins/datasource/elasticsearch/partials/metric_agg.html",controller:ne,restrict:"E",scope:{target:"=",index:"=",onChange:"&",getFields:"&",esVersion:"="}}}));var ae=function(e){return{name:"var"+e,pipelineAgg:"select metric"}},ie=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.variables=t.variables||[ae(1)],t.onChangeInternal=function(){t.onChange()},t.add=function(){t.variables.push(ae(t.variables.length+1)),t.onChange()},t.remove=function(e){t.variables.splice(e,1),t.onChange()}};function oe(e){return(oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function se(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function le(e,t){return!t||"object"!==oe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ue(e){return(ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ce(e,t){return(ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}ie.$inject=["$scope"],ie.$inject=["$scope"],ee.c.directive("elasticPipelineVariables",(function(){return{templateUrl:"public/app/plugins/datasource/elasticsearch/partials/pipeline_variables.html",controller:"ElasticPipelineVariablesCtrl",restrict:"E",scope:{onChange:"&",variables:"=",options:"="}}})),ee.c.controller("ElasticPipelineVariablesCtrl",ie);var ge=function(e){function t(e,r,n,a){var i;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=le(this,ue(t).call(this,e,r))).$rootScope=n,i.uiSegmentSrv=a,i.esVersion=i.datasource.esVersion,i.target=i.target||{},i.target.metrics=i.target.metrics||[{type:"count",id:"1"}],i.target.bucketAggs=i.target.bucketAggs||[{type:"date_histogram",id:"2",settings:{interval:"auto"}}],0===i.target.bucketAggs.length){var o=i.target.metrics[0];o&&"raw_document"===o.type||(i.target.bucketAggs=[{type:"date_histogram",id:"2",settings:{interval:"auto"}}]),i.refresh()}return i.queryUpdated(),i}var r,n,a;return t.$inject=["$scope","$injector","$rootScope","uiSegmentSrv"],function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ce(e,t)}(t,e),r=t,(n=[{key:"getFields",value:function(e){var t=i.a.toJson({find:"fields",type:e});return this.datasource.metricFindQuery(t).then(this.uiSegmentSrv.transformToSegments(!1)).catch(this.handleQueryError.bind(this))}},{key:"queryUpdated",value:function(){var e=this.target.metrics.some((function(e){return"raw_data"===e.type||"raw_document"===e.type})),t=i.a.toJson(this.datasource.queryBuilder.build(this.target),!0);this.rawQueryOld&&t!==this.rawQueryOld?this.refresh():e&&this.refresh(),this.rawQueryOld=t,this.$rootScope.appEvent(te.CoreEvents.elasticQueryUpdated)}},{key:"getCollapsedText",value:function(){var e=this.target.metrics,t=this.target.bucketAggs,r=b(this.esVersion),n=c,a="";return this.target.query&&(a+="Query: "+this.target.query+", "),a+="Metrics: ",s.a.each(e,(function(e,t){var n=s.a.find(r,{value:e.type});a+=n.text+"(",n.requiresField&&(a+=e.field),n.supportsMultipleBucketPaths&&(a+=e.settings.script.replace(new RegExp("params.","g"),"")),a+="), "})),s.a.each(t,(function(e,t){0===t&&(a+=" Group by: ");var r=s.a.find(n,{value:e.type});a+=r.text+"(",r.requiresField&&(a+=e.field),a+="), "})),this.target.alias&&(a+="Alias: "+this.target.alias),a}},{key:"handleQueryError",value:function(e){return this.error=e.message||"Failed to issue metric query",[]}}])&&se(r.prototype,n),a&&se(r,a),t}(r("LzXI").QueryCtrl);ge.templateUrl="partials/query.editor.html";var fe=r("q1tI"),de=r.n(fe),pe=r("kDLi");function me(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ve(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?me(Object(r),!0).forEach((function(t){he(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):me(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function he(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ye=pe.LegacyForms.Select,be=pe.LegacyForms.Input,Oe=pe.LegacyForms.FormField,_e=[{label:"No pattern",value:"none"},{label:"Hourly",value:"Hourly",example:"[logstash-]YYYY.MM.DD.HH"},{label:"Daily",value:"Daily",example:"[logstash-]YYYY.MM.DD"},{label:"Weekly",value:"Weekly",example:"[logstash-]GGGG.WW"},{label:"Monthly",value:"Monthly",example:"[logstash-]YYYY.MM"},{label:"Yearly",value:"Yearly",example:"[logstash-]YYYY"}],xe=[{label:"2.x",value:2},{label:"5.x",value:5},{label:"5.6+",value:56},{label:"6.0+",value:60},{label:"7.0+",value:70}],we=function(e){var t=e.value,r=e.onChange;return de.a.createElement(de.a.Fragment,null,de.a.createElement("h3",{className:"page-heading"},"Elasticsearch details"),de.a.createElement("div",{className:"gf-form-group"},de.a.createElement("div",{className:"gf-form-inline"},de.a.createElement("div",{className:"gf-form max-width-25"},de.a.createElement(Oe,{labelWidth:10,inputWidth:15,label:"Index name",value:t.database||"",onChange:ke("database",t,r),placeholder:"es-index-name",required:!0})),de.a.createElement("div",{className:"gf-form width-14"},de.a.createElement(Oe,{labelWidth:10,label:"Pattern",inputEl:de.a.createElement(ye,{options:_e,onChange:Se(t,r),value:_e.find((function(e){return e.value===(void 0===t.jsonData.interval?"none":t.jsonData.interval)}))})}))),de.a.createElement("div",{className:"gf-form max-width-25"},de.a.createElement(Oe,{labelWidth:10,inputWidth:15,label:"Time field name",value:t.jsonData.timeField||"",onChange:je("timeField",t,r),required:!0})),de.a.createElement("div",{className:"gf-form"},de.a.createElement("span",{className:"gf-form-select-wrapper"},de.a.createElement(Oe,{labelWidth:10,label:"Version",inputEl:de.a.createElement(ye,{options:xe,onChange:function(e){var n=function(e,t){if(5===e&&t<70)return 256;if(256===e&&t>=70)return 5;return e||Fe(t)}(t.jsonData.maxConcurrentShardRequests,e.value);r(ve({},t,{jsonData:ve({},t.jsonData,{esVersion:e.value,maxConcurrentShardRequests:n})}))},value:xe.find((function(e){return e.value===t.jsonData.esVersion}))})}))),t.jsonData.esVersion>=56&&de.a.createElement("div",{className:"gf-form max-width-30"},de.a.createElement(Oe,{"aria-label":"Max concurrent Shard Requests input",labelWidth:15,label:"Max concurrent Shard Requests",value:t.jsonData.maxConcurrentShardRequests||"",onChange:je("maxConcurrentShardRequests",t,r)})),de.a.createElement("div",{className:"gf-form-inline"},de.a.createElement("div",{className:"gf-form"},de.a.createElement(Oe,{labelWidth:10,label:"Min time interval",inputEl:de.a.createElement(be,{className:"width-6",value:t.jsonData.timeInterval||"",onChange:je("timeInterval",t,r),placeholder:"10s",validationEvents:he({},pe.EventsWithValidation.onBlur,[Object(pe.regexValidation)(/^\d+(ms|[Mwdhmsy])$/,"Value is not valid, you can use number with time unit specifier: y, M, w, d, h, m, s")])}),tooltip:de.a.createElement(de.a.Fragment,null,"A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example ",de.a.createElement("code",null,"1m")," if your data is written every minute.")})))))},ke=function(e,t,r){return function(n){r(ve({},t,he({},e,n.currentTarget.value)))}},je=function(e,t,r){return function(n){r(ve({},t,{jsonData:ve({},t.jsonData,he({},e,n.currentTarget.value))}))}},Se=function(e,t){return function(r){var n=e.database,a="none"===r.value?void 0:r.value;if(!n||0===n.length||n.startsWith("[logstash-]")){var i="";if(void 0!==a){var o=_e.find((function(e){return e.value===a}));o&&(i=o.example)}t(ve({},e,{database:i,jsonData:ve({},e.jsonData,{interval:a})}))}else t(ve({},e,{jsonData:ve({},e.jsonData,{interval:a})}))}};function Fe(e){return e>=70?5:256}function Ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Pe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var qe=pe.LegacyForms.FormField,Ce=function(e){var t=e.value,r=e.onChange,n=function(e){return function(n){r(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(r),!0).forEach((function(t){Pe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ee(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t,Pe({},e,n.currentTarget.value)))}};return de.a.createElement(de.a.Fragment,null,de.a.createElement("h3",{className:"page-heading"},"Logs"),de.a.createElement("div",{className:"gf-form-group"},de.a.createElement("div",{className:"gf-form max-width-30"},de.a.createElement(qe,{labelWidth:11,label:"Message field name",value:t.logMessageField,onChange:n("logMessageField"),placeholder:"_source"})),de.a.createElement("div",{className:"gf-form max-width-30"},de.a.createElement(qe,{labelWidth:11,label:"Level field name",value:t.logLevelField,onChange:n("logLevelField")}))))},Ae=r("kDDq"),De=r("tLXD"),Te=r("WnbS"),Me=r("Wkk1");function Le(){var e=Ue(["\n            width: 100%;\n          "]);return Le=function(){return e},e}function Ve(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ve(Object(r),!0).forEach((function(t){$e(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ve(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function $e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ne(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Re(){var e=Ue(["\n    display: flex;\n    align-items: baseline;\n  "]);return Re=function(){return e},e}function ze(){var e=Ue(["\n    flex: 3;\n  "]);return ze=function(){return e},e}function Be(){var e=Ue(["\n    flex: 2;\n  "]);return Be=function(){return e},e}function Qe(){var e=Ue(["\n    display: flex;\n  "]);return Qe=function(){return e},e}function Ue(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var We=pe.LegacyForms.FormField,He=pe.LegacyForms.Switch,Ye=Object(pe.stylesFactory)((function(){return{firstRow:Object(Ae.css)(Qe()),nameField:Object(Ae.css)(Be()),regexField:Object(Ae.css)(ze()),row:Object(Ae.css)(Re())}})),Je=function(e){var t,r=e.value,n=e.onChange,a=e.onDelete,i=e.suggestions,o=e.className,s=Ye(),l=function(e){var t=Ne(Object(fe.useState)(!!e),2),r=t[0],n=t[1],a=Object(De.a)(e);return Object(fe.useEffect)((function(){a||!e||r||n(!0),a&&!e&&r&&n(!1)}),[a,e,r]),[r,n]}(r.datasourceUid),u=Ne(l,2),c=u[0],g=u[1];return de.a.createElement("div",{className:o},de.a.createElement("div",{className:s.firstRow+" gf-form"},de.a.createElement(We,{className:s.nameField,labelWidth:6,inputWidth:null,label:"Field",type:"text",value:r.field,tooltip:"Can be exact field name or a regex pattern that will match on the field name.",onChange:(t="field",function(e){n(Ie({},r,$e({},t,e.currentTarget.value)))})}),de.a.createElement(pe.Button,{variant:"destructive",title:"Remove field",icon:"times",onClick:function(e){e.preventDefault(),a()}})),de.a.createElement("div",{className:"gf-form"},de.a.createElement(We,{label:c?"Query":"URL",labelWidth:6,inputEl:de.a.createElement(pe.DataLinkInput,{placeholder:c?"${__value.raw}":"http://example.com/${__value.raw}",value:r.url||"",onChange:function(e){return n(Ie({},r,{url:e}))},suggestions:i}),className:Object(Ae.css)(Le())})),de.a.createElement("div",{className:s.row},de.a.createElement(He,{label:"Internal link",checked:c,onChange:function(){c&&n(Ie({},r,{datasourceUid:void 0})),g(!c)}}),c&&de.a.createElement(Ge,{onChange:function(e){n(Ie({},r,{datasourceUid:e}))},datasourceUid:r.datasourceUid})))},Ge=function(e){var t=e.datasourceUid,r=e.onChange,n=Object(Te.a)().getExternal().filter((function(e){return e.meta.tracing})).map((function(e){return{value:e.uid,name:e.name,meta:e.meta}})),a=t&&n.find((function(e){return e.value===t}));return de.a.createElement(Me.b,{onChange:function(e){return r(e.value)},datasources:n,current:a||void 0})};function Ke(){var e=tt(["\n              margin-right: 10px;\n            "]);return Ke=function(){return e},e}function Xe(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ze(){var e=tt(["\n    margin-bottom: ",";\n  "]);return Ze=function(){return e},e}function et(){var e=tt(["\n    padding-bottom: ",";\n    color: ",";\n  "]);return et=function(){return e},e}function tt(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var rt=Object(pe.stylesFactory)((function(e){return{infoText:Object(Ae.css)(et(),e.spacing.md,e.colors.textWeak),dataLink:Object(Ae.css)(Ze(),e.spacing.sm)}})),nt=function(e){var t=e.value,r=e.onChange,a=Object(pe.useTheme)(),i=rt(a);return de.a.createElement(de.a.Fragment,null,de.a.createElement("h3",{className:"page-heading"},"Data links"),de.a.createElement("div",{className:i.infoText},"Add links to existing fields. Links will be shown in log row details next to the field value."),de.a.createElement("div",{className:"gf-form-group"},t&&t.map((function(e,a){return de.a.createElement(Je,{className:i.dataLink,key:a,value:e,onChange:function(e){var n=Xe(t);n.splice(a,1,e),r(n)},onDelete:function(){var e=Xe(t);e.splice(a,1),r(e)},suggestions:[{value:n.DataLinkBuiltInVars.valueRaw,label:"Raw value",documentation:"Raw value of the field",origin:n.VariableOrigin.Value}]})})),de.a.createElement("div",null,de.a.createElement(pe.Button,{variant:"secondary",className:Object(Ae.css)(Ke()),icon:"plus",onClick:function(e){e.preventDefault();var n=[].concat(Xe(t||[]),[{field:"",url:""}]);r(n)}},"Add"))))};function at(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function it(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?at(Object(r),!0).forEach((function(t){ot(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):at(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ot(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,"plugin",(function(){return lt}));var st=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)};st.templateUrl="partials/annotations.editor.html";var lt=new n.DataSourcePlugin(X).setQueryCtrl(ge).setConfigEditor((function(e){var t=e.options,r=e.onOptionsChange;return Object(fe.useEffect)((function(){var e=t.jsonData.esVersion||5;r(it({},t,{jsonData:it({},t.jsonData,{timeField:t.jsonData.timeField||"@timestamp",esVersion:e,maxConcurrentShardRequests:t.jsonData.maxConcurrentShardRequests||Fe(e),logMessageField:t.jsonData.logMessageField||"",logLevelField:t.jsonData.logLevelField||""})}))}),[]),de.a.createElement(de.a.Fragment,null,de.a.createElement(pe.DataSourceHttpSettings,{defaultUrl:"http://localhost:9200",dataSourceConfig:t,showAccessOptions:!0,onChange:r}),de.a.createElement(we,{value:t,onChange:r}),de.a.createElement(Ce,{value:t.jsonData,onChange:function(e){return r(it({},t,{jsonData:e}))}}),de.a.createElement(nt,{value:t.jsonData.dataLinks,onChange:function(e){r(it({},t,{jsonData:it({},t.jsonData,{dataLinks:e})}))}}))})).setAnnotationQueryCtrl(st)},Wkk1:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var n=r("q1tI"),a=r.n(n),i=r("kDLi"),o=r("Csm0");function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=u(this,c(t).call(this,e))).onChange=function(e){var t=r.props.datasources.find((function(t){return t.name===e.value}));t&&r.props.onChange(t)},r}var r,n,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e=this.props,t=e.datasources,r=e.current,n=e.autoFocus,s=e.hideTextValue,l=e.onBlur,u=e.openMenuOnFocus,c=e.showLoading,g=e.placeholder,f=e.invalid,d=t.map((function(e){return{value:e.name,label:e.name,imgUrl:e.meta.info.logos.small}})),p=r&&{label:r.name.substr(0,37),value:r.name,imgUrl:r.meta.info.logos.small,loading:c,hideText:s};return a.a.createElement("div",{"aria-label":o.selectors.components.DataSourcePicker.container},a.a.createElement(i.Select,{className:"ds-picker select-container",isMulti:!1,isClearable:!1,backspaceRemovesValue:!1,onChange:this.onChange,options:d,autoFocus:n,onBlur:l,openMenuOnFocus:u,maxMenuHeight:500,menuPlacement:"bottom",placeholder:g,noOptionsMessage:"No datasources found",value:p,invalid:f}))}}])&&l(r.prototype,n),s&&l(r,s),t}(n.PureComponent);f.defaultProps={autoFocus:!1,openMenuOnFocus:!1,placeholder:"Select datasource"},t.b=f},tLXD:function(e,t,r){"use strict";var n=r("q1tI");t.a=function(e){var t=Object(n.useRef)();return Object(n.useEffect)((function(){t.current=e})),t.current}}}]);
//# sourceMappingURL=elasticsearchPlugin.7bf174750e07ac7111d5.js.map